Issue ID,Issue Summary,Issue Description,R1,R2,R3,R4,R5,R6,R7,R8,R9,R10,R11,R12,R13,R14,R15,R16,R17,R18,R19,R20,R21,R22,R23,R24,R25,R26,R27,R28,R29,R30,R31,R32,R33,R34,R35,R36,R37,R38,R39,R40,R41,R42,R43,R44,R45,R46,R47,R48,R49,R50,R51,R52,R53,R54,R55,R56,R57,R58,R59,R60,R61,R62,R63,R64,R65,R66,R67,R68,R69,R70,R71
MDL-61275,Collection of issues that capture the changes required to the user sign up process to comply with GDPR,To be released as a plugin with subsequent integration into core for Moodle 3.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61297,A new popup for showing the policy links to guests,"If enabled, show guest users a popup (similar to the one used for cookie-law notifications commonly), for showing the policy links which affect them.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61302,Add the workflow for allowing users to agree to the policies,Change the workflow for allowing users to agree to the policies if needed.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61308,Implement 'request' interface for mod_assign,This is an issue to track the creation of a prototype PHP Interface for {{\core\privacy\request}} as the API negotiating Subject Access Requests in the assignment module.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61397,Implement providers for non-data blocks,Implement the privacy provider API for blocks which have no real data.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61407,Implement providers for mod_quiz,Attempt to write mod_quiz providers for the in-progress SAR API.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61463,Confirm subsystems without paths can be skipped,"The compliance check in the dataprivacy tool (MDL-61489) currently skips these components based on an empty path. Strictly speaking, they are still components.



We really need to consider whether we need to review and create providers for such components and how we'd do so (lib/classes/ ? ) 



The full list is:

access

bulkusers

countries

currencies

dbtransfer

debug

edufields

error

filepicker

help

hub

imscc

install

iso6392

langconfig

license

mathslib

mimetypes

pagetype

pix

plugin

table

timezones

userkey",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61475,Implement providers for mod_choice,Attempt to write mod_choice providers for the in-progress SAR API.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61568,Implement core_privacy for repositories and core_repository,Let's take a look at repositories and see if we can fully implement the {{core_privacy}} API for at least one.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61579,Implement all actions for the site_policy_handler callback,"In MDL-61477 there has been added the actions parameter to the site_policy_handler callback: https://tracker.moodle.org/browse/MDL-61477?focusedCommentId=527229&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-527229



So it's needed to add all these actions to the tool_policy.



",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61597,Implement core_privacy for calendar types,Implement core_privacy for calendar types,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61618,Connect the Data Privacy tool to the subsystem's manager to facilitate data export,"Here's what needs to be done:



1. New table 'tool_dataprivacy_request_contexts' to hold contexts for a given request

Should have cols:

- requestid

- component

- contextid

- status (for now: pending, approved, rejected but allow for more)



2. New constants in the api class to hold the context statuses above (pending , approved, rejected etc)

3. 'New request made' adhoc task updates:

- generate the contextlist_collection

- for each contextlist:

** store the component, context, etc in 'tool_dataprivacy_request_contexts' table

- progress the request (current code does this already)



4. At the point of approving (before scheduling the adhoc task):

- set status of all respective contexts in the table to 'approved' (may evolve to a UI control eventually)



5. 'Request approved' adhoc task updates:

- fetch list of approved contexts (those with status 'approved')

- reassemble a contextlist collection for these using approved_contextlist instead of contextlist.

- pass to manager->export()

- TODO: consider how to 'mop up' the contexts in the 'tool_dataprivacy_request_contexts' table. Do we do now or later? (scheduled task ?)



Note: This work should be based on the tool: [https://github.com/moodlehq/moodle-tool_dataprivacy] and on -MDL-61307- work.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61629,Implement core_privacy for message airnotifier.,Let's take a look at messages and see if we can fully implement the {{core_privacy}} API for at least one.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61635,Add bypass for Protected state when deleting user data,"This is currently a high-priority ice-cream feature.



The intention is that the deletion will currently _not_ delete any context data which is makred as ""Protected"" whilst it is still within the retention period.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61637,Use a context-children-based method to retrieve the list of course blocks,"tool_dataprivacy is currently fetching blocks using get_course_blocks external function, which retrieves blocks instances ready to be displayed, we want access to all block instances regardless of their contents being visible to users.",1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61652,Allow configuration as to who can download SAR data,"""The admin needs to be able to enable the data extract for a user, however does not want to allow users to request from within Moodle - as the organisation has a centralised request process.""







As noted by [~mikehughes],

{quote}This would suggest that there should be:

# a mechanism to prevent the automatic distribution of the exported data to the Data Subject.

# a ""Download Option"" on the DPO actions,

# a ""refresh/re-export"" mechanism.{quote}

To that end, lets:

* create a {{tool_dataprivacy/downloadownrequest}} capability applied to authenticated users;

* create a {{tool_dataprivacy/downloadallrequests}} capability not given as standard;

* check the caps as relevant



",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61653,Write Web Services to service SARs,We need to write WS to serve the SARs to allow better integration with other systems.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61663,Implement providers for core_portfolio and portfolio_xx plugins,"Implement providers for core_portfolio. This includes:

* Subsystem provider

* Subsystem interface for portfolio plugins to implement

* Reference portfolio plugin (Mahara) provider implementation",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61672,Abstract static methods used in core_privacy\local\sitepolicy\handler,"As reported by [~tobias.reischmann] at https://moodle.org/local/chatlogs/index.php?conversationid=21752#c638360



bq. It seems that the new privacy changes in core created some ""regressions"" for moodle3.3 in combination with php5.6 and behat. privacy/classes/local/sitepolicy/handler.php uses abstract static functions, which are not allowed in php5.6 and cause a warning. This warning is handled within behat tests as exception. Thus the very common behat step 'And I log in as ""teacher""' is no longer working. Do we bother about something like that?



Moodle core has zero notice tolerance policy so as per suggestion by [~dobedobedoh] this is a blocker.



Making these methods abstract was based on the following suggestion raised during the integration review:



bq. In the abstract class 'handler', where you have a couple of methods defined and returning null, I can't see any case where we're relying on that base implementation. It seems to me we always want the extending class to implement these methods. Therefore, I think these should just be proper abstract methods. This way, we force the extending classes to provide implementations, rather than suggest.



To fulfill that suggestion while keeping this compatible with PHP 5.6, I propose to remove the abstract keyword from methods and making them throw coding exceptions, so that implementations are forced to provide them.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61681,Improve sorting of tours,Add timemodified to the list of sort fields,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61682,Implement provider in the dataprivacy tool,"Implement and pull request here:

https://github.com/moodlehq/moodle-tool_dataprivacy",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61691,Incorrect namespace in plagiarism privacy provider,"See here:

https://github.com/moodle/moodle/blob/a235a6e02d0bf773b76f9e5545023cd27af118fd/plagiarism/classes/privacy/plagiarism_provider.php#L25",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61692,Extend link_subsystem calls to allow components to specify privacy fields when linking,"Looking at the portfolio (and this may be the case for some other areas too), I see a situation where a given component calls the portfolio subsystem, which links to the plugin types (portfolio). The plugin types (Mahara for example) link externally.



The issue I see here is that only the component (let's use forum as an example), knows what data it passes to the subsystem, and which subsequently gets exported externally. The subsystem and the plugins just pass it along, and don't know this. To me, it sounds like we need a way to say something like ""Link subsystem with this data"" - which we currently don't have with the link subsystem class. Right now, we don't / can't describe metadata about the fields sent externally through this flow: forum -> portfolio subsystem -> mahara plugin.



I'd think one way to address this would be to allow passing in fields to link_subsystem.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61693,Implement core_privacy for core_calendar,Implement privacy provider for core_calendar.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61695,"Hide the ""Policies and agreements"" profile link to all users","The ""Policies and agreements"" profile link is displayed always. We should display it only when:

* Is the current user.

* The user has access to accept on behalf of the user.



",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61696,Use modal window in acceptances page for displaying the policies,"In the acceptances page, use the modal window for displaying the policies instead of showing the content in a new page.



Some example can be found in prepare_user_acceptances function in policy/classes/output/page_agreedocs.php.



",0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61697,Inconsistent Page Return after Data Request,"After making a Data request on behalf of another user, Moodle returns to the ""Users"" data request page, not the ""Admin"" data request page that you started on.

# Go to /admin/tool/dataprivacy/datarequests.php

# Click ""New Request""

# Complete a request form & ""Save Changes""

# You are now on ""admin/tool/dataprivacy/mydatarequests.php""



This is a bit incongruous, and on the ""mydatarequests"" page the user doesn't have the same actions they can undertake:



ie. for an ""Awaiting Approval"" state they only get ""Cancel Request"", where on the ""datarequests"" page for the same item they can ""View/Approve/Deny"" the request.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61699,Guardian of minors from non Eu countries,"Trying to create a new Moodle account from user , selecting an age like '12' and Country any Non EU Country like Afghanistan site considers that the user is a minor



If a user from a non EU country tries to register it should be possible due in his country is no age restriction.



",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61703,Remove context_system restriction when storing user prefs,"As raised by [~gb2048] in https://moodle.org/mod/forum/discuss.php?d=365857#p1482411



It seems that there are valid reasons to store user preferences at the non-system context.



Plugins which need to do this will need to be based on the next point release, rather than the current one in order to do this.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61704,Use modal window to display acceptance on behalf,"it is possible to render a form in a modal, let's do it for the acceptance on behalf form",0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61705,Allow bulk accept on behalf,In the mockups it is possible to check several people and accept on their behalf in one action,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61706,Privacy and policies category in site administration is added for admins only,"In core all settings that are added under ""Privacy and policies"" are available for site admins only (req cap 'moodle/site:config'), however in tool_policy plugin we want to allow various managers to view/edit policies and agreements.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61710,Section error thrown if Site Policy handle is core & access tool_policy,"If the Core Site policy handler is set as being in use and you access the tool_policy {{managedocs.php}} a {{section error!}} message is displayed.

# Install {{tool_policy}}

# Leave Site Handler set to {{Core}}.

# Access {{/admin/tool/policy/managedocs.php}}

# Section Error! mesage is displayed

# Switch Site Handle to {{tool_policy}} 

# Access {{/admin/tool/policy/managedocs.php}}

# Page displays properly



Instead of an error if {{tool_policy}} is *not* the handler a useful error message should be displayed.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61712,Add a cache for purposes,We could also add one for categories but the really important one is for purposes as purposes contain retention periods and retention periods is what we need to fetch while calculating which contexts should be deleted.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61714,Change default age of digital consent according to current legislation on each country,As discussed in the French forums here [https://moodle.org/mod/forum/discuss.php?d=367653#p1482823] the digital age of consent in France was changed to 15 in February. Can this now be changed in Site admin defaults?,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61721,tool_dataprivacy: Page breaks when loaded with clean theme on 3.3,"Originally reported by [~fred] at https://github.com/moodlehq/moodle-tool_dataprivacy/issues/19



{code}

This page: /admin/tool/dataprivacy/dataregistry.php



Debug info: core/single_button

Error code: filenotfound

Stack trace:



line 125 of /lib/classes/output/mustache_template_finder.php: moodle_exception thrown

line 54 of /lib/classes/output/mustache_filesystem_loader.php: call to core\output\mustache_template_finder::get_template_filepath()

line 99 of /lib/mustache/src/Mustache/Loader/FilesystemLoader.php: call to core\output\mustache_filesystem_loader->getFileName()

line 82 of /lib/mustache/src/Mustache/Loader/FilesystemLoader.php: call to Mustache_Loader_FilesystemLoader->loadFile()

line 643 of /lib/mustache/src/Mustache/Engine.php: call to Mustache_Loader_FilesystemLoader->load()

line 77 of data/localcache/mustache/1521706807/clean/__Mustache_dce0fc8c4319649dd9a569a30c1ebe7d.php: call to Mustache_Engine->loadPartial()

line 19 of data/localcache/mustache/1521706807/clean/__Mustache_dce0fc8c4319649dd9a569a30c1ebe7d.php: call to __Mustache_dce0fc8c4319649dd9a569a30c1ebe7d->sectionE392155473be045575f7c7f54cb7ce17()

line 67 of /lib/mustache/src/Mustache/Template.php: call to __Mustache_dce0fc8c4319649dd9a569a30c1ebe7d->renderInternal()

line 177 of /lib/outputrenderers.php: call to Mustache_Template->render()

line 91 of /admin/tool/dataprivacy/classes/output/renderer.php: call to renderer_base->render_from_template()

line 401 of /lib/outputrenderers.php: call to tool_dataprivacy\output\renderer->render_data_registry_page()

line 41 of /admin/tool/dataprivacy/dataregistry.php: call to plugin_renderer_base->render()

{code}",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61722,"Set status to ""Draft"" to inactive policies","When a new policy is created, saved as active status and then I set it to inactive, it's not possible to do anything more with it (you can only view it).



We've discussed and, in this case, we should be able to set the status to ""Draft"" also.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61731,Implement core_privacy for a message email.,Implement the privacy provider for message email.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61743,Incorrect restrictions in helper delete/export when called from mod,"A mod can export for non-mod contexts, but the helper does not cope with this.



Bad combination of checking component name for mod, and a strict type hint of context_module on the functions they call.



{code}

If I try to delete user contexts I get the same error I reported Yesterday 



Error code: generalexceptionmessage

* line 275 of /privacy/classes/local/request/helper.php: TypeError thrown

* line 95 of /privacy/classes/local/request/helper.php: call to core_privacy\local\request\helper::delete_data_for_all_users_in_context_course_module()

* line 267 of /privacy/classes/manager.php: call to core_privacy\local\request\helper::delete_data_for_all_users_in_context()

* line 90 of /admin/tool/dataprivacy/classes/expired_contexts.php: call to core_privacy\manager->delete_data_for_all_users_in_context()

* line 61 of /admin/tool/dataprivacy/classes/task/expired_retention_period.php: call to tool_dataprivacy\expired_contexts->delete()

* line 156 of /admin/tool/task/cli/schedule_task.php: call to tool_dataprivacy\task\expired_retention_period->execute()



!!! Exception - Argument 2 passed to core_privacy\local\request\helper::delete_data_for_all_users_in_context_course_module() must be an instance of context_module, instance of context_user given, called in [dirroot]/privacy/classes/local/request/helper.php on line 95 !!!

{code}



[~dmonllao] will hopefully be able to advise which plugin this breaks on for replication instructions.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61751,Missing polyfill for plagiarism provider interface,Mentioned on MDL-61691. Need to provide this polyfill for plugins to use.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61752,Merge data privacy settings and links to the common Privacy and Policy admin tree branch,The summary describes pretty much everything.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61756,Add a global enable / disable delete expired contexts (according to data registry),"The data registry is useful to set a retention period to each moodle context instance. The consequences of not setting retention periods properly can be horrible e.g. 0 years retention period assigned at user context means that all users without ongoing courses will be deleted :)



We need moodle admins to explicitly enable this feature before stuff gets deleted automatically.



I intentionally allowed users to set a 0 years retention period, we may want to reconsider this.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61759,PHP notice when configured to use a missing site policy handler,"h3. Synopsis



When the admin configures a plugin to be used as a site policy handler, and that plugin then becomes unavailable (e.g. is uninstalled), a PHP notice is displayed to users.



h3. Steps to reproduce



* Put the following into your config.php: {{$CFG->sitepolicyhandler = 'foo_bar';}}

* Log in as a student

* Expected behaviour: Nothing special

* Actual behaviour: PHP notice is displayed:

{{Notice: Undefined index: foo_bar in .../privacy/classes/local/sitepolicy/manager.php on line 66}}",1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61761,Implement core_privacy for a message jabber.,Implement the privacy provider for message jabber.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61764,Implement core_privacy for message popup.,Implement the privacy provider for message popup.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61774,Privacy officer follow-up,Remove the privacy officer setting. It should be further discussed in the future if a separate setting (or another solution) is needed when defining a Privacy officer.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61780,Policy settings' and 'Site policies' site admin UI confusion,"It seems confusing having 'Policy settings' (including the 'Site policy URL') and 'Site policies' in the site admin UI.



How about if we change the name 'Site policies' to 'Site settings'? The word 'Site' is kept in the name for familiarity and 'settings' is consistent with other site admin pages.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61785,Allow admins to confirm which expired contexts should be deleted,"In MDL-59720 we introduced a scheduled task that iterates through expired contexts (expired according its retention period) At the moment we just delete them but ideally we would provide a report for admins so they can confirm which contexts should be deleted.



||User Story||Acceptance Criteria||

|As a privacy officer, I want to be able to view a report listing data which should no longer be held, so that I can select which data to remove to comply with the principle of ""Privacy by Design"".|* Moodle will provide a report listing all types of data which has passed its retention period, so that the Privacy Officer can review and choose which data areas are to be erased. 

* This report will highlight data areas (courses, plugins, etc) and will not include the actual data itself.

* Choosing to delete all selected data should queue the selected data for deletion.

* Scheduled task will run to look for queued jobs and will remove the relevant data (that which the Privacy Officer selected).

* Admin account and any associated data must be considered exempt from the deletion process (see next point).|",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61795,Implement core_privacy for block rss client,Implement the privacy provider for block_rss_client.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61798,tool_dataprivacy exports as wrong user,"The user preferences data in a data request export is not necessarily for the correct user, as the export_user_preferences() method makes no use of the passed userid.



To reproduce, on a server with the boost theme, where the administrator has marked at least one user tour as completed:

# Create a new user

# As admin, in tool_dataprivacy, create a data request for that user and follow the steps required to get the zip download

# Open the zip file and go to System\User preferences\tool_usertours.json

# You see data, which you shouldn't, and this is for the admin user



",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61799,Add sanity check when calling export_user_data,"We should check each that contextlist in the collection has the same userid as the logged in user.

We require that it be run as that user, but we don't enforce it.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61801,Bug in unit test provider - customfiles/files confusion,"The phpunit provider testcase has a bug in its {{export_file}} function - it exports them to the customfiles instead.



Essentially this means that you can't fetch the files out for the purpose of Unit testing.

I'm writing unit tests which make use of this functionality in MDL-61309 for mod_forum.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61803,Missing string for cache definition in tool_policy causes unit test failure,"Missing string 'cachedef_toolpolicy' causes core_cache_administration_helper_testcase::test_get_summaries test to fail. See the following:

core_cache_administration_helper_testcase::test_get_summaries

Unexpected debugging() call detected.

Debugging: String does not exist. Please check your string definition for cachedef_toolpolicy/tool_policy

* line 10013 of /lib/moodlelib.php: call to debugging()

* line 623 of /cache/classes/definition.php: call to lang_string->__construct()

* line 823 of /cache/locallib.php: call to cache_definition->get_name()

* line 97 of /cache/tests/administration_helper_test.php: call to cache_administration_helper::get_definition_summaries()

* line ? of unknownfile: call to core_cache_administration_helper_testcase->test_get_summaries()

* line 1085 of /vendor/phpunit/phpunit/src/Framework/TestCase.php: call to ReflectionMethod->invokeArgs()

* line 936 of /vendor/phpunit/phpunit/src/Framework/TestCase.php: call to PHPUnit_Framework_TestCase->runTest()

* line 91 of /lib/phpunit/classes/advanced_testcase.php: call to PHPUnit_Framework_TestCase->runBare()

* line 701 of /vendor/phpunit/phpunit/src/Framework/TestResult.php: call to advanced_testcase->runBare()

* line 892 of /vendor/phpunit/phpunit/src/Framework/TestCase.php: call to PHPUnit_Framework_TestResult->run()

* line 753 of /vendor/phpunit/phpunit/src/Framework/TestSuite.php: call to PHPUnit_Framework_TestCase->run()

* line 753 of /vendor/phpunit/phpunit/src/Framework/TestSuite.php: call to PHPUnit_Framework_TestSuite->run()

* line 753 of /vendor/phpunit/phpunit/src/Framework/TestSuite.php: call to PHPUnit_Framework_TestSuite->run()

* line 465 of /vendor/phpunit/phpunit/src/TextUI/TestRunner.php: call to PHPUnit_Framework_TestSuite->run()

* line 185 of /vendor/phpunit/phpunit/src/TextUI/Command.php: call to PHPUnit_TextUI_TestRunner->doRun()

* line 115 of /vendor/phpunit/phpunit/src/TextUI/Command.php: call to PHPUnit_TextUI_Command->run()

* line 47 of /vendor/phpunit/phpunit/phpunit: call to PHPUnit_TextUI_Command::main()

",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61808,Implement provider for tool_monitor,Implement the core_privacy provider for tool_monitor.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61814,Implement the privacy provider for core_user.,Implement the core_privacy provider for core_user.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61815,Minor fixes to metadata types and addition of core method for retrieving the null provider reason.,"Both plugintype_link and subsystem_link metadata types have a method get_privacy_fields() which is type hinted to return an array, but return null. 

There was also no current way for the dataprivacy tool to get to the null provider reason, so a method needs to be created in core to get at that.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61817,Implement core_privacy for tinymce plugins,Probably all null providers.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61818,Implement core_privacy for antivirus,"* antivirus_clamav - probably null_provider

* core_antivirus - probably null_provider?



I don't think that the core subsystem needs to pass any data...",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61819,Implement core_privacy for a text editors,"# editor_textarea should be easy

# editor_tinymce... we'll see

# editor_atto - user preferences",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61829,Implement providers for block_community,Implement providers for block_community,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61830,Allow admins to confirm which expired contexts should be deleted: UI part,"Build the UI part of the deletion workflow for expired contexts:



||User Story||Acceptance Criteria||

|As a privacy officer, I want to be able to view a report listing data which should no longer be held, so that I can select which data to remove to comply with the principle of ""Privacy by Design"".|* Moodle will provide a report listing all types of data which has passed its retention period, so that the Privacy Officer can review and choose which data areas are to be erased. 

* This report will highlight data areas (courses, plugins, etc) and will not include the actual data itself.

* Choosing to delete all selected data should queue the selected data for deletion.

|",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61831,Honour 'protected' purposes during deletion requests,"Purposes have a 'protected' field which description states that *The retention of this data has a higher legal precedent over a user's request to be forgotten. This data will only be deleted after the retention period has expired*



Deletion requests should honour that protected field, skipping protected contexts.



Pasting a conversation from SAR team chat:



{code}

Andrew Nicols, [03.04.18 14:18]

It should be in here:

https://github.com/moodlehq/moodle-tool_dataprivacy/blob/master/classes/task/process_data_request_task.php#L108-L118



Andrew Nicols, [03.04.18 14:18]

Yes... but that's within the tool



Andrew Nicols, [03.04.18 14:18]

The API just deletes what it is told.



DavidMonllao, [03.04.18 14:18]

e.g. a user request to be forgotten is granted, we go through all the contexts where the user did something skipping the ones flagged as protected



Andrew Nicols, [03.04.18 14:19]

Yup



Andrew Nicols, [03.04.18 14:19]

That's where we should do it



DavidMonllao, [03.04.18 14:19]

it looks like it would be a good fit for get_contexts_for_userid



Andrew Nicols, [03.04.18 14:19]

Sorry, I thought that you'd done that part.



Andrew Nicols, [03.04.18 14:20]

My bad :)



DavidMonllao, [03.04.18 14:20]

np np



Andrew Nicols, [03.04.18 14:20]

How do you mean?



DavidMonllao, [03.04.18 14:20]

get_contexts_for_userid is only called for deletion requests is that right?



Andrew Nicols, [03.04.18 14:20]

No... it's called for export requests too



DavidMonllao, [03.04.18 14:20]

then maybe delete_user_data



Andrew Nicols, [03.04.18 14:20]

It is the duty of the tool, not the privacy API



Andrew Nicols, [03.04.18 14:21]

The privacy API just deletes what it is told. The tool is the only part aware of protected contexts, and it is the one responsible for calling the API with the correct data.



Andrew Nicols, [03.04.18 14:21]

It may be helpful if we add a function to the approved_contextlist class to remove_contexts(array $contextids)



Andrew Nicols, [03.04.18 14:22]

So that when we re-hydrate the contextlist on line https://github.com/moodlehq/moodle-tool_dataprivacy/blob/master/classes/task/process_data_request_task.php#L114, we can remove the ones which shoudl not be there



Andrew Nicols, [03.04.18 14:23]

$contextlist = new \core_privacy\local\request\approved_contextlist($foruser, $contextlist->get_component(), $contextlist->get_contextids());

$contextlist->remove_contexts($blacklistedids);

$approvedcollection->add_contextlist($contextlist);



Andrew Nicols, [03.04.18 14:25]

Alternatively, we'll do that when we fetch the contextlists into the approved contextlist.



Andrew Nicols, [03.04.18 14:25]

At the moment we're just fetching all contexts from get_contexts_for_userid and turning them into an apporved_contextlist.

There is a todo on line 109 to use the DB that Jake has been desigining.



Andrew Nicols, [03.04.18 14:26]

When we do that, we'll be able to link against the table for protected ones and just exclude them I presum.e

{code}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61836,Implement core_privacy for core_blog,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61838,Implement core_privacy for report progress,Implement the privacy provider for report progress.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61841,tool_policy: Not clear from UI that manager/parent can agree to the policies by clicking on red cross,"UI needs to be improved so it is more clear that red X is actually clickable



See mockups 

https://projects.invisionapp.com/share/WJFKUJA6BVD#/screens/279738984

https://projects.invisionapp.com/share/WJFKUJA6BVD#/screens/277570491

https://projects.invisionapp.com/share/WJFKUJA6BVD#/screens/277606661",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61843,Implement core_privacy for report completion,Implement the privacy provider for report completion.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61844,When saving policy as active or creating new policy the current user is requested to accept policy,"During some policy editing actions manager is requested to accept new policies. During some other actions manager is not (even though active policies have changed). 



There are behat tests that have ""TODO"" with this MDL number to help investigate it, see https://github.com/moodlehq/moodle-tool_policy/pull/35



Interesting that behat test ""Edit active policy and save as new active version"" works for manager but some others don't.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61845,tool_policy: Add more behat tests,"The following behat tests are still absent:



Manage policies interface:

- Make sure that users are requested to agree to new policies or new policy versions on the next login

- Deleting and changing sort order of policies



Parent functionality:

- Make sure parent can accept new policies on behalf of their child



User agreements:

- Behat tests for filters",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61846,Implement core_privacy for dataformat plugins.,Implement core_privacy for dataformat plugins.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61848,Implement providers for auth_manual,Attempt to write auth_manual providers for the in-progress SAR API.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61849,Invalid null return in privacy types,"The privacy types plugintype_link, subsystem_link, user_preference return null for the get_privacy_fields() method which isn't allowed as the return type is ""array"". If they are ever called, they throw a TypeError.



To reproduce:

{code:java}

$a = new \core_privacy\local\metadata\types\user_preference('my name');

$a->get_privacy_fields();{code}

",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61850,core_tag: typo in privacy lang string,"The privacy API implementation for the tag component uses a language string which doesn't exist: ""privacy:metadata:tag:name""",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61857,tool_policy: Do not display select column if there are no checkboxes,"h3. Steps to reproduce



# With the plugin installed using the default permissions

# Log in as Manager - so that you do not have the permission to accept policies on behalf of other users

# Go to the User agreements report



* Expected behaviour: As you can't mark policies as agreed, there is no point of showing the empty first column ""Select""

* Actual behaviour: Column heading is displayed, overlapping with the other heading.



!screenshot-1.png|thumbnail!",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61858,Create unit test to check all components implement something,This has to wait until we finish all components and will block any new component from landing until it does implement this.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61861,Create unit test to check all components,"Related to MDL-61858, but without the final bit failing components which do not implement at all.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61862,Implement core_privacy for mod_feedback,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61863,Implement providers for core_notes,Implement providers for core_notes,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61864,Prepare tool_policy for integration in 3.5,"Prepare plugin tool_policy for integration in 3.5



*Removed files:

** README.md

** LICENSE.md

** .travis.yml

* version.php changed to look like a standard plugin",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61866,tool_policy: thirdpartylibraries are defined incorrectly,"1. -Need to be two entries, one for JS file and another for styles.css- (edited: sorry, we don't need this)

2. Inside styles.css it should be clear which styles are from the library and which are additional

3. readme_moodle.txt is absent - it needs to explain where the library was imported from and how to upgrade",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61867,Implement core_privacy for fileconverter_unoconv,Implement core_privacy for fileconverter_unoconv.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61868,Implement Privacy API for tool_policy,Implement the privacy provider for tool_policy.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61872,tool_dataprivacy using non existing method,"The [moodle-tool_dataprivacy|https://github.com/moodlehq/moodle-tool_dataprivacy/] plugin created by MoodleHQ currently does not execute its process_data_request_task correctly.



If there are requests the tool will try to call the method: ""\core_privacy\manager::delete_user_data"" in line [117|https://github.com/moodlehq/moodle-tool_dataprivacy/blob/MOODLE_34_STABLE/classes/task/process_data_request_task.php#L117] but this method does not exist in the currently implemented privacy API. 



[delete_data_for_user|https://github.com/moodle/moodle/blob/MOODLE_34_STABLE/privacy/classes/manager.php#L233] would be the correct method to call i think, as they share the same method signature.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61873,Implement core_privacy for auth plugins (not oauth2 and manual),"Probably all null providers. (Not auth_oauth2 and auth_manual MDL-61848)



auth_cas

auth_db

auth_email

auth_ldap

auth_lti

auth_mnet

auth_nologin

auth_none

auth_shibboleth

auth_webservice







For Moodle 3.3.5 has to:



auth_imap

auth_fc

auth_pam

auth_pop3

auth_nntp",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61874,Make tool_dataprivacy\page_helper more generic,The current page_helper class is very specific to the data registry administration. We must make this a bit more generic so it can be reused by other data privacy admin pages.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61875,Split out manager->get_components_list into a core function,"This list of frankenstyle names for all core components (plugins + core subsystems) is used all over the place in both this project and in places in core too (search and others). We should have a function in core_component which provides this, instead of having to assemble this list manually all over the place.



This change should introduce the function in core and make the manager use this instead of its current internal implementation.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61877,Implement core_privacy for core_competency,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61878,Implement core_privacy for fileconverter_googledrive,Implement core_privacy for fileconverter_googledrive,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61881,Implement providers for report components,Implement providers for report components,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61882,Implement providers for auth_oauth2,Implement providers for auth_oauth2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61888,Avoid using $OUTPUT in tool_dataprivacy adhoc tasks,"As discovered in MDL-61800, the Task API doesn't seem to setup $OUTPUT properly. This causes adhoc tasks that send email notifications as these use $OUTPUT to render the templates for the email messages.



This would also (probably) block tool_dataprivacy from getting integrated to master.



To workaround this, remove the usages of $OUTPUT and templates in the tool's adhoc tasks.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61889,Address Travis failures in tool_dataprivacy,I dream of seeing a green Travis build for the tool_dataprivacy. We need to address this.,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61892,Implement core_privacy for admin/tool components.,"Implement the null privacy provider for admin/tool components which have been identified not to store any personal data.



NOTE: there are some additional admin/tools not covered in this ticket because they were flagged to maybe store personal data / preferences.



These remaining admin/tools will be addressed in separate issues.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61895,Implement core provider for availability plugins,Implement availability plugins,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61896,Implement core_privacy for filters,"Implement core_privacy for filters



Likely all null providers.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61897,Ability to discard expired contexts,"Once a context is flagged as expired there is an option to delete the context (schedule it for deletion) but there is no option to remove the expiration. The use case for it would be that the PO set wrong retention periods and they later notice that contexts listed in datadeletion.php shouldn't be there, so they want to remove them from the list.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61898,"Implement core_privacy for core_cache, cachestores, etc.","* core_cache

* cachestore plugintype",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61899,Include tool_dataprivacy in core,This issue is about including https://github.com/moodlehq/moodle-tool_dataprivacy in core and it is closely related to privacy API and MDL-61306.,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61900,tool_policy: decide when versions can be deleted,"Currently we only allow to delete draft versions. However we might allow to delete guest-only versions, or versions that do not yet have user agreements or just allow to delete any version",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61901,Require user to log in before being allowed to download the exported data,tool_dataprivacy_pluginfile() currently does not validate the user downloading an exported user data archive. So anyone who's got the download link will be able to download the user's data. We need to fix this.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0
MDL-61902,Implement core_privacy for media plugins.,Implement core_privacy for media plugins.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61903,Implement core_privacy for webservice plugins.,Implement core_privacy for webservice plugins.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61905,Implement core_privacy for mod_workshop,Implement the privacy API in the Workshop module,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61907,Visiting Data registry page with Clean theme in 3.3 throws error,"h3. Steps to reproduce

* Prepare a 3.3 site with Clean theme

* Install the Data privacy ([https://moodle.org/plugins/tool_dataprivacy]) plugin to it

* Visit Site administration > Data privacy > Data registry



An error is displayed:

{code}Sorry, the requested file could not be found



Debug info: core/single_button

Error code: filenotfound



Stack trace:

...

line 177 of /lib/outputrenderers.php: call to Mustache_Template->render()

line 91 of /admin/tool/dataprivacy/classes/output/renderer.php: call to renderer_base->render_from_template()

line 401 of /lib/outputrenderers.php: call to tool_dataprivacy\output\renderer->render_data_registry_page()

line 41 of /admin/tool/dataprivacy/dataregistry.php: call to plugin_renderer_base->render()

{code}



The reason for this is that in Moodle 3.3, the template {{core/single_button}} is only provided by the Boost theme. It became standard core template only as a side effect of -MDL-59388- in Moodle 3.4.



!screenshot-1.png|thumbnail!",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61908,Same heading appearing twice on Data privacy pages,"Multiple pages in the Data privacy (tool_dataprivacy) plugin have the same heading displayed twice.



!screenshot-1.png|thumbnail! 



This is because these page set the same text by both {{$PAGE->set_heading()}} and {{echo $OUTPUT->heading($title);}}. It is common that pages like this should use

{code}

$PAGE->set_heading($SITE->fullname);

{code}



instead.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61915,Implement core_privacy for enrol plugins (not lti and paypal),"Probably all null providers. (Not enrol_lti and enrol_paypal).



enrol_category

enrol_cohort

enrol_database

enrol_flatfile

enrol_guest

enrol_imsenterprise

enrol_ldap

enrol_manual

enrol_meta

enrol_mnet

enrol_self",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61916,Implement core_privacy for course format plugins,"Probably all null providers.





format_singleactivity

format_social

format_topics

format_weeks",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61918,Implement core_privacy for assignment plugins.,Implement core_privacy for assignment plugins.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61919,Implement core_privacy API for core_message subsystem,"Implement core_privacy API for core_message subsystem.



This covers the sending/receiving of all core messages and notifications in Moodle.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61920,Implement core_privacy for LTI and all subplugins,Implement core_privacy for LTI and all subplugins,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61925,Enable contexts to be added without SQL,"In the get_contexts_for_userid() provider method, it would be useful to be able to add known contexts directly when a plugin stores all its data at that context. The only two use cases for this I can think of are the system context and the user context, so it may not be worth making set_contextids() public, but a couple of helper methods like add_system_context() and add_user_context($userid) would be useful.



At the moment you have to do something like this, which seems absurd:

{code} public static function get_contexts_for_userid(int $userid): contextlist {

$result = new contextlist('local_someplugin');

$result->add_from_sql('SELECT id FROM {context} WHERE id = ?', [\context_system::instance()->id]);

return $result;

}

{code}",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61935,Provide means for the Privacy Officer to set lawful basis for defining purposes for collection of personal data,"We need to add form controls that let the Privacy Officer select one or more items defined in GDPR Art 6: Lawfulness of processing and GDPR Art 9: Sensitive Personal Data.



https://docs.google.com/document/d/140ntePga4GmR8R8VAQuOC1AJfEW0mKLzgV-aNfb60y0/edit",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61937,Implement core_privacy for mod_data and datafields,"Implement core_privacy for mod_data and datafields:

* datafield_checkbox

* datafield_date

* datafield_file

* datafield_latlong

* datafield_menu

* datafield_multimenu

* datafield_number

* datafield_picture

* datafield_radiobutton

* datafield_text

* datafield_textarea

* datafield_url",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61939,The plugin lets you accept site policies when you logged in as someone else,"Hi All,



I was playing with this new feature as we need to implement it soon. We keep logging in as our students, tutor, etc.



Try this one:

# policies are ON

# create at least one user (student)

# login as admin

# find the student

# use the LOGIN AS functionality to log in as the student

# accept the site policy agreement on behalf of the student



*EXPECTED* Behavior



in the mdl_tool_policy_acceptances table



userid = student/user id (the pretended one)



usermodified = admin id (or whoever originally logged in)



so later it looks like it was accepted ON BEHALF OF the student



*REALITY*



userid and usermodified are both the student's id, so it looks like the student logged in and accepted the policies which is not true at all



nothing goes to the logs, so no one can tell if it was the real student or someone else, who had permission to log in as the student



The other way would be even more accurate:



if I logged in as someone else, I should not be able to accept the policy at all.



I am sorry but I think this is a serious issue.



Thanks



Frank",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61941,Incorrect arguments passed,"I've been trying to run the data deletion processes, have a number of times come across an issue with the wrong type of context being passed and conflicting with the defined signature on functions.



Here is the dump from one such case when running the Delete expired contexts task via the web UI on 3.4

{code:java}

Execute scheduled task: Delete expired contexts (tool_dataprivacy\task\delete_expired_contexts)

... started 14:29:21. Current memory use 10.6MB.

object(context_module)#5969 (5) {

[""_id"":protected]=>

int(1397)

[""_contextlevel"":protected]=>

int(70)

[""_instanceid"":protected]=>

string(3) ""330""

[""_path"":protected]=>

string(14) ""/1/3/1367/1397""

[""_depth"":protected]=>

string(1) ""4""

}

object(context_module)#19 (5) {

[""_id"":protected]=>

int(1398)

[""_contextlevel"":protected]=>

int(70)

[""_instanceid"":protected]=>

string(3) ""331""

[""_path"":protected]=>

string(14) ""/1/3/1367/1398""

[""_depth"":protected]=>

string(1) ""4""

}

object(context_module)#17 (5) {

[""_id"":protected]=>

int(1411)

[""_contextlevel"":protected]=>

int(70)

[""_instanceid"":protected]=>

string(3) ""334""

[""_path"":protected]=>

string(14) ""/1/3/1367/1411""

[""_depth"":protected]=>

string(1) ""4""

}

object(context_module)#6007 (5) {

[""_id"":protected]=>

int(1434)

[""_contextlevel"":protected]=>

int(70)

[""_instanceid"":protected]=>

string(3) ""347""

[""_path"":protected]=>

string(14) ""/1/3/1367/1434""

[""_depth"":protected]=>

string(1) ""4""

}

object(context_module)#6008 (5) {

[""_id"":protected]=>

int(1466)

[""_contextlevel"":protected]=>

int(70)

[""_instanceid"":protected]=>

string(3) ""367""

[""_path"":protected]=>

string(14) ""/1/3/1367/1466""

[""_depth"":protected]=>

string(1) ""4""

}

Exception - Argument 2 passed to core_privacy\local\request\helper::delete_data_for_all_users_in_context_course_module() must be an instance of context_module, instance of context_block given, called in [dirroot]/privacy/classes/local/request/helper.php on line 95



More information about this error



Debug info: 

Error code: generalexceptionmessage

Stack trace: 

line 275 of /privacy/classes/local/request/helper.php: TypeError thrown

line 95 of /privacy/classes/local/request/helper.php: call to core_privacy\local\request\helper::delete_data_for_all_users_in_context_course_module()

line 267 of /privacy/classes/manager.php: call to core_privacy\local\request\helper::delete_data_for_all_users_in_context()

line 103 of /admin/tool/dataprivacy/classes/expired_contexts_manager.php: call to core_privacy\manager->delete_data_for_all_users_in_context()

line 59 of /admin/tool/dataprivacy/classes/task/delete_expired_contexts.php: call to tool_dataprivacy\expired_contexts_manager->delete()

line 104 of /lib/cronlib.php: call to tool_dataprivacy\task\delete_expired_contexts->execute()

line 292 of /lib/cronlib.php: call to cron_run_inner_scheduled_task()

line 91 of /admin/tool/task/schedule_task.php: call to cron_run_single_task(){code}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61944,Implement providers for tool_mobile,"Implement core_privacy for admin/tool/mobile.



It has a user preference: tool_mobile_autologin_request_last",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61945,Implement providers for core_register,Implements Null Provider.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61947,Implement providers for core_my,Implement providers for core_my,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61948,Implement core_privacy for core media.,Implement core_privacy for core media.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61949,Notify in lib/upgrade.txt and mod/upgrade.txt about privacy API,"This is very important change for plugin developers and it was not mentioned in any upgrade.txt



Activity modules developers need to be specifically notified about privacy API because they usually hold user data, so I suggest to do it in both lib/upgrade.txt (for all plugins) and mod/upgrade.txt (special attention to activity modules)",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61951,"Implement core_privacy for core_grading, gradingform_guide and gradingform_rubric","Implement core_privacy for:

* core_grading

* gradingform_guide

* gradingform_rubric",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61952,Implement core_privacy API for gradeexport,"Implement core_privacy for gradeexport plugins:

* gradeexport_ods

* gradeexport_txt

* gradeexport_xls

* gradeexport_xml",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61954,Implement core_privacy API for gradeimport,"Implement core_privacy for gradeimport plugins:

* gradeimport_csv

* gradeimport_direct

* gradeimport_xml",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61955,Delete users for deletion requests and expired context_user,We delete all data associated to a user in all components but we do not yet delete the user itself. This issue is about that.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61957,Implement core_privacy API for gradereport,"Implement core_privacy for gradereport plugins:

* gradereport_grader

* gradereport_history

* gradereport_outcomes

* gradereport_overview

* gradereport_singleview

* gradereport_user",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61958,Implement core_privacy API for core_rss,Implement core_privacy for core_rss,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61959,Implement core_privacy for mod_scorm,Implement the privacy API in the SCORM module.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61966,Myoverview block incorrectly implements Privacy API,"The 'myoverview' ('/blocks/myoverview') block records the user preference for the state of its tabs. For example in lib.php there is:



````



function block_myoverview_user_preferences() \{

$preferences = array();

$preferences['block_myoverview_last_tab'] = array(

'type' => PARAM_ALPHA,

'null' => NULL_NOT_ALLOWED,

'default' => BLOCK_MYOVERVIEW_TIMELINE_VIEW,

'choices' => array(BLOCK_MYOVERVIEW_TIMELINE_VIEW, BLOCK_MYOVERVIEW_COURSES_VIEW)

);



return $preferences;

}



````



being the user preference 'block_myoverview_last_tab'. However in 'classes/privacy/provider.php' the 'null_provider' class is implemented 'class provider implements \core_privacy\local\metadata\null_provider' indicating that no user data is stored. This is clearly not the case. The language file states 'The Course overview block only shows data stored in other locations.' but it stores a user preference pertaining to a user id.",1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61969,Implement core_privacy API for datapreset_imagegallery,Implement core_privacy API for datapreset_imagegallery.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61970,Implement core_privacy for mod_survey,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61971,Warn when downloading GDPR export over HTTP,"Suggestion from Martin:

{quote}

Please contact your system administrator to let them know that they need to install SSL on this site to allow features like this to work properly.

{quote}



Or something like that.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61972,Implement core_privacy for profilefield plugins.,Implement core_privacy for profilefield plugins.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61974,Privacy tests override or report invalid data,"Here is a test.



{code}

/**

* Test export and recover with children.

*/

public function test_get_data_with_children() {

$writer = $this->get_writer_instance();

$context = \context_system::instance();



$writer->set_context($context)

->export_data(['a'], (object) ['parent' => true])

->export_data(['a', 'b'], (object) ['parent' => false]);



$this->assertTrue($writer->get_data(['a'])->parent);

$this->assertFalse($writer->get_data(['a', 'b'])->parent);

$this->assertSame([], $writer->get_data(['a', 'b', 'c']));

}

{code}



I identified two issues:



# Writing a sub context overrides the parent

# Getting a sub context that does not exist returns the parent



Andrew mentioned that this will likely affect other `get_*` methods.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61975,Implement core_privacy for tool_recyclebin,"Implement null provider for tool_recyclebin



This plugin does have a database table 'tool_recyclebin_course' but it does not contain any identifying user data.



No userid is tracked within this table's records.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61976,Implement core_privacy for mod_wiki,"Implement core_privacy for mod_wiki



On data deletion request:

- Individual wikis to be removed completely

- Contributions to collaborative wikis remain",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61977,Implement core_privacy for tool_profiling,"Implement null providers for tool_profiling.



This plugin does access data from the mdl_profiling table, where the data is inserted by the lib/xhprof/xhprof_moodle.php script -> function profiling_import_runs().



However, the mdl_profiling table does not contain any user identifiable data.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61978,core_privacy\manager::plugintype_class_callback() does not use full frankenstyle name,core_privacy\manager::plugintype_class_callback() does not use full frankenstyle name,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-61979,Implement core_privacy for tool_cohortroles,"Implement metadata and plugin providers for tool_cohortroles.



This plugin stores user data in the mdl_tool_cohortroles table.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61980,Implement core_privacy for booktool plugins,Implement core_privacy for booktool plugins.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61982,Policy plugin still refers to a capability that been dropped,"The current tool_policy code still contains a reference to the capability {{tool/policy:manageprivacy}} in its admin/tool/policy/settings.php file. This then leads to a warning spotted by [~tsala] at gdprdemo.moodle.net (when logging in as dpo user):



{code}

Capability ""tool/policy:manageprivacy"" was not found! This has to be fixed in code.

line 416 of /lib/accesslib.php: call to debugging()

line 536 of /lib/accesslib.php: call to has_capability()

line 38 of /admin/tool/policy/settings.php: call to has_any_capability()

line 81 of /lib/classes/plugininfo/tool.php: call to include()

line 598 of /admin/settings/plugins.php: call to core\plugininfo\tool->load_settings()

line 8000 of /lib/adminlib.php: call to require()

line 7885 of /lib/adminlib.php: call to admin_get_root()

line 24 of /admin/search.php: call to admin_externalpage_setup()



Capability ""tool/policy:manageprivacy"" was not found! This has to be fixed in code.

line 416 of /lib/accesslib.php: call to debugging()

line 536 of /lib/accesslib.php: call to has_capability()

line 38 of /admin/tool/policy/settings.php: call to has_any_capability()

line 81 of /lib/classes/plugininfo/tool.php: call to include()

line 598 of /admin/settings/plugins.php: call to core\plugininfo\tool->load_settings()

line 8000 of /lib/adminlib.php: call to require()

line 26 of /admin/search.php: call to admin_get_root()

{code}",1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61984,Implement core_privacy for mod_chat,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61986,Implement core_privacy for mod_lesson,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61993,Implement core_privacy for profilefield_checkbox,Implement core_privacy for profilefield_checkbox.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61994,Implement providers for mod_glossary,Attempt to write mod_glossary providers for the in-progress SAR API.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61995,Implement core_privacy for tool_assignmentupgrade,The tool_assignmentupgrade plugin contains a user preference 'tool_assignmentupgrade_perpage' setting.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-61998,Implement core_privacy API for core_cohort,Implement core_privacy for core_cohort,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62003,Files directory inconsistent in content writer,"When exporting data, the content writer puts the files in a 'Files' folder, but the path to the file is rewritten to 'files' (lowercase) in content. [~mudrd8mz] also identified that the 'Files' folder is localised and therefore the 'Files' folder will be even more inconsistent with the rewritten path.



Edited: Additionally, it was realized that storing files in single folder for the whole subcontext may lead to conflicts and overwriting a file with an other.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62005,Implement providers for block_comments,Attempt to write mod_glossary providers for the in-progress SAR API.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62006,Determine and implement privacy support of short lived chat data,"The chat module stores information in _chat_users_ and _chat_messages_current.



The table _chat_users_ contains a list of users who appear to be active in a chat and is cleaned on a regular basis, whether by cron, or is triggered as part of user requests.



The table _chat_messages_current_ contains a list of recent messages from a chat, it appears to be a temporary cache for fast fetching of latest chat messages. Messages older than 8 hours are purged on a regular basis through cron runs.



In this issue we must decide whether reporting and exporting of such information is needed, and if yes implement it. This follows the work done in MDL-61984.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62007,Implement core_privacy for profilefield_datetime,Implement core_privacy for profilefield_datetime.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62009,Implement core_privacy for core_grades,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62012,lawfulbases field throwing error on dataprivacy upgrade,"I'm testing the dataprivacy plugin on Moodle 3.4.2. I had version 2017111304 (MOODLE_34_STABLE) of the plugin installed and was upgrading to 2017111305.



I already had entries in the mdl_tool_dataprivacy_purpose table.



This is the error Moodle gave on upgrade:



{{Default exception handler: Unknown DDL library error Debug: Field tool_dataprivacy_purpose->lawfulbases cannot be added. Not null fields added to non empty tables require default value. Create skipped}}



The install.xml and upgrade.php code specify that the lawfulbases is NOTNULL=true, but doesn't offer a default. Should the field be set to NOTNULL=false? and a default empty value set?",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62015,Auto select new purposes and categories,"The data registry UI allows us to easily create new purposes and categories. Once a new item is created we reload the current page but we don't autoselect the new item.



Some extra info:



Eloy raised this topic during MDL-61899 review:



_When adding categories or purposes, I'd expect the just created one to become automatically selected in the dropdow. Right now you've to pick it after being created._



And I replied this:



_It is not that simple and it needs more definition. Imagine that a specific context already have a selected purpose, you add another one and we reload the page selecting the new purpose; if the user just leaves the page the new purpose is added but not linked to that context, if we save it automatically we may be doing ""too much""... I don't have any preference, just that what is the best solution is not 100% clear to me and it should be discussed with UX team._",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62016,Expand data registry usage information / help,"It may be worth expanding the data registry information (help buttons / info messages) as it is a complex tool and some aspects of it may not be obvious.



This issue shouldn't introduce traumatic changes, just new messages around.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62026,Data Protection Officer cannot change pending status on other enquiries,"Hello,



If a user uses the link ""Contact Data Protection Officer"" the said CDPO cannot answer to this message in data requests the only action available for this kind of data request is ""view the request"" so the request is will be indefinitely in ""pending"" status.



Tested with Moodle 3.3.5 and Data privacy tool_dataprivacy 33.0.0 (2017051500)







",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62029,Implement core_privacy for course,Update core_course to use the privacy system.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62030,Implement core_privacy for profilefield_menu,Implement core_privacy for profilefield_menu.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62031,Restored courses should restore the backup purpose and category,"This was proposed by Eloy during MDL-61899 review. If the backup is imported from another site I would say that it may be better to not restore it, as we don't have any idnumber to reference.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62032,Implement core_privacy for profilefield_text,Implement core_privacy for profilefield_text.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62035,core_comment implementation does not handle deletion correctly,"Generally speaking when data is deleted for a context, all comments are deleted.

However comments are stored with:

# contextid

# component

# area

# itemid



These are already used for the export, but only the contextid is used in the deletion.



Although, in most cases, when deleting for one context you'll delete all comments, this _must not_ be assumed. There can be legitimate reasons to keep data from comments.



One example:

The {{tool_privacy}} tool may allow for comments relating to a delete request. These comments form part of the response and there is a strong business reason not to delete the comments.



We must update the comments provider to take more than just contextid for deletion.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62041,Blank sensitivedatareasons causes undefined property,"For plugin: tool_dataprivacy



To test:

# Set $CFG->debugdisplay = 1; in config.php

# Go to Site administration / Privacy and Policies / Data registry / Edit purposes

# Create or Edit a purpose

# Fill in all fields except: Sensitive personal data processing reasons

# Click Save changes



Result:



Error thrown on Save changes.



We should check the variable $data->sensitivedatareasons exists or is not empty.



",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62046,Implement core_privacy for profilefield_textarea,Implement core_privacy for profilefield_textarea.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62047,Implement core_privacy for a core_userkey,This is a bit more complex than others as this subsystem does not have a data directory just yet.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62048,Extend core_privacy_testsuite to check that the database table exists,This will catch typos and ensure we aren't returning invalid metadata.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62049,Wrong string used in the function transform::date meaning no date is displayed,"We are only showing the time, no date.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62055,Implement core_privacy API for mod_imscp,Implement core_privacy for mod_imscp,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62056,Adapt tool_policy to avoid travis errors on Github plugin project,"When MDL-61864 was finished, the code for the Moodle 3.3 and 3.4 tool_policy plugin has been updated, to align the versions.



As travis on the GitHub project ([https://github.com/moodlehq/moodle-tool_policy]) is more strict than CiBot, some minor changes should be done in the code for removing these travis errors.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62059,Implement providers for mod_book,Attempt to write mod_book providers for the in-progress SAR API.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62060,Use JSON_UNESCAPED_UNICODE for the data export,To ensure that the exported JSON file is human readable. E.g. Persian text () is currently outputted as \u0645\u062a\u0646.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62062,Change policy agreements once the policies has been accepted,"Eva Karall has posted the following comment to [https://moodle.org/plugins/tool_policy:]



{{Will there be a possibility to opt out (disagree) again from a policy? I cannot find anything about it. Thanks.}}







We should add a link in the profile to [http://yourmoodleurl//admin/tool/policy/index.php] for let him/her change the agreements.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62068,Exporting user tags exports too much for tag instances and not enough for tags,"core_tag\privacy\provider::export_item_tags() exports too much information about the tags themselves.

Just because user A have tagged something with tag X, it does not mean that he anyhow owns any other information about this tag except for its name. In fact, some fields like 'tagcollid', 'isstandard' and 'flagged' may not be even available for him.



I would only export ""rawname"" of each tag and nothing else. The field 'name' is just lowercased 'rawname' 



At the same time core_tag does not export tags ""belonging"" to the user and does not remove userid from tags on user deletion request. The name of the person who first created the tag is shown on ""Manage tags"" page. It does not have much value. We can anonymise such tags when processing user deletion request. They will be removed automatically by cron if the tag is no longer used by anybody. 



Examples:



1. User added ""birdwatching"" as his interest. The tag was automatically created and tag.userid points to this user. Nobody else used this tag. User has requested to be forgotten. The tag ""birdwatching"" is modified to set userid=0. The user is deleted. Next cron will remove records in tag_instance table that point to interests of deleted users. When there are no tag_instance records linking to the tag , the tag ""birdwatching"" will also be deleted.



2. User added ""computers"" as his interest. The tag was automatically created and tag.userid points to this user. Another user also added ""computers"" as his interest. The record in 'tag' table is not changed, new record in tag_instance table was added. The first user has requested to be forgotten, we set userid=0 for the tag ""computers"", however the tag is not removed because it is used elsewhere. When manager views ""Manage tags"" page the column ""User name"" is empty for this tag.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62075,Error after accessing a data deletion request for another user,"As reported by Victor Deniz in https://tracker.moodle.org/browse/MDL-61899?focusedCommentId=609945&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-609945



# Delete the child user.

# As the user with parent role, access Data requests.

{code}

Error message:

Invalid user



More information about this error

Debug info: SELECT id FROM {user} WHERE id = ? AND deleted = ?

[array (

0 => '78',

1 => 0,

)]

Error code: invaliduser

Stack trace: * line 1546 of /lib/dml/moodle_database.php: dml_missing_record_exception thrown



line 1522 of /lib/dml/moodle_database.php: call to moodle_database->get_record_select()

line 6105 of /lib/accesslib.php: call to moodle_database->get_record()

line 78 of /admin/tool/dataprivacy/classes/output/my_data_requests_page.php: call to context_user::instance()

line 51 of /admin/tool/dataprivacy/classes/output/renderer.php: call to tool_dataprivacy\output\my_data_requests_page->export_for_template()

line 412 of /lib/outputrenderers.php: call to tool_dataprivacy\output\renderer->render_my_data_requests_page()

line 61 of /admin/tool/dataprivacy/mydatarequests.php: call to plugin_renderer_base->render()

{code}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62077,"Data registry ""Set defaults"" and ""Edit"" buttons should be next to each other","With MDL-56511 a .d-inline css class has been added. It moves the data registry ""Edit"" button to the line below.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62078,Link core_userkey subsystem from core_rss when implementing the core_privacy provider,"David Monlla_ has realised that core_rss has been integrated but it's not using the core_userkey subsystem created in MDL-62047. The core_rss provider has implemented its own calls to export and delete information on user_private_key table.



This has to be changed to link both systems.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62079,Implement core_privacy for core_filters,core_filters does not define any data.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62117,Implement providers for enrol_paypal,Attempt to write enrol_paypal providers for the in-progress SAR API.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62134,Add error handling for exports and deletes,"At the moment if any plugin's privacy API implementation causes an exception, the whole request fails.



Arguably this is correct - we want to make sure the request completed correctly wherever possible, however it may be worth adding some try/catch checks around some requests to allow requests to come to some level of completion and instead alert an administrator somehow.



Also consider rolling back database transactions.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62135,Implement core_privacy for tool_log and subplugins,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62136,Implement providers for core_hub and core_publish,"Implement providers for core_hub and core_publish. Review core_register and block_community



Putting them all together because they all are part of moodle.net / hub communication



*Note, code is different for Moodle 3.3 !*",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62137,Implement core_privacy for the completion component,Add privacy information for the completion component.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62141,tool_privacy: impossible to define provider for core subsystem without directory,"For core subsystems that do not have directory it is impossible to define a provider because the classes can only be placed in lib/classes/SUBSYSTEM/ and, therefore, they will have a namespace core\SUBSYSTEM 



tool_privacy expects them to be in namespace core_SUBSYSTEM",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62147,Make sure every table in lib/db/install.xml has a core subsystem responsible for it,"When we go through the list of core subsystems we may accidentally ""forget"" some database tables that have user data because there is no strict relation table<->component



Go through all tables defined in lib/db/install.xml that may have user data and make sure it is covered by one of the core components



There are a few places where we have specifically excluded the tables.

Nevertheless, we should probably describe the table in metadata.

||Table||Field||Decision||Issue||

||config_log||userid|TODO core|MDL-62425|

||upgrade_log||userid|TODO core|MDL-62425|

||my_pages||userid|Specifically excluded but should we add metadata?|MDL-62147|

||user_preferences||userid|TODO core|MDL-62147|

||scale||userid|Needs to be done in core_grade|MDL-62147|

||scale_history||loggeduser, userid|Needs to be done in core_grade|MDL-62147|

||role_sortorder||userid|Needs to be done in core_role|MDL-62147|

||events_queue||userid|TODO|MDL-62425|

||grade_import_newitem||importer|Temporary tables only|MDL-62147|

||grade_import_values||importer, userid|Temporary tables only|MDL-62147|

||portfolio_log||userid|TODO - needs exporting|MDL-62147|

||portfolio_tempdata||userid|TODO|MDL-62147|

||backup_controllers||userid|Already done|N/A|

||grading_instances||raterid|Already done|N/A|

||task_adhoc||userid|TODO core|MDL-62425|

||chat_messages_current||userid|TODO|MDL-62147|

||chat_users||userid|TODO|MDL-62147|

||forum_queue||userid|TODO|MDL-62147|

||enrol_flatfile||userid|TODO|MDL-62426|

||enrol_lti_users||userid|Already done|N/A|

||block_recent_activity||userid|TODO|MDL-62147|

||tool_policy_versions||usermodified|TODO|MDL-62433|

||logstore_standard_log||userid|Incorrect name|MDL-62147|",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62157,GDPR Export my personal data gives an empty zip-file to an user with no files/information,"Hello,



export my personal data gives an empty zip-file to an user with no files/information. We have tried on Moodle 3.3.5+ (Build: 20180421) and Data privacy adtool_dataprivacy 33.0.0 (2017051500)",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62162,$PAGE->context was not set error when accessing to policy/viewall.php,"Juan has discovered the following while adding support to the tool_policy for the mobile app. When accessing to /admin/tool/policy/viewall.php page, the following error is displayed:

{code:java}Coding problem: $PAGE->context was not set. You may have forgotten to call require_login() or $PAGE->set_context(). The page may not display correctly as a result

line 493 of /lib/pagelib.php: call to debugging()

line 1544 of /lib/pagelib.php: call to moodle_page->magic_get_context()

line 677 of /lib/pagelib.php: call to moodle_page->initialise_theme_and_output()

line 864 of /lib/pagelib.php: call to moodle_page->magic_get_theme()

line 161 of /admin/tool/policy/classes/api.php: call to moodle_page->get_renderer()

line 57 of /admin/tool/policy/classes/api.php: call to tool_policy\api::list_policies()

line 73 of /admin/tool/policy/classes/output/page_viewalldoc.php: call to tool_policy\api::list_current_versions()

line 57 of /admin/tool/policy/classes/output/page_viewalldoc.php: call to tool_policy\output\page_viewalldoc->prepare_policies()

line 37 of /admin/tool/policy/viewall.php: call to tool_policy\output\page_viewalldoc->__construct()

{code}

",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62167,Implement core_privacy for core_badges,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62169,Implement core_privacy for mod_assignment,Implement core_privacy for mod_assignment.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62175,Web Service auth_email_signup_user is not setting correctly the policyagreed to 1,"MDL-61477 introduced a change in the external function core_auth_external:email_signup_user to replace the old if !empty($CFG->sitepolicy) check with the new privacy manager defined check. The problem is that was replaced incorrectly with the negative check so now is behaving contrary to expected.



See https://github.com/moodle/moodle/commit/1727c939ba2a9498aaa2caf438f243860f54dd23#diff-44dd56610fe1e6bbff0776a368da5cbaL290",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62197,Data Privacy: Order of entries in requests overview and paging and...,"The data request table has no order option. The standard order sets completed entries on top. The standard order should be that all pending and not completed requests are on top. 

The ordering structure should be the same for the users and the DPO page.



As far as we could see there is no paging for this page. In large systesm over time a long list of entries will appaear. Then paging makes much sense.



The data request entry is a new private data set. Its not possible in the moment to delete such entries.



If there are a lot of entries it should be possible to search for a user or by date",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62202,Confusing Privacy and policies settings move,"As noticed on the [QA testing site|https://qa.moodle.net/]:

# Log in as admin and go to 'Policy settings'

# Set the site policy handler to tool_policy and save changes.



Expected result: Privacy and policies settings pages remain in the same place in the Site administration (under Language in the Site administration tab).



Actual result: You have to be very observant to notice that Privacy and policies is now a new tab in the Site administration!



If you set the site policy handler back to default (core), the Privacy and policies settings pages go back to their original location in the Site administration (under Language in the Site administration tab).",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62208,Implement core_privacy for core_fileconverter,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62209,Data requests should be sorted by ascending status and request date,DPOs should see data requests in FIFO order. Seeing data requests piled at the bottom of the list is not a very good user experience.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62211,"Data requests page is not paginated, filtered, or sorted","The data requests page should at least be paginated as the list of requests could grow to a huge number. 

Filtering by status would be a bonus.

Needs to support:

# filter by status

# sort by date

# sort by status

# 



",1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62214,Implement core_privacy for tool_messageinbound,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62218,Implement core_privacy for core_analytics and machine learning backend plugins,Implement core_privacy for core_analytics and machine learning backend plugins,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62222,Move recordset_loop_and_export to one location as a helper,We are copying + pasting the same code in a lot of places. This is a handy function and could be used by third-party devs etc.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62224,The RSS subsystem incorrectly implements \core_privacy\local\request\plugin\provider,"It will make no difference, for now. However, we should fix this now rather than wait for it to explode.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62228,Remove the unnecessary emptiness check in delete_data_for_all_users_in_context(),"In almost all implementations of delete_data_for_all_users_in_context, the first thing that comes is:



{code}

if (empty($context)) {

return;

}

{code}



However, if _$context_ was empty the type declaration would fail. Therefore, there is no need for the above check.



It seems that everyone is copying the same mistake, so it is better to clean up the code as soon as possible before almost all 3rd party devs do the same.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62231,Implement providers for block_recent_activity,Attempt to write block_recent_activity providers for the in-progress SAR API.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62235,Implement core_privacy for core_files,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62236,Implement core_privacy for core_webservice,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62240,Export fails if some of the paths has more than 255 characters,"When some of the contexts, such as a Course name or a Category name, have 255 characters (the maximum allowed), the export privacy data process fails:





{code:java}

PHP Warning: mkdir(): File name too long in xxxx/moodle/lib/setuplib.php on line 1481

{code}

",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62248,Implement core_privacy for core_block,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62249,Revisit the privacy provider of block_tag_flickr,"This block requires configuration (preferred tags, ...) which could be seen as user information, and that information is shared with an external system.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62252,User picture visibility,"Within the new GDPR it's necessary to give students the possibility to hide their user picture for other users; only teachers who actually teach this students should have the right to view the profile picture.



At the moment there is only one(as far as I know) setting: the right to upload set pictures or not.



I think it would be a great improvement to add 3 things:

-add the right to change the profile picture(set to different roles, not depending on the upload-right)

-add the possibility for a user to define whether his/ her user picture can be seen in 'general pages'(not course related, so for authenticated users in general)

-add the possibility for admin to define witch roles a student can exclude from seeing his/ her profile picture; the user should then be able to define in the profile page (privacy settings) to define some roles from this list.Of course, a user can have different roles, so this profile-setting should only have effect in courses where he or she is enrolled as student.",0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62253,Implement core_privacy for core_auth,See summary.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62257,Implement core_privacy for mnetservice_enrol,Implement core_privacy for mnetservice_enrol.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62263,Implement core_privacy API for core_access,Implement core_privacy for core_access,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62264,Implement core_privacy for mnet,"Implement core_privacy for mnet, will be probably a null_provider.



DB Table mnet_sso_access_control is not needed declare and export. The field username isn't linked to any table. This field is used to allow or deny specific access to a user with this username. But it doesn't created a link with the user.

* auth_mnet implements:

** DB Tables, mnet_session and mnet_log.

* mnetservice_enrol implements:

** DB Table, mnetservice_enrol_enrolments



",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62266,Implement core_privacy API for core_availability,Implement core_privacy for core_availability,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62269,Implement core_privacy for auth_mnet plugin,"In recent versions, data is not being stored in the table mnet_log, but it can store data from a previous Moodle version upgraded.



Table mnet_session only stores data temporarily, so it's not necessary to export this data.



It's necessary:

* declare mnet_session

* declare and export mnet_log



To improve the PHP memory usage, the export creates a file for every external system/course set.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62270,Cron task fails on data privacy related task when admin directory renamed,"If admin directory is renamed to something else, cron tasks:



1. _initiate_data_request_task.php_ fails. The reason: fixed path (.../admin/....) to php script instead of using \{$CFG->admin} in line 57.



2. _process_data_request_task.php_ fails. The reason: fixed path (.../admin/....) to php script instead of using \{$CFG->admin} in line 60.



In the result personal data export request can't be approved (still are ""Pending"")







Now we have error 'PHP Fatal error: require_once(): Failed opening required '.../admin/tool/dataprivacy/lib.php' in log..



No error should occur in log and requests' statuses should be changed to ""Awaiting approval"". 











",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62281,Empty row being shown in user's policies page,"To reproduce:

# Log in as admin.

# Go to ""{{Site administration / Privacy and policies / Manage policies}}""

# Create a policy, Policy 1. Make this policy active.

# In another browser session (e.g. incognito), log in as a user s1 and agree to this policy.

# Back to the admin's browser, deactivate Policy 1

# Create another policy, Policy 2. Make this policy active.

# In s1's browser, log out, then log in again.

# Agree to Policy 2.

# Go to your profile page and click ""{{Policies and agreements}}""

# *Expected:* You should only see Policy 2 listed on the table and there shouldn't be a blank row.

# *Actual:* There is a blank row

!user-view.png|thumbnail!",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62286,Add policy link to the site footer,"Anywhere in the site the policy statements need to be linked from the site footer (accessible for everyone on the landing page, or in the site as a guest, or as an authenticated user). For both Boost and Clean themes.

# Add a single link called Policies to the site footer

# Clicking on that link should go to a publically available page on the site (i.e. you dont need to be logged in to access this page).

# This page should display a linked index listing each *active* policy \{NAME,TYPE} [Link to text]

# Clicking each link will navigate the user to the policy summary text and full text below it.

# Draft or inactive policies are not shown







E.g. 





h1. Policies

# \{Privacy policy name, Privacy policy} [link to overall privacy policy below]

# \{Site policy name, Site policy} [link to site policy below]

# \{3rd party policy name, 3rd Party [policy] [link to 3rd party policy below]





h2. Overall privacy policy



Summary



INSERT SUMMARY TEXT



Full policy



INSERT FULL POLICY TEXT





h2. Site policy



Summary



INSERT SUMMARY TEXT



Full policy



INSERT FULL POLICY TEXT",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62289,Expired users deletion process should include a call to core_privacy\manager::delete_data_for_user,"Reading some feedback after a reply I've noticed that we are calling delete_data_for_all_users_in_context instead of delete_data_for_user. It should be ok to call delete_data_for_all_users_in_context providing a context_user, but we should also call delete_data_for_user.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62291,Confusing Data Protection Officer role mapping setting,"If you create a role with capability 'tool/dataprivacy:managedatarequests' then the name of the role appears in the Data Protection Officer role mapping box.



It's confusing because the default is 'None', yet the setting doesn't have an option 'None'.



!dpo role mapping setting.png!



It's also confusing because although it appears that the role with capability 'tool/dataprivacy:managedatarequests' is selected as Data Protection Officer role mapping, you actually have to click to select it and then save changes.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62299,admin/tool/dataprivacy/mydatarequests.php for admin shows other user requests,"Was testing MDL-62167 when I saw that the {{admin/tool/dataprivacy/mydatarequests.php}} page (linked @ profile page) show too many requests for the admin user. Plus all them are downloadable.



Not sure if that's the correct approach (I bet no, because that page is to show only OWN requests and doesn't show user names).



So, reporting it. In that page, each user, their own. And nothing else. There is the other {{admin/tool/dataprivacy/datarequests.php}} page to manage everyone's requests.



Or I'm missing something. Ciao :-)",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62306,Privacy: refactor user profile field providers to properly define the subsystem plugintype relationship,"This issue is born more out of time restrictions than anything else. Basically, the collection of issues dealing with profile field providers (MDL-62007, MDL-61993, MDL-62030, MDL-62032, MDL-62046) are generating correct results, and have (or soon will) land, despite having defined the providers as plugin providers which define the user_info_data table in their get_metadata methods. After some discussion, and based on our assessment of an issue of similar nature (MDL-61937), we think the correct approach is as follows:

# A shared provider interface for userprofilefields plugintypes should be created in core_user (profilefield_provider for example)

# core_user should be changed, so that it's the one reporting the user_info_data table in it's get_metadata method.

# The providers for each profilefield plugin should implement the interface defined in core_user. They will essentially be null_providers AND profilefield_providers, as in MDL-61937.

# Modify the core_user provider so it calls the relevant profilefield provider methods during export",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62308,Implement provider for core_backup,Yeh.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62309,"Make site policies required or optional, distinguish on ""User acceptances"" page whether consent was not yet given or refused","In the policy tool it is not possible to withdraw a consent. It is also not possible to enter the site without consent. So to give consent in the current case is always compulsory. This goes against the spirit of GDPR



In some cases, consent is compulsory to offer a certain service (e.g. education), but in other cases not, e.g. share e-mail adres with other users, share pictures on Facebook, share address with classmates or all Moodle and non-Moodle related consents that fit under GDPR in an organisation. Organisations need a way to organise all their user consents and the policy tool is a great start for that. 







From https://eur-lex.europa.eu/legal-content/EN/TXT/HTML/?uri=OJ:L:2016:119:FULL&from=EN





|(32)|Consent should be given by a clear affirmative act establishing a {color:#ff0000}freely given{color}, specific, informed and unambiguous indication of the data subject's agreement to the processing of personal data relating to him or her, such as by a written statement, including by electronic means, or an oral statement. This could include ticking a box when visiting an internet website, choosing technical settings for information society services or another statement or conduct which clearly indicates in this context the data subject's acceptance of the proposed processing of his or her personal data. Silence, pre-ticked boxes or inactivity should not therefore constitute consent. Consent should cover all processing activities carried out for the same purpose or purposes. When the processing has multiple purposes, consent should be given for all of them. If the data subject's consent is to be given following a request by electronic means, the request must be clear, concise and{color:#ff0000} not unnecessarily disruptive to the use of the service for which it is provided{color}.|



{color:#333333}See also https://moodle.org/mod/forum/discuss.php?d=369844{color}",0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62310,Implement the privacy provider for core_admin,"Implements Null Provider.

Also, these are all core subsystems and we'll implement them in other issues.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62315,Implement provider for core_form,There are user preference sin filemanager.js. Check to see if they're handled elsewhere or not (such as files).,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62318,Implement providers for core_group,Attempt to write core_group providers for the in-progress SAR API.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62320,Enable JSON mime type by default to avoid loose the extension with long filenames,"While preparing the unit tests for MDL-62240 I've realised that JSON is not enabled by default. That means that, when exporting data, the extension is lost if the file exceeds the long limit, because JSON is not in the mime types list (so it's not treated as an known extension).



We should add JSON to the default mime types list now that we're using for the privacy export (to make sure all the files preserve the .json extension).",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62326,Implement core_privacy for core_antivirus,This was missed in MDL-61818 ;(,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62338,Backup provider located in weird location,Due to autoclass loading (see fetch_subsystems() in lib/classes/component.php) the provider was put in \{\{backup/util/ui}}.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62339,Purpose of summary in tool_policy,"In the Privacy Plugin, the user agrees with the policy.

I'm confused with the functionality of ""summary"" and the complete description. 

The complete description is always shown. How come?

Can this be hidden?",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62340,If backup data contains information of a user that has asked to be deleted we should not restore it,"The core_backup provider implemented in MDL-62308 does not actively remove user data from the backup (because that would be insane), so when restoring these backups we should ignore users who dont want to be remembered.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62341,Add back button from viewall policies page,A link to the admin/tool/policy/viewall.php page has been added to the footer. We should add a back button to let users to go back to the previous page.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62342,Use the singular/plural form of the labels when revoking/consenting policies on behalf of a user,"In the ""User agreements"" page, if we're revoking/consenting to only a single policy or user, use appropriately the singular/plural form of the labels.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62343,"Add a link from ""Policies and agreements"" page to the Privacy officer contact form","Add a link that will allow the user to contact the data protection officer from the ""Policies and agreements"" user's profile page, instead of displaying only a message.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62351,Validate subsystem in link_subsystem,"I noticed that blog privacy provider calls

{code}

$collection->link_subsystem('core_comments', 'privacy:metadata:core_comments');

{code}

where the correct name of the component is 'core_comment'. 



We need to fix it, look for other mistakes, add validation and/or unittests",1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62356,enrol_meta to export/delete groups,enrol_meta privacy provider should also export and delete the group memberships it is responsible for.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62357,enrol_cohort to export/delete groups,enrol_cohort privacy provider should also export and delete the group memberships it is responsible for.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62363,Followup: Revisit portfolio to determine which modules should link to it via link_subsystem,"We currently don't link_subsystem to portfolio anywhere, and we should be doing this in places that use portfolio.



-Additionally, MDL-61814 changed the portfolio provider to a plugin\provider, when in fact this should have been a subsystem\provider, so this should be changed too. This change won't affect anything, as both interfaces extend the same base core_user_data_provider, so should be a one line change.-",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62370,Subsystems without directories should not be flagged in plugin registry,"We still flag components which don't have any directory in the plugin registry.

Let's either go for the simple approach of not even listing them, or use a generic string to say that they don't contain data.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62373,Confusing contact DPO modal window,"Because of the way the contact DPO modal window is laid out, the text reads 'Reply to Message', which is very confusing for a user who has just clicked the link 'Contact Data Protection Officer'.



I'm wondering why the user's email address is shown at the top, and whether it could be removed?



Other possibilities would be to add some space between the email address and the text box and move the labels 'Reply to' and 'Message' closer to the email address and text box.



!contact dpo modal.png!",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62378,Error when exporting competencies from the Privacy API,"*Steps to reproduce:*

# Download the CSV with the competency framework ""Australian Curriculum - Science F-10"" from [https://moodle.net/mod/data/view.php?d=12&rid=608]

# Login as admin

# Access to ""Site administration | Competencies | Import competency framework""

# Import the CSV file downloaded previously.

# Use the script ""Test of exporting user data"" from [https://docs.moodle.org/dev/Privacy_API/Utilities#Test_of_exporting_user_data] for exporting the data of your site.







*Expected result*



No errors should be displayed.



*Current result*



The following error is thrown:





{code:java}

Processing export for User Admin

Default exception handler: Exception - Argument 1 passed to core\external\exporter::export() must be an instance of renderer_base, instance of bootstrap_renderer given, called in [dirroot]/competency/classes/privacy/provider.php on line 1869 Debug: 

Error code: generalexceptionmessage

* line 120 of /lib/classes/external/exporter.php: TypeError thrown

* line 1869 of /competency/classes/privacy/provider.php: call to core\external\exporter->export()

* line 1552 of /competency/classes/privacy/provider.php: call to core_competency\privacy\provider::transform_framework_brief()

* line 1592 of /competency/classes/privacy/provider.php: call to core_competency\privacy\provider::core_competency\privacy\{closure}()

* line 645 of /competency/classes/privacy/provider.php: call to core_competency\privacy\provider::export_user_data_frameworks_in_context()

* line 447 of /competency/classes/privacy/provider.php: call to core_competency\privacy\provider::export_user_data_in_system_context()

* line 221 of /privacy/classes/manager.php: call to core_competency\privacy\provider::export_user_data()

* line 76 of /mdkscriptrun..php: call to core_privacy\manager->export_user_data()

!!! Exception - Argument 1 passed to core\external\exporter::export() must be an instance of renderer_base, instance of bootstrap_renderer given, called in [dirroot]/competency/classes/privacy/provider.php on line 1869 !!!

!! 

Error code: generalexceptionmessage !!

!! Stack trace: * line 120 of /lib/classes/external/exporter.php: TypeError thrown

* line 1869 of /competency/classes/privacy/provider.php: call to core\external\exporter-&gt;export()

* line 1552 of /competency/classes/privacy/provider.php: call to core_competency\privacy\provider::transform_framework_brief()

* line 1592 of /competency/classes/privacy/provider.php: call to core_competency\privacy\provider::core_competency\privacy\{closure}()

* line 645 of /competency/classes/privacy/provider.php: call to core_competency\privacy\provider::export_user_data_frameworks_in_context()

* line 447 of /competency/classes/privacy/provider.php: call to core_competency\privacy\provider::export_user_data_in_system_context()

* line 221 of /privacy/classes/manager.php: call to core_competency\privacy\provider::export_user_data()

* line 76 of /mdkscriptrun..php: call to core_privacy\manager-&gt;export_user_data()

!!

{code}





",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62383,Recordset not closed in \core_privacy\local\request\contextlist::add_from_sql(),The $contexts recordset is not being closed after processing.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62384,Performance fixes for some providers,"We've discovered some issues due to joins which don't scale well with large numbers of records.



The one which we discovered this with is assign and it's because the query planner in some engines doesn't deal well with joins where the filter is only in the WHERE (when it should be on the JOIN).



Thankfully this only effects providers, and only those which do complex joins, and thankfully these are mostly extremely well unit tested now.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62388,Sensitive personal data processing reasons can not be removed once added,There must be a !empty thing around that should probably be refined.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62389,New user accounts can't be created when force auto guest login,"When the ""Policy (tool_policy)"" is set as default site handler, there is at least one active policy, the site is configured to allow self-registration (for instance using the ""Email-based self-registration"") and the following parameters are enabled:

* Auto-login guests (autologinguests)

* Force users to log in (forcelogin)



users can't create new accounts. The following error is displayed: ""No permission to agree to the policies"".



",1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62391,Add information on requests details and table about who made the data request,"It would be useful to show who's created the data request, especially when the request was made by a user on behalf of another user (e.g. parent, DPO).",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62393,Random unit test failures with core_message provider testcase,"This was noticed on integration testing runs. [see here|http://ci7.stronk7.com:81/job/20.%20Run%20phpunit%20UnitTests%20PostgreSQL%20%2833_STABLE%29/865/console]. 

{code:java}There was 1 failure:



1) core_message_privacy_provider_testcase::test_export_for_context_with_messages

Failed asserting that two strings are equal.

--- Expected

+++ Actual

@@ @@

-'Yes'

+'No'{code}

Looks to be an ordering issue, as it seems $m1, $m2 and $m3 are coming back in the wrong order. Looking at the provider, it does seem to be ordering the messages, so perhaps the issue lies with the get_data call? Not 100% sure.



Additionally, the variables $m7, $m8 and $m9 aren't used in that test and should be removed.



Tagging as all branches in case.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62395,Review and fix the display of tables in tool_dataprivacy,"Changes in Boost 4.0 migration could be affecting the display of the tables in tool_dataprivacy (e.g. the purposes table).



We need to identify these tables and fix accordingly.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62396,Remove button overlaps when Purpose title is too long,"# Go to the ""data registry"" (you can search for it in site admin)

# Select ""Purposes"" from ""Edit"" drop down

# Purposes table SHOULD look ok

# Add ""Sensitive personal data processing reasons"" to a purpose and save changes

# Return to the purpose edit form, remove the ""Sensitive personal data processing reasons"" you added before and save changes

# The ""Sensitive personal data processing reasons"" you previously added SHOULD NOT be there anymore",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62397,Data exporter does not recover from failure,"# Start export

# Kill export mid-process

# re-run adhoc task

# Adhoc task errors about an in-progress task and exits



Essentially we have a double lock which breaks things. Easy fix.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62399,"Export files that ""belong"" to user in different file areas based on userid field in files table","Came up during testing of MDL-61976 for files uploaded to mod_wiki but it can also be present in other areas. 

Files table stores userid which is not displayed anywhere (only ""Author"" text field is displayed and only when managing files in this area). We do not export these files based on userid



There are no methods in files api or privacy api that would retrieve files by userid



Example of scenario:

- I, as a teacher, edited course summary and embedded files

- these files have my userid in the database

- the text of the course summary does not have my userid and is not exported as part of my data

- as a result these files are never exported to me



same with activity descriptions, question texts, feedback questions, and all other places where users (usually teachers) embed files into content that is not owned by them



wiki:

- there is a capability to ""Manage wiki files"" directly

- I can upload files directly to collaborative wiki without having any revisions to the page

- wiki will not show these files as belonging to me or authored by me

- wiki will not be exported to me because it does not have my revisions (currently)

- tester expects that the files I uploaded will be exported



In 99% cases these files should not be deleted though",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62413,User cannot cancel the data request made for them,"Users should be able to cancel data requests that were made for them. After all, it's their personal data.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62414,User selector should be only shown for user's children when making personal data requests (mydatarequests.php),"When a DPO is creating personal data requests (in mydatarequests.php), the user selector should only show users that the DPO is a parent of.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62418,Consent page hasn't blocks with Clean theme,"[~stronk7] has discovered it while reviewing the ""Agree on behalf of another user as a manager, single policy, javascript on"" behat test (which is failing because of this with the *clean* theme).



*Steps to reproduce (with CLEAN theme):*

# Login as admin.

# Go to ""Site administration / Users / Privacy and policies / Policy settings""

# Set the site policy handler to ""Policy (tool_policy).

# Access to ""Site administration / Users / Privacy and policies / Manage policies"".

# Create and enable one policy.

# Edit the manager role and allow the ""tool/policy:acceptbehalf"" capability. 

# Logout.

# Login as manager.

# Read the policy text and click over Next.



*Expected result:*



The consent page should be displayed with the navigation blocks.



*Current result:*



The consent page is displayed without lateral blocks.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62420,Random fail in enrol_lti_privacy_provider_testcase,"Ordering issue in enrol_lti_privacy_provider_testcase:



{code}

There was 1 failure:



1) enrol_lti_privacy_provider_testcase::test_get_contexts_for_userid

Failed asserting that 167002 matches expected 167000.



/Users/Shared/Jenkins/Home/git_repositories/master/enrol/lti/tests/privacy_provider_test.php:87

/Users/Shared/Jenkins/Home/git_repositories/master/lib/phpunit/classes/advanced_testcase.php:80



{code}",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62421,logstore_standard provider names incorrect table in metadata,Names {{log}} instead of {{logstore_standard_log}}.,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62422,user_preferences table missing from core_user metadata,Should have been included but was missed.,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62423,scale and scale_history missing in core_rating,These were missing in the implementation of {{core_rating}},1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62424,role_sortorder missing from core_role provider,Not mentioned in metadata. Probably no need to export.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62425,Implement core provider,"One area which we've missed is {{core}} - as in, {{lib/classes}}.



We need to:

* include this in the list of components returned in {{privacy\classes\manager.php::get_component_list}}

* update the plugin registry to use this

* implement the provider



Tables to include:

* {{config_log}}

* {{upgrade_log}}

* {{task_adhoc}}

* {{events_queue}}",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62426,enrol_flatfile implements wrong provider,"It has the {{enrol_flatfile}} DB table







I ran the enrolment flatfile scheduled task, and confirmed that indeed the entry persists in the table beyond the run time of the task. I'd expect to allow for future enrolments to be triggered. You need a future date for this to occur.



If there's any data sitting in the table after a cron run completes, then we should be reporting this as it's more than just temp data in such cases.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62427,mod_forum implementation does not check that the coursemodule matches.,"If the forum is removed between {code}

PHP Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 760



Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 760

PHP Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 761



Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 761

PHP Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 762



Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 762

PHP Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 769



Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 769

PHP Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 777



Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 777

PHP Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 781



Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 781

PHP Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 782



Notice: Trying to get property of non-object in /home/marina/repositories/int_master/moodle/mod/forum/classes/privacy/provider.php on line 782

{code}",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62430,Some plugins do not check that context in delete_data_for_all_users_in_context() is correct context for them,"Method delete_data_for_all_users_in_context() from ALL providers is called when context expires. Some plugins have insufficient checks on contextlevel and some modules do not check that this is a module of the given type



*original description:*



I found two problems with LTI module:

1. same as MDL-62427 has in forums - delete functions do not check that module type is 'lti' . You can expire old chat module and accidentally delete recent graded lti

2. system context is added for all users and the manager always reports that there is something for lti module even when user definitely does not have anything



So far we have -



# mod_lti

# mod_choice

# mod_assign export_user_data() and delete_data_for_user()

# mod_feedback export_user_data()

# mod_glossary export_user_data(), both delete functions

# mod_lesson export_user_data() partially

# mod_quiz - doesn't skip if module not found in delete_data_for_user - will cause php exception. Also doesn't check contextlevel

# mod_scorm export_user_data()

# mod_survey doesn't skip in delete_data_for_all_users_in_context(), not a big deal

# mod_wiki export_user_data()

# mod_workshop export_user_data()



The following modules are ok:

Book (null), chat, data, folder (null), forum (MDL-62427), imscp (null), label (null), page (null), resource (null), url (null)",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62432,Quiz deletion does not check ID properly,"Mixup between quiz->id and quizobj->id

This was missed during initial dev, reviews, and testing",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62433,Add missing tool_policy_versions to the privacy provider,Pending declare tool_policy_versions table (and export/delete if needed).,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62438,Privacy: when setting retention period lang strings are set to lower case,The retention period can be set to year/month/days. The strings for 'month' and 'days' are set to lower cases.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62442,Revisit block deletion for user contexts,"Eloy has pointed out that:

# we currently do not delete blocks within a user context; and

# we should consider deleting the block instances when they are in a user context -- their existence could be considered user data.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62445,tool_privacy: export request email comes from user without a name,"I noticed the error in the cron:

{code}

Notice: Undefined property: stdClass::$maildisplay in /home/marina/repositories/mdk_master/moodle/lib/moodlelib.php on line 6091



Notice: Undefined property: stdClass::$maildisplay in /home/marina/repositories/mdk_master/moodle/lib/moodlelib.php on line 6092

{code}

Also the emails to DPO come from user without a name. 

This happens because we pass exported user object to send_message() instead of a db record from 'users' table (or userid)",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62446,Glossary module can leave orphan records behind,"When deleting the data for all users in the privacy provider, the categories and aliases for the entries won't be deleted. The _foreach_ will loop over an empty list, thus leaving the records behind.



{noformat}

// Simplified code from line 250 onwards.

$DB->delete_records('glossary_entries', ['glossaryid' => $instanceid]);

...

$entries = $DB->get_records('glossary_entries', ['glossaryid' => $instanceid]);

foreach ($entries as $entry) {

$DB->delete_records('glossary_entries_categories', ['entryid' => $entry->id]);

$DB->delete_records('glossary_alias', ['entryid' => $entry->id]);

}

{noformat}



It seems that the tests do not check the deletion of those related records.



Also to consider: using _get_in_or_equal_ instead of _foreach_.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62449,SCORM privacy provider should export also information such as name or intro,"The privacy export provider for the SCORM activities is not exporting any basic data, like name or intro. 



We should add a data.json file with this data, to give the user more information about the SCORM activity.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62456,The mod_lti privacy provider should link external,"Shouldn't mod_lti define a link_external_location in get_metadata for the user info it sends on LTI launch? In particular, see lti_build_request function.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62460,User ID being displayed when data request creation for others fails validation,"To reproduce:

# Login as admin/DPO

# Go to ""{{Site administration / Users / Privacy and policies / Data requests}}""

# Create a data request for s1.

# Try to create another data request for s1.

# *What happens:* Validation fails as expected, but the displayed selected option in the autocomplete element becomes the user's ID instead of the name and email.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62461,Create Behat tests for the data privacy tool,"Due to time constraints, we were unable to write Behat tests for the tool! (Sorry!)



I'm gonna list the things in the tool that might need Behat coverage so we can identify which ones still need to be covered. 

||Section||Description||Done?||

||Data requests|Contacting the privacy officer| (/)|

|| |Marking enquiries as complete| !https://tracker.moodle.org/images/icons/emoticons/check.png|width=16,height=16!|

|| |Data export request creation| (i)|

|| |Data export request approval| (i)|

|| |Data export request rejection| |

|| |Data export request expiry| (i)|

|| |Data deletion request creation| (i)|

|| |Data deletion request approval| (i)|

|| |Data deletion request rejection| |

|| |Data request listing, pagination and filtering| |

||Data registry|Data registry tree navigation| |

|| |Creating categories|!https://tracker.moodle.org/images/icons/emoticons/information.png|width=16,height=16!|

|| |Listing categories|!https://tracker.moodle.org/images/icons/emoticons/information.png|width=16,height=16!|

|| |Updating categories|!https://tracker.moodle.org/images/icons/emoticons/information.png|width=16,height=16!|

|| |Deleting categories|!https://tracker.moodle.org/images/icons/emoticons/information.png|width=16,height=16!|

|| |Creating purposes|!https://tracker.moodle.org/images/icons/emoticons/information.png|width=16,height=16! |

|| |Listing purposes|!https://tracker.moodle.org/images/icons/emoticons/information.png|width=16,height=16! |

|| |Updating purposes|!https://tracker.moodle.org/images/icons/emoticons/information.png|width=16,height=16!|

|| |Deleting purposes|!https://tracker.moodle.org/images/icons/emoticons/information.png|width=16,height=16! |

|| |Setting defaults| |

||Data deletion|Listing and filtering contexts to be deleted| |

|| |Marking contexts for deletion| |

||Plugin privacy registry|Page display| |



Legend: (/) = Done, (i) = In progress / Soon",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62463,Glossary data privacy export isnt correctly matching glossary modules,The query used by mod_glossary' export_user_data func is not correctly limiting its context to glossaries - its simply matching on the cm.id = context.instanceid - this means it ends up joining on anything with a matching instance id. It also doesnt match the glossary to the correct cm record.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62471,Failing tool_dataprivacy_expired_contexts_testcase::test_expired_course_related_contexts in windows + oracle,"I bet that the important bit is that it is a 32 bit server. I don't even know if it was until [~jpataleta] confirms it, but I bet $5. The failing test use a 1000 years retention period :)",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62474,Fix Boost privacy provider,"The Theme Boost privacy provider indicates that the Boost doesn't store any user data, but the Theme stores a user preference data, the: *drawer-open-nav*",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62479,Add filtering to the Plugin privacy compliance registry,"At the moment the privacy compliance registry is serving an important function in being part of the report which shows the user data that is stored in Moodle and the reason for its storage.



That being said, it would be nice if we could filter the page to show which components are not compliant and need attention.",0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62489,Plugin Privacy registry: Add search option for this lengthy page,"Great overview.



We should give the user a search option to the elements of the page. Most user will not know exactly what type of plugin he is searching for, but he knows the name of an element",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62491,Privacy Data Request Export Format,"The Export format is in the moment JSON. JSON is fine for data transportability but on the human readability aspect its a mess for nomal user.



My suggestion is to create an additional format html or pdf from json. This should include some basic information about the structure and type of information.







""User needs that the data export is usable by a human - so human readable - with an html index and some way of displaying index and content in a webpage.""",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62493,Policy plugin problem when Guests attempt Create Account,"We are using the tool_policy plugin on our site where we have some Guest accessible courses and found a problem when a student using Guest Access tried to Create an Account.



When students enter guest accessible course their status changes from ""Not logged in"" to ""Logged in a Guest"" and when they click a link to the Create Account (signup) page they get a message like like the one below. Unfortunately, even if they leave the browser this recurs when they return even if they go direct to Create account.



The reason for this based on some testing I have done is that the MoodleSession cookie means they come back in with Guest status based on the persisting record in mdl_sessions (if they use a different browser and go in directly to Create Account ... then it works).



I can understand why a Guest cannot agree the policies but since this is blocking their access to Create and Account this is a problem.



We need to fix this as we are losing some new accounts that people wanted to create. We are reluctant to turn-off the Policy plugin because it is exactly what we need for the GDPR deadline next week and we would have a security/compliance issue in that case.



A fix or advice on where we might be able to patch this in short term would be very welcome - thanks.



!image-2018-05-17-21-45-48-788.png!",1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62501,Add multi language support.,"International organizations or corporate often needs user information in multiple languages. GDPRS asks them to offer policy texts in easy understandable way. That includes policies in the mother language of the user



There also may be different DPO or local authorities in thecountries that should be included in the policy text.



Idea:

* Multi lang support is a seperate option that can be enabled

* For each part of the policy a multilang option offers additonal languagetext fields by selecting: additional language (pull down with languages based on the active languages in interface), new summary field, new text field, new status field.

* In reports atthe choosen language is visible",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62502,Add icons to policy aspects,"Art 12 GDPR paragraph 5 suggests to use standardised icons for several aspects from policies as described in Art 13ff. Up to now I'ven't seen any standardized icons. There are some ideas that EU commission or data protection board will suggest such icons in the near future. It would be nice that such icons can be added to the policy texts.



The icons should be visible in summary and full text.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62504,GDPR Data Requests page needs order by date,"Hello,



admin/tool/dataprivacy/datarequests.php for Data Proection Officer is a mess, requests should be in date order (newest first/top part of the page) at the moment they seem to be in order they have been made by. 



Tested on Moodle 3.3.6 and Data privacy, tool_dataprivacy 33.6.0 (2017051513)











!mess.png|thumbnail!",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62507,privacy.php export_user_data functions are using hard coded language labels,"While working on my own privacy.php files, I realized that all the new Moodle 3.5, 3.4, 3.3 privacy.php files I have looked at for examples, are using hard code language in the labels for data being exported, in the export_user_data functions. Shouldn't they be using strings in the language files for each plugin?",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62511,Control availability of SAR downloads,"Some users have expressed a requirement to be able to control access to the generated SAR download.



In some cases users will still be able to make a request themselves, but not able to access the generated file via Moodle (e.g. if some additional processing is required).

In other cases all SARs will go via a DPO.



Note: Some of these solutions will be solved by the authoring of web services in MDL-61653.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62516,Request to delete forum data for a user will delete files of all users,"The GDPR privacy provider for mod_forum will delete the files in the 'post' file area for *all* users when a request is made to delete data for a *single* user.



At the end of the delete_data_for_user function, it simply calls:



{code:php}

$fs->delete_area_files($context->id, 'mod_forum', 'post');

{code}



This will delete files for all posts in that forum, not just ones from that user. It also doesn't appear to touch the 'attachment' file area at all, which it should.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62526,Ask agreement to moodle.net privacy policy during registration or upgrade,"Ask agreement to moodle.net privacy policy during registration or upgrade



See also MDLSITE-5464",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62535,Rubrics do not consider the fillings table,"As pointed out by Marcus Green, {{gradingform_rubric}} does not consider its {{gradingform_rubric_fillings}} table as having any personal data.



Although the table has no userid, it has an itemid which relates to the gradeitem id, which is linked to a user.

The fillings table includes details of the level and any remarks.



https://moodle.org/mod/forum/discuss.php?d=370983#p1495800



It may be that we can do something generic which covers all grading methods. Although I can see a get_rubric_filling() function, the only accessible description of this comes from get_external_instance_filling_details, which is aimed at web services.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62544,Allow admins (and DPOs) to make subject access requests on behalf of users,"If the {{contactdataprotectionofficer}} config option is disabled, users are not allowed to make subject access requests (SARs) on their own. However, neither are admins: If I click on ""New request"" in \{\{admin/tool/dataprivacy/datarequests.php}}, the next page will throw a notice: ""Please contact the Data Protection Officer as described in the privacy policy.""



*Expected behaviour*



As an administrator or DPO I am allowed to create SARs on behalf of a user, even if site config prohibits this for regular users.



Otherwise, administrators and DPOs will be unable to comply with SARs that will be received via other channels.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62546,Scripts in HTML of Privacy Policy notices are cleaned - but we need to use them,"Our organisation use the [iubenda|https://www.iubenda.com/en/] tool for creating and hosting the corporate privacy policy. Our DPO would like us to include the policy by reference to ensure alignment. Unfortunately, when we attempt to include using the required methods the script or frame is removed by the clean_text function.



This occurs although we have enabled trusted content and the same script works fine in other similar HTML editor form fields.



I succeeded enabling script content to be created, saved and rendered by patching a local copy of policy_version_exporter.php (see below). However, this is still cleaned when next editing the policy so clearly there is somewhere else this is happening that I have not identified.



More generally, I would expect this field to permit retention of trusted text if the system is configured to support this.



Anyway here is the change I made which fixed part of the issue ... green text added. Same change also made in get_format_parameters_for_content()



protected function get_format_parameters_for_summary() \{

return [

'component' => 'tool_policy',

'filearea' => 'policydocumentsummary',

'itemid' => $this->data->id{color:#14892c},{color}

{color:#14892c} 'options' => ['trusttext' => true,'noclean' => true{color}]

];



It you agree trusted text should be supported it would be good to see a more general change made that enables this.



Otherwise I would be grateful, it you could point to where we should patch to also prevent the clean_text deleting on opening the record in the editor. Thanks.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62548,Need to scroll through privacy policy two times before accepting,"When the privacy policy is displayed to a user who has not yet accepted the policy is first displayed with a Next button at the end but no acceptance checkbox. So the user has to scroll to the end of the policy find the Next button and click it.



When the user clicks Next, the privacy policy is displayed again. Exactly the same except now there is an acceptance checkbox just above the Next button. So provided the checkbox is ticked before Next is clicked it works as expected.



It seems a pity to make people go through the scroll to the bottom twice, so I wonder whether the checkbox should / could be displayed the first time the policy is displayed. That would mean just one scroll through the policy, check the box click next and it is done.



We only have one privacy policy and acceptance is required for logged in users so this is the same policy each time. Also to be clear it is not a result of clicking the full text option.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62552,Allow devolved selection of purposes and categories,"Many sites will have multiple DPOs who are responsible for a subset of the site and we should improve the privacy tool to better facilitate this.



One solution I have been considering would be to create new capabilities for creating purposes, selecting a purpose + category, suggesting a purpose + category.



If a user has permission to select a purpose and category then they can choose the configuration for anything they are involved with.



If a user only has permission to suggest a purpose, then they can make suggestions but these must be confirmed by the DPO before becoming active.



I suspect that these would be system level capabilities, and the user would therefore be able to make suggestions and selections at any point that they can already edit.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62554,Add ability to configure data registry to use module type defaults,"E.g. all mod_assign should have a purpose of X, rather than default to the context_module purpose.







The admin needs to be able to select category and purpose for activity / module types. This is needed on every type of course related activity independent of the others. As for example, assignments may need a different retention rule than forum posts or glossary comments.



Create interface that enables category and purpose be set per feature rather than through the context part.



Links:

# Whiteboard sketches: https://projects.invisionapp.com/boards/RF3OZ7ZWCTP/

# Mockup: https://projects.invisionapp.com/share/9MNIAQEX8Z4#/screens/314512878_Set_Defaults_2a",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62555,Make data registry available to users,"Minimum data:

* this is an assignment

* Its purpose is [X]

* It's retention period is [Y]

* etc.



Decide whether to show to public, logged-in only, or only when viewing the activity, or some other time?



Consider: 

* The admin needs to be able to pull an isolated report that lists all data types, their processing, and their retention period, category etc.. Into one CSV report that can be given to a user.

* Any user should be able to request the database information type request (rather than content) to get this report automatically through the contact the DPO dropdown.



Whiteboard sketch: https://projects.invisionapp.com/boards/MT3OZ7ZCDEU/",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62556,Export data in plugin registry in SAR,"Include the base data (purpose, category + retention in SAR export.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62557,Make plugin registry available more publicly,Plugin registry is a read-only report listing the fields and how they can be used.,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62558,Provide a summarised (read-only) view of the data registry configuration,"Provide a read-only view of the data registry including fields such as:

* path

* purpose

* category

* retention

* legal bases



This should be a useful summary (define what we mean by this).



Consider: 

* The admin needs to be able to pull an isolated report that lists all data types, their processing, and their retention period, category etc.. Into one CSV report that can be given to a user. 

* Any user should be able to request the database information type request (rather than content) to get this report automatically through the contact the DPO dropdown.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62559,Look at support for rolling deletion,"Requirements analysis required to:



We need to consider how we could handle rolling deletion.



This includes:

* content such as messages; and

* courses with no end date.



We may also want to look at courses which have not had any 'activity' for a long period but have no end date (possibly using logs?).

Possibly list all content by course start date?

Logs can be an _indication_ but not a decision.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62560,Support different retention for different roles in a purpose,"Add support for different retention strategies for different user roles.
In some institutions the content created by staff is considered to be 'owned' by the institution and not the individual.

In these cases, there may need to be a longer retention policy applied for staff than to students.

This issue seeks to extend the existing privacy API in order to add new data deletion strategies for _rolling_ deletion.

This will be achieved by:

* adding a new 'purpose override' such that a role can be allocated a different retention policy for any data retention purpose;

* adding a new Provider interface to provide:

** a function to fetch the list of users in a location in order to filter the users by role

** a function to delete a set of users in a context

* updating the current rolling expiry system to support this new functionality.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62561,Requirements analysis: Alternative to course end date when calculating retention,"Consider: 

* Admin needs the retention periods to be dependent on when content is created, not a course date which mostly in moodle sites isnt set, and may never be set.



Other possibilities include:

* examine logs for activity (not necessarily reliable)

* add a log event watcher which updates a course field (only suitable for data going forward)

* per-activity calculation (e.g. assignment due date, quiz close date, etc).



Potential issues:

* logs are not guaranteed

* does the act of viewing the course extend its lifetime (Heisenburg)",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62562,Requirements analysis: Allow support for plugins to define a default policy,"This may be required for certain plugins - for example {{mod_bigbluebutton}}.



We are unlikely to add this to many (if any) core plugins (possibly filters).",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62563,Add support for data deletion of existing deleted users,"Add support for data deletion of existing deleted users



Admin needs to be able to select deleted users (from the existing user management interface) when selecting to do a privacy delete.



Admin needs to be able to bulk select (via same multi-user select as bulk user actions) or a CSV upload to enable a data deletion of users. This should work on live users and ""deleted"" ones.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62564,Improve bulk deletion,"Improve the bulk deletion process.



""Admin needs to be able to bulk select (via same multi-user select as bulk user actions) or a CSV upload to enable a data deletion of users. This should work on live users and ""deleted"" ones.""



Investigation",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62573,Web services can't be called after a major policy change,"As discovered and reported by [~abias] in the dev chat https://moodle.org/local/chatlogs/index.php?conversationid=21998#c641258



{code}

1. I login to moodle.org

2. I agree to the site policy

3. I publish a new version of a plugin on moodle.org/plugins

4. The publication wizard tells me: ""Error: AMOS threw exception moodle_exception: Site policy not agreed: Click here to open the site policy.""

{code}



[~marina] correctly diagnosed this as a problem with the account on lang.moodle.org that represents the Plugins directory as a remote WS client.



I remember we talked about WS accounts during the tool_policy development but I guess it's one of those things we missed at the end. I think the solution is not to reset policyagreed to 0 for accounts with auth set to WS.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62574,Deleting user data from block_html with the Privacy API crashes (at least with the Privacy API test utility),"As requested by [~dobedobedoh] in the Dev Chat, I am reporting a problem with deleting user data from block_html with the Privacy API.



Steps to reproduce:



* Login as student

* Add a HTML block instance to your dashboard and configure this block instance with some text content



* Open a SSH console

* Pick the ""Test of deleting user data"" utility from https://docs.moodle.org/dev/Privacy_API/Utilities and store it as deletiontest.php

* Run deletiontest.php with the student which you have used at the beginning of this test



Expected result:

* The script finishes and the student's data is deleted



Actual result:

* The script crashes with a database exception

{code}

Entfernen best_tigter 19 Kontexte (Freitag, 25. Mai 2018, 12:18) ausf_hren

mod_assign wird verarbeitet (1/19) (Freitag, 25. Mai 2018, 12:18)

mod_forum wird verarbeitet (2/19) (Freitag, 25. Mai 2018, 12:18)

mod_lti wird verarbeitet (3/19) (Freitag, 25. Mai 2018, 12:18)

mod_moodleoverflow wird verarbeitet (4/19) (Freitag, 25. Mai 2018, 12:18)

block_html wird verarbeitet (5/19) (Freitag, 25. Mai 2018, 12:18)

Default exception handler: Datensatz kann nicht in der Datenbanktabelle context gefunden werden Debug: SELECT * FROM {context} WHERE id = ?

[array (

0 => '228064',

)]

Error code: invalidrecord

* line 1546 of /lib/dml/moodle_database.php: dml_missing_record_exception thrown

* line 1522 of /lib/dml/moodle_database.php: call to moodle_database->get_record_select()

* line 5060 of /lib/accesslib.php: call to moodle_database->get_record()

* line 117 of /privacy/classes/local/request/contextlist_base.php: call to context::instance_by_id()

* line 288 of /privacy/classes/local/request/helper.php: call to core_privacy\local\request\contextlist_base->current()

* line 108 of /privacy/classes/local/request/helper.php: call to core_privacy\local\request\helper::delete_data_for_user_in_course_module()

* line 378 of /privacy/classes/manager.php: call to core_privacy\local\request\helper::delete_data_for_user()

* line 70 of /deletiontest.php: call to core_privacy\manager->delete_data_for_user()



!!! Datensatz kann nicht in der Datenbanktabelle context gefunden werden !!!

!! SELECT * FROM {context} WHERE id = ?

[array (

0 =&gt; '228064',

)]

Error code: invalidrecord !!

!! Stack trace: * line 1546 of /lib/dml/moodle_database.php: dml_missing_record_exception thrown

* line 1522 of /lib/dml/moodle_database.php: call to moodle_database-&gt;get_record_select()

* line 5060 of /lib/accesslib.php: call to moodle_database-&gt;get_record()

* line 117 of /privacy/classes/local/request/contextlist_base.php: call to context::instance_by_id()

* line 288 of /privacy/classes/local/request/helper.php: call to core_privacy\local\request\contextlist_base-&gt;current()

* line 108 of /privacy/classes/local/request/helper.php: call to core_privacy\local\request\helper::delete_data_for_user_in_course_module()

* line 378 of /privacy/classes/manager.php: call to core_privacy\local\request\helper::delete_data_for_user()

* line 70 of /deletiontest.php: call to core_privacy\manager-&gt;delete_data_for_user()

!!



{code}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62588,enrol_paypal error when calling enrol_paypal\privacy\provider::get_contexts_for_userid,"This is caused because of a missing upgrade step. 

commit 24df3e1a064056d50115de6cd6161585ec7313bd seems to be the one.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62589,Unable to reset submitted unapproved SARs after plugins are updated / installed,"Use case:



* A user submits a new SAR (e.g. to export all their data)

* Admin only after that installs a new plugin, or updates existing plugins (e.g. so they have the privacy API implemented)

* We now should be able to reset the submitted unapproved SARs so that contexts are re-gathered.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62590,Data deletion list is unusable for large amounts of data,"The data deletion list needs a couple of features to make it usable for big sites.



For example, after implementing our GDPR policies, I now have around 6000 user profiles flagged for deletion. I want to look those over before actually deleting them, but with the current list, this is impossible.



Whats lacking is:

* Ability to display all records on one page

* More columns (eg user identificators for the user list)

* Ability to sort by all columns",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62597,Data requests: Request date column should include time,"Request date column should also show requested time

Currently it only show requested date that make user confuse",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62600,Admin is misinformed that there are no data requests,"h3. Steps to reproduce



* Have a site with the privacy officer role set up

* As the site user, fill some SARs

* Log in as admin



Expected output: Either the admin should not see the page ""Site administration > Users > Privacy and policies > Data requests"" at all, or the admin should see some relevant information. E.g. number of requests, status of requests or even the full list of requests.



Actual behaviour: The page is shown to the admin with the misleading message ""There are no data requests""



Only the privacy officer can see the actual requests.



This is even more serious as there can be problems with the requests processing (e.g. we have them stuck in the ""pre-processing"" state for some reason) and the admin is not even notified about it.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62601,Processing deletion request by a user deleted meanwhile - throws exception,"This actually happened to us at moodle.org. Notification email was sent to user with privacy officer role on moodle.org:



{quote}Exception occured while processing privacy data



Exception occured while calling editor_atto\privacy\provider::get_contexts_for_userid.

This means that plugin editor_atto did not complete processing data. Below you can find exception information that can be passed to the plugin developer.



Invalid user





#0 /var/www/vhosts/moodle.org/html/lib/dml/moodle_database.php(1522): moodle_database->get_record_select('user', 'WHERE id = ? AN...', Array, 'id', 2)

#1 /var/www/vhosts/moodle.org/html/lib/accesslib.php(6115): moodle_database->get_record('user', Array, 'id', 2)

#2 /var/www/vhosts/moodle.org/html/lib/editor/atto/classes/privacy/provider.php(75): context_user::instance(2438070)

#3 /var/www/vhosts/moodle.org/html/lib/moodlelib.php(7764): editor_atto\privacy\provider::get_contexts_for_userid(2438070)

#4 /var/www/vhosts/moodle.org/html/privacy/classes/manager.php(495): component_class_callback('editor_atto\\pri...', 'get_contexts_fo...', Array)

#5 /var/www/vhosts/moodle.org/html/privacy/classes/manager.php(528): core_privacy\manager::component_class_callback('editor_atto', 'core_privacy\\lo...', 'get_contexts_fo...', Array)

#6 /var/www/vhosts/moodle.org/html/privacy/classes/manager.php(237): core_privacy\manager->handled_component_class_callback('editor_atto', 'core_privacy\\lo...', 'get_contexts_fo...', Array)

#7 /var/www/vhosts/moodle.org/html/admin/tool/dataprivacy/classes/task/initiate_data_request_task.php(102): core_privacy\manager->get_contexts_for_userid(2438070)

#8 /var/www/vhosts/moodle.org/html/lib/cronlib.php(185): tool_dataprivacy\task\initiate_data_request_task->execute()

#9 /var/www/vhosts/moodle.org/html/lib/cronlib.php(74): cron_run_inner_adhoc_task(Object(tool_dataprivacy\task\initiate_data_request_task))

#10 /var/www/vhosts/moodle.org/html/admin/cli/cron.php(61): cron_run()

#11 \{main}

{quote}



Edited by [~mudrd8mz] - corrected the line number in the stack and clarified the title.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62602,Data requests stuck on pre-processing,Recent data requests on moodle.org seem to be stuck on pre-processing (2 days so far).,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62603,"Allow plugin developers to declare the ""processes"" their plugin enables","The Privacy API at present goes a long way to provide a means to report on the data that is ""stored"" by a plugin, however the GDPR refers to processing, rather than simply storage:

{quote}'processing' means any operation or set of operations which is performed on personal data or on sets of personal data, whether or not by automated means, such as collection, recording, organisation, structuring, storage, adaptation or alteration, retrieval, consultation, use, disclosure by transmission, dissemination or otherwise making available, alignment or combination, restriction, erasure or destruction;

{quote}

At present there is no means (other than convention in READMEs etc) for a plugin to declare what processes it does with the personal information it holds.



Whilst this may be self-evident in some simple single-use cases, but a plugin may do multiple processes.



It would make sense for this information to be programatically declared via the Privacy API so that it can be easily enumerated by admins to be exposed in privacy policies.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62614,Privacy: Core tag provider delete_item_tags function not work,"The SQL param for UserId is not correct with the actual column in Database



It will throw an exception if when provide $userid params



*Database table mdl_tag_instance*: tiuserid

*Code*: userid",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62615,"page admin/tool/policy/viewall.php is empty, if you are not logged in","The browser window is empty, if you are not logged in. But you have to confirm it bevor and also it has to be able to see it if you are not logged in (footerlink).",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62617,GDPR data export: length of file and folder name problem,"In some cases the title of the folder or the file that is created creates conflicts. The length of the text are much to long



We found this problems:

* Windows can't open the zip-file (7-zip can oben)

* Its not possible to delete the files and folders in Windows after extracting the zip files



The titles includes the complete name of an element



Idea: Limit the number of signs in the element title to max 20 signs



Tested with Win 7",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62618,GDPR Issue: User policies Error,"This error has been handled before in issue: MDL-55915 but it hasnt solved the whole problem.



In forums and other views where names are present we sometimes get very mixed firstname / lastname combinations.



We have these settings: [ https://www.screencast.com/t/yj7wgyESihi|https://www.screencast.com/t/yj7wgyESihi]



It shows both firstname and lastname: [ https://www.screencast.com/t/Zr3zdA1bD|https://www.screencast.com/t/Zr3zdA1bD] when viewed as admin and as another user.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62621,Comments table in db has no indexes,"causes major performance issue, especially in privacy api



I suggest to add two indexes:

1. contextid, commentarea, itemid

2. userid, commentarea, component



first index will help existing queries in comments api, second index will help queries in privacy api",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62660,Data export download links don't expire,"From the initial discussions during the planning phase of the GDPR project, it was agreed that download links for data export should have expiry dates. Somehow, this has been missed.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62670,"page admin/tool/policy/viewall.php is empty, if you are not logged in","The page ... [https://xxx/admin/tool/policy/viewall.php] (Policy-Link by the moodle-app) is empty.



The browser window is empty, if you are not logged in. But you have to confirm it bevor and also it has to be able to see it if you are not logged in (footerlink).



To reproduce this error, there must exist only one active policy for ""Authenticated users"". In that case, currently:

* The active policy is displayed only when accessing to the https://xxx/admin/tool/policy/viewall.php page with an authenticated user.

* When accessing as guest, the viewall.php page is empty.



For fixing this:

* The viewall.php page must display always all the active policies, regardless of the user accessing it. This page is used from the mobile app before the user agrees the policies, so all them have to be shown (even as guest), to guarantee the user reads them from the Moodle app.

* The ""Policies"" must be displayed on the footer only when there is at least one active policy. If there are not policies, a message should appear to let the user know that this site has no active policies.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62751,Data request exception - plugin tool_log,"As reported to the privacy officer on moodle.org:



{code}

Exception occured while calling

*tool_log\privacy\provider::export_user_data*.

This means that plugin *tool_log* did not complete processing data. Below

you can find exception information that can be passed to the plugin

developer.



Error reading from database



#0 /var/www/vhosts/moodle.org/html/lib/dml/mysqli_native_moodle_database.php(1184):

moodle_database->query_end(false)

#1 /var/www/vhosts/moodle.org/html/lib/dml/moodle_database.php(1294):

mysqli_native_moodle_database->get_recordset_sql('SELECT * FROM m...',

Array, 0, 0)

#2 /var/www/vhosts/moodle.org/html/admin/tool/log/classes/local/privacy/moodle_database_export_and_delete.php(80):

moodle_database->get_recordset_select('moodleorg_archi...', '(userid =

:user...', Array, 'contextid, time...')

#3 /var/www/vhosts/moodle.org/html/lib/moodlelib.php(7764):

logstore_database\privacy\provider::export_user_data(Object(core_privacy\local\request\approved_contextlist))

#4 /var/www/vhosts/moodle.org/html/privacy/classes/manager.php(495):

component_class_callback('logstore_databa...', 'export_user_dat...',

Array)

#5 /var/www/vhosts/moodle.org/html/privacy/classes/manager.php(479):

core_privacy\manager::component_class_callback('logstore_databa...',

'tool_log\\local\\...', 'export_user_dat...', Array)

#6 /var/www/vhosts/moodle.org/html/admin/tool/log/classes/privacy/provider.php(107):

core_privacy\manager::plugintype_class_callback('logstore',

'tool_log\\local\\...', 'export_user_dat...', Array)

#7 /var/www/vhosts/moodle.org/html/admin/tool/log/classes/privacy/provider.php(77):

tool_log\privacy\provider::call_subplugins_method_with_args('export_user_dat...',

Array)

#8 /var/www/vhosts/moodle.org/html/lib/moodlelib.php(7764):

tool_log\privacy\provider::export_user_data(Object(core_privacy\local\request\approved_contextlist))

#9 /var/www/vhosts/moodle.org/html/privacy/classes/manager.php(495):

component_class_callback('tool_log\\privac...', 'export_user_dat...',

Array)

#10 /var/www/vhosts/moodle.org/html/privacy/classes/manager.php(528):

core_privacy\manager::component_class_callback('tool_log',

'core_privacy\\lo...', 'export_user_dat...', Array)

#11 /var/www/vhosts/moodle.org/html/privacy/classes/manager.php(298):

core_privacy\manager->handled_component_class_callback('tool_log',

'core_privacy\\lo...', 'export_user_dat...', Array)

#12 /var/www/vhosts/moodle.org/html/admin/tool/dataprivacy/classes/task/process_data_request_task.php(93):

core_privacy\manager->export_user_data(Object(core_privacy\local\request\contextlist_collection))

#13 /var/www/vhosts/moodle.org/html/lib/cronlib.php(185):

tool_dataprivacy\task\process_data_request_task->execute()

#14 /var/www/vhosts/moodle.org/html/lib/cronlib.php(74):

cron_run_inner_adhoc_task(Object(tool_dataprivacy\task\process_data_request_task))

#15 /var/www/vhosts/moodle.org/html/admin/cli/cron.php(61): cron_run()

#16 {main}

{code}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62755,Assignment cutoffdate and allowsubmissionfromdate are not exported,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62768,Admin privacy tool pages have no breadcrumbs,"Enable the setting ""tool_dataprivacy | contactdataprotectionofficer"".



Go to your profile page.



Follow ""data requests"" link in the ""Privacy and policies"" section.



Verify you see breadcrumb links under your user picture at the top of the page.



",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62778,Transform::datetime and transform::time should export more data,"The dates and times returned from the functions



\core_privacy\local\request\transform:datetime



and



\core_privacy\local\request\transform:time



Are human readable according to the language and timezone set for the user making the request. This means that it will never be reliable to re-read those dates and times into any import process as they are subject to the users preferences at the time of the request and things like DST would produce unresolvable duplicates.



It is hard to see why \core_privacy\local\request\transform exists.",0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62781,core_question_privacy_provider_testcase makes assumptions that CodeRunner breaks,"Steps to reproduce:



# Install https://moodle.org/plugins/qtype_coderunner.

# Run core_question_privacy_provider_testcase.



Expectec result: They pass.



Acutal result:



{noformat}

--------------------------------------------------------------

core_question_privacy_provider_testcase::test_question_owned_is_handled

Failed asserting that actual size 24 matches expected size 6.



/var/www/html/20180622_020000_175_tt_overnight_full/question/tests/privacy_provider_test.php:265

/var/www/html/20180622_020000_175_tt_overnight_full/lib/phpunit/classes/advanced_testcase.php:80





core_question_privacy_provider_testcase::test_question_delete_data_for_user_anonymised

Failed asserting that actual size 23 matches expected size 5.



/var/www/html/20180622_020000_175_tt_overnight_full/question/tests/privacy_provider_test.php:328

/var/www/html/20180622_020000_175_tt_overnight_full/lib/phpunit/classes/advanced_testcase.php:80





core_question_privacy_provider_testcase::test_question_delete_data_for_all_users_in_context_anonymised

Failed asserting that actual size 23 matches expected size 5.



/var/www/html/20180622_020000_175_tt_overnight_full/question/tests/privacy_provider_test.php:398

/var/www/html/20180622_020000_175_tt_overnight_full/lib/phpunit/classes/advanced_testcase.php:80

{noformat}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62796,tool_policy does not show popup for users who are not logged in and not logged in as guests,"When working on tool_policy we implemented the same logic as what $CFG->sitepolicyguests did - policies are shown only to users who are logged in as guests.



However Moodle sends cookie even for users who are not logged in at all, which means that we need to display popup even in this case",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62802,User IP not removed when user is deleted,"Need to confirm, but it appears that the user's IP address is not removed from the user table when the user invokes their right to be forgotten.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62830,User deletion not GDPR compliant : personal data not deleted (lastip),"When deleting a user from user interface (probably for web-service also) not all the personal data is deleted or scrambled. (example lastip, phone, address ...). This is not GDPR compliant.



Steps to reproduce:



1) create a user with personal data like phone, address, url



2) login as that user - lastip will be stored



3) delete the user



4) email and username are scrambled, but the other personal data is still there. 



Regards",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62837,Age of Consent Verification for Uploaded Users,"GDPR Digital Age of Consent Verification Improvement

Suggestion: Enable the Digital age of consent verification check for uploaded users before they can agree to a policy.

Suggested scenario:

Site privacy policy is enabled and required for users logging in for the first time.
A csv file of usernames is uploaded to Moodle, with first name, last name, username and email fields completed;
An uploaded user logs in for the first time and is prompted to agree to the site privacy policy.
If Digital age of consent verification check is enabled, the user should be prompted to enter their age (as on the manual sign up page). If they are not above the age of consent, they should be prompted to ask a guardian to contact the site admin to consent on their behalf, preventing login.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62843,Moodle is not clear on data retention when deleting a user,"When a site admin deletes a user, they are prompted with ""Are you absolutely sure you want to completely delete the user 'username', including their enrolments, activity and other user data?""



However we know that there is in fact quite a lot of user data that Moodle does not delete - things like assignment uploads - which once the user is deleted, cannot be removed from the site without deleting the course (this is very impractical) etc.



This is compounded by the fact that the user cannot request a tool_dataprivacy deletion after they are already deleted, so their data is ""lost to them, but kept by moodle"" forever.



I believe this puts us in a bad situation with GDPR compliance.



In a perfect world, I would like to see a checkbox or some way of asking the site admin if they want to permanently delete ALL user data at the time (like, on the same page) as they delete the user, on a per-user deletion basis (not a global setting that affects all user deletions).



OR



we need to very clearly state on the user deletion page that this method will leave the users data behind in the system, and very as specific as we can - and with instructions (from Moodle Docs link?) on how the site admin can remove this data post user deletion.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62852,Display audience at the viewall.php page,Working on MDL-62670 I've realised the audience is not displayed anywhere. It would be great to display it at least on the viewall.php page.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62862,Data Protection Office cannot reply to other enquiries,"When DPOs receive enquiries, there is no straight forward way to reply on the data requests page",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62865,User accounts (and Forum threads) are not anonymised after deleting personal data,"After deleting a user's personal data, her posts are anonymised and their contents deleted. Setting the ""deleted"" flag allows the forum to display an appropriate notice, hinting at the fact that parts of the discussion have been deleted as a consequence of a deletion request. Therefore, personal data (Name, ID) are not visible anymore *within* the thread.



However, if someone whose data have been deleted also was the starter of a thread, her name is still visible in the *list of all threads* in a forum, even though the first post is not visible.



*Expected behaviour*



The name of a user whose personal data have been deleted should not be visible anymore, anywhere. At least not in public-facing pages.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-62873,GDPR data export never completes,"Running GDPR data export never completes.



Problem appears to be that tasks taking longer than cron intervals are restarted at next cron cycle and therefore never end.



Switching off cron, and then running cron file from command line, allows successful completion.



(Taking 1364 seconds to complete task for this user who has participated in a large number of quizzes)",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62892,GDPR user delete process,"After some weeks with GDPR experience we came to several cases related to user deletion process we would like to see optimized.

* When a user account is deleted in the standard process in user management, via csv upload with delete field or external tools (LDAP, webservices etc.) the GDPR compliant process is not started. That means we will store user data in our site without any option to delete them completely.

* When a user account was deleted in former days we can't see the user account in the system but data are available in the database.



This brings me to the question how we can delete such data effectively. Here some ideas:

* Site setting for user management that user account deletion starts privacy API user account delete process starts automatically or the user account is added to the list of accounts for manual confirmation

* In user upload process settings an additional option settings allows definition how to handle delete in formation in csv file.

* For external processes that delete user accounts it should be possible to trigger the privacy API delete process.

* User accounts in database that are deleted earlier and that are invisible in the interface should be cleaned up on request by an admin process.



For each of the cases the options could be auto delete by privacy API or adding to the bulk deletion process in privacy API.



.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62904,Users can't find where to request account deletion,"The support emails for moodle.org and learn.moodle.net often receive messages from people wanting to delete their account but not finding where to request it in the UI. We created the following canned response:

{quote}To request for your data to be deleted from [moodle.org|http://moodle.org/], please



# Log in and go to your profile [https://moodle.org/user/profile.php]

# Click 'Data requests' in the Privacy and Policies section

# Click the New request button

# From the dropdown, select 'Delete all of my personal data'

# Click the Save changes button.{quote}



Rather than expecting users to go through all of the above steps, it would be good to simply provide them with a link on their profile page.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62915,Privacy API deletes Primary Admin Account,"If the primary admin asks for deletion of personal data and the process is confirmed the admin account will be deleted.



It should never be possible to delete a primamry user account in Moodle.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62948,tool_policy behat failure,"{code}

....F----------------



--- Failed steps:



001 Scenario: Accept policy on login as guest # /var/www/html/admin/tool/policy/tests/behat/consent.feature:452

When I press ""Log in as a guest"" # /var/www/html/admin/tool/policy/tests/behat/consent.feature:464

WebDriver\Exception\UnknownError: unknown error: Element <input type=""submit"" value=""Log in as a guest""> is not clickable at point (265, 579). Other element would receive the click: <div class=""eupopup-head""></div>



{code}



The bottom floating footer covers the ""Login as guest"" button.",0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62962,tool_dataprivacy unit tests have data created in a provider,"{{admin/tool/dataprivacy/tests/api_test.php::get_data_requests_provider}} is creating data in a {{dataProvider}}. This is fundamentally wrong and will break things.



This is seen when calling _any_ phpunit test which does not reset state as a database modification.



Data providers are run before phpunit starts at all. They _must not_, in fact _can not_ create data because they are called _prior_ to {{setUp}} and any test.



They _must not_ be used to create data. They are intended to provide a set of data and expected result, not as a test {{setUp}}.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62980,Data privacy requests can fail validation with unhelpful information for the user,"Data privacy requests are automatically validated according to the rules in the persistent object. But no checking is performed in a way to present a helpful message to the user who submitted an invalid request. The comments field is the worst offence, because it is a text area allowing anything to be entered, but on the backend it is validated as PARAM_TEXT. This means HTML tags etc will be stripped, but any change to the text will cause the validation to fail with an unhelpful message:



error/invalidpersistenterror - Bunch of unhelpful text...







To reproduce, create a privacy request with the text ""<b>bold</b>"" as the comment.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62989,Improve data request order for users,"The user view of data requests (within user profile) orders requests by status ID and then ascending date, which is confusing where a user has made many requests.



Data requests for users should display ordered by 'Date requested', descending, so that their most recent request is at the top of the list, so they have an easy to view, and intuitive timeline of current and past requests.



The screenshot below shows the current order, which shows a pending request at the top (pending has a lower status ID than complete/rejected), but the most recent completed export is at the bottom of the list.



!data-requests-order.png|thumbnail!



Currently this has caused some issues for developers (eg clicking and downloading older versions of requests), however I see this becoming confusing for users in the future, when the functionality has been available long enough for students/teachers etc to have amassed a list of requests, such as if they are towards the end of a degree, and have been making requests at the end of each semester.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-62996,Missing upgrade.php file on tool_dataprivacy may cause errors when upgrading from 3.3 or 3.4,"This issue is related to the tool_dataprivacy and was discovered while fixing the following issue at the School demo: https://tracker.moodle.org/browse/MDLSITE-5502



Sites with Moodle 3.3 or 3.4 and the version 3x.0.0 or 3x.1.0 of the tool_dataprivacy installed won't have all the tables and fields created in the 3x.2.0 plugin version when they upgrade to 3.5. These tables and fields won't be created because the db/update.php file was removed when the plugin was moved to core: MDL-61899.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-63009,Data requests should note site of origin in email notifications,"Data request emails should identify the site of origin, as this is not currently included, except as part of the ""from"" address. This will help avoid confusion for privacy officers who manage multiple sites.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63011,Paypal enrolement data processing breaks GDPR,"Paypal enrolement seems to get information from Paypal about users address registered at paypal and paypment process used in paypal. All these information are not visible via interface.



Storing this data even if they are inviisible breaks GDPR in some situtions.. Specially finance relevant data can be sensible special categories of data.



If such data re not visible in Moodle and there is no need to use theme they shouldn't be stored in Moodle.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63013,Allow terms and conditions to be agreed to before showing the privacy statement.,"It is demanded to have a feature that the user has to agree to the terms and conditions statement first prior going through the rest of policies acceptance workflow. This requirement follows on from the initial mock-up:



!screenshot-1.png|thumbnail! 



The basic use case comes from uni's (or other organisations) wanting a user to first sign off on the site terms and conditions, as a contract of use for the site. If the user doesn't want to sign off on this then they won't be allowed access to the site (no matter what), and there is no point at all in proceeding to show them privacy statements (why waste their time?).



So, in more 'user story-like' language:



As an admin I need my users to agree to the site T&Cs as a contract and their agreement of use, before proceeding with any other sign on functionality as without their agreement to the T&Cs they will not be allowed on the site.



This is also a way to more formally separate the T&Cs from privacy statements - they have different purposes.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63021,Add function to delete data requests,I can't see that data requests can be deleted anywhere when the request is completed. This should be possible by marking them or by time.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63023,User can only see the second policy document when agreeing to policy documents.,"Replication steps as follows:



# With a clean installation

# Change the Site policy handler to ""Policies (tool_policies)"" Site adminstration > Users > Privacy and policies > Policy settings

# Go to Manage policies (Site administration > Users > privacy and policies > Manage policies).

# Add a new policy.

# Name it Terms and conditions and leave the type as ""Site policy"". Fill in some content for the summary and Full policy textareas. Set the Policy status to ""Active"".

# Create another new policy.

# Call it Privacy policy.

# Set the type to ""Privacy policy"".

# Fill in the summary and full policy.

# Set the Policy status to ""Active"".

# Log out.

# Log in as a student.

# Notice that you are on the privacy policy and not the terms and conditions page.

# The right hand side reads ""Policy 2 out of 2"".

# There is no way to click back to the ""Terms and conditions page""",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63072,admin/tool/policy/tests/behat/consent.feature random fails,"{code}

2037 sm:master> vendor/bin/behat --format=""moodle_progress"" --out=""std"" --format=""progress"" --out=""/Users/nicols/Sites/moodles/sm/extra/behat/progress.txt"" --format=""pretty"" --out=""/Users/nicols/Sites/moodles/sm/extra/behat/pretty.txt"" --config=/Users/nicols/Sites/moodles/sm/moodledata_behat/behatrun/behat/behat.yml --tags arn

Moodle 3.6dev (Build: 20180727), 6e8235c7d3957120f16f5b9d4df8ef1ec82558b5

Php: 7.1.17, pgsql: 9.6.9, OS: Darwin 17.7.0 x86_64

Server OS ""Darwin"", Browser: ""firefox""

Started at 03-08-2018, 10:21

.......................................F--------------



--- Failed steps:



001 Scenario: Accept policy on sign up, after completing sign up attempt to create another account # /Users/nicols/Sites/moodles/sm/moodle/admin/tool/policy/tests/behat/consent.feature:487

Then I should see ""Please agree to the following policies"" # /Users/nicols/Sites/moodles/sm/moodle/admin/tool/policy/tests/behat/consent.feature:541

""Please agree to the following policies"" text was not found in the page (Behat\Mink\Exception\ExpectationException)



1 scenario (1 failed)

54 steps (39 passed, 1 failed, 14 skipped)

0m3.02s (45.75Mb)

{code}

{code}

2043 sm:master> vendor/bin/behat --format=""moodle_progress"" --out=""std"" --format=""progress"" --out=""/Users/nicols/Sites/moodles/sm/extra/behat/progress.txt"" --format=""pretty"" --out=""/Users/nicols/Sites/moodles/sm/extra/behat/pretty.txt"" --config=/Users/nicols/Sites/moodles/sm/moodledata_behat/behatrun/behat/behat.yml --tags arn

Moodle 3.6dev (Build: 20180727), 6e8235c7d3957120f16f5b9d4df8ef1ec82558b5

Php: 7.1.17, pgsql: 9.6.9, OS: Darwin 17.7.0 x86_64

Server OS ""Darwin"", Browser: ""firefox""

Started at 03-08-2018, 10:23

.......................................

Paused. Press Enter/Return to continue.

...............F



--- Failed steps:



001 Scenario: Accept policy on sign up, after completing sign up attempt to create another account # /Users/nicols/Sites/moodles/sm/moodle/admin/tool/policy/tests/behat/consent.feature:487

And I should see ""New account"" # /Users/nicols/Sites/moodles/sm/moodle/admin/tool/policy/tests/behat/consent.feature:556

""New account"" text was not found in the page (Behat\Mink\Exception\ExpectationException)



1 scenario (1 failed)

55 steps (54 passed, 1 failed)

0m9.28s (45.88Mb)

{code}",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63094,Random behat fail on tool policy,"I suspect that there are some race conditions with the modals used to display policies from the footer which are causing this:

https://ci.moodle.org/job/S33.05.01%20-%20Behat%20-%20Chrome%20+%20Postgres%20+%20Clean/lastFailedBuild/



The order of the JS is (triggered by clicking on the policy):

# init vars

# make request

# on request success:

## create modal

## setup handler

## display modal



We should re-order this and add in pending checks so that it is:

# init vars

# start pending JS call

# create modal using promises for resolution of body and title

# configure setup of modal

# make request

# on request success resolve promises for body/title

# on display of modal, complete the JS call check",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-63109,User agreements page can't be interacted anymore once the consent modal gets closed,"To reproduce: 

# Log in as admin

# Go to Site administration / Users / Privacy and policies / Policy settings

# Set the ""{{Site policy handler}} to tool_policy.

# Save the changes.

# Go to Site administration / Users / Privacy and policies / Manage policies

# Create a site policy and make it active.

# Back to the ""{{Policies and agreements}}"" page, agreements link for the site policy.

# Tick one or more users and click on the ""{{Consent}}"" button at the bottom of the table.

# When the modal shows up, click ""{{Cancel}}"" or click outside the modal to close it.

# Click again on any of the checkboxes.

# *Expected:* You can continue selecting/deselecting users.

# *Actual:* The page freezes up and you can't do anything anymore unless you refresh the page.



I thought at first that it could be a regression from MDL-60207. But since I can reproduce this as well even in 35, then the problem is most likely in the ""{{User agreements}}"" page.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63114,it should not be possible to close privacy policy information on frontpage by clicking the button in the right top corner,"When you visit a moodle, then there automaticaly is an overlaying box with information about privacy policy.



I think that clicking at the button in the top right corner of the privacy policy for not logged in users means, that the user do ""not agree"". The box with the privacy policy hint should still be visible until the user clicks at the ""continue"" link to say that the user agrees",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63116,Add bulk actions to the Privacy Request Table,"We should add the ability to perform bulk actions on the Data Privacy tool's request page.



The actions we need to support in bulk are:

# Approve

# Reject

# Cancel



This will make management of requests far easier.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63167,Final deprecation of the gradingform_provider interface,"Follow through with the final deprecation of the gradingform_provider.

# Delete the file grade/grading/classes/privacy/gradingform_provider.php

# Remove deprecated functions from grade/grading/classes/privacy/gradingform_legacy_polyfill.php

# Remove sections of code no longer needed in grade/grading/classes/privacy/provider.php

# Update grade/grading/form/upgrade.txt with details about the final deprecation.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63184,is_site_dpo() doesn't check for any capability and it seems it should,"1) Was looking for some changes when I realized that {{is_site_dpo()}}, used widely to decide about which operations are allowed for a dpo is simply calling to {{get_site_dpos()}}, that doesn't perform any capability check, just looks for roles based in config value.



IMO, some capability should be checked, not sure if one, multiple, or maybe passed by param, but for sure we cannot decide permissions based solely on roles, capabilities are for that.



2) Tangentially related to that, it's also the fact that, for 1st time in 15 years (since admins and caps were invented), we are specifically/exceptionally denying the access to something to admins, based in some exceptional logic, say ""admins can do everything but not tasks associated to POs"". I personally find this exception (any in general) bad for the system.



I could agree that they could be warned about proper POs existing and preventing them about that but, still, they should continue doing everything. Of course, IMO. I know it was a decision but really it's killing the previous behavior for nothing. Should we start prohibiting them also to edit the gradebook or creating courses or enroling people or editing profiles? We don't do, why this case is so, so exceptional ?



That is, surely only 1) is a real bug, but the 2) reflexion really makes me not happy. Cannot find a logic justification.



Ciao :.)",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0
MDL-63187,Name overflow on purpose deletion modal,"# Create a new purpose with the name:

This is a really long category name This is a really long category name This is a really long category name

# From the table (actions column), select delete.

# Notice the view like on the attached screenshot - overflow city.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63267,Rubrics do not consider the fillings table (backport of MDL-62535),"This is a backport of MDL-62535 to the 33, 34 and 35 branches.



Originally considered a bug, but including API changes, it was only integrated to 3.6dev. But it seems that we may need this in stables as far as it's a real bug preventing some privacy information being correctly handled.



So, to decide and apply if needed. ASAP.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63295,Tool Policy changes are not stored in configuration setting report,"After activating tool_policy I made settings for policies. Later I made some changes. 

In the report for administrational settings changes these changes are not reported .



It seems that the settings in tool_policy are not logged.",0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63313,Check Moodle core version in the Policies plugin prior and during upgrade,The Policies plugin was merged into the standard Moodle distribution in MDL-62800. So the versions 3.3.8 and 3.4.5 will be released with the plugin newly present. We want to warn the admins via the github (contrib) version of the plugin and eventually avoid the situation when the addon code would remain in recent 3.3 or 3.4 site. Only the core code should be present.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63334,Handle correctly when module doesn't have privacy support,"This item implements a fix that breaks unit tests for Metadata registry privacy unit tests that fail when a plugin doesn't have privacy support.



The unit test sees it as not compliant and continues on testing.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63401,User expiry does not work as it should,"This issue covers three main issues:

# users are currently expired when they _finish_ a course, not when the courses that they are in _expire_. This currently means that some data is removed before it should be

# it is not possible to expire a user if they are enrolled in any open-ended courses

# any user with a user block is not deletable due to a mis-understanding in the API as to how to handle blocks -- it treats them all as belonging to a course



This issue solves these by:

# switch to respecting the _course_ expiry as a dependency of _user_ expiry.

# provide a system setting to ignore open-ended courses when calculating the user expiry (rely purely on last login time)

# rewrite the dataprivacy expiry manager to not separate out course contexts from user contexts using context level, but instead do so by actual context.



The biggest change in this patchset is for the third item.

The original code assumed that any block was always a course block, and ignored the potential for user blocks. Because of this user expiry was essentially not possible if the user had any blocks on their Dashboard. 

I felt that the best way to handle this was:

# to merge the user and course context expiry managers. The existing code separated them out based purely on their context level, which is not an accurate gauge of their type

# to change the behaviour such that any child context of a user is bundled in with the user context. It does not make sense not to do so as we do not allow any data registry configuration (purpose/category) for a specific user or for children of these anyway.



In order to complete this work I also moved the location of capability checks from the API class to the endpoints which call them. These tests do not belong in the API, and we have found this in other related issues (user bulk deletion, {{is_site_dpo}} changes, etc).



This work also necessitated that we finally stop deleting the user context, and instead just delete the related content.

As far as I'm aware, the only time we delete other contexts is when the record itself is removed. We do not remove the user record at any time, therefore we should not remove the context. The context has many things stored against it and, although some items are removed during the context deletion, this only applies to removal of _core_ items (and not even all of them). It does not support deletion of user context data in plugins at all. Again, this same change has been identified as a necessity in other related issues.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63446,Policy Management/Assignment - Apply Policies to Users through Cohort Selection,"Enhance the Policy Management functionality to allow site policies to apply to members of specified cohort(s) only.



Configured policies will be shown to users who are members of the specified cohorts, but will not be displayed to other users.



Specifically, when creating/editing a policy on the /admin/tool/policy/editpolicydoc.php page, a ""Select cohorts"" option should be added, much like Course > Participants > Enrol users when the ""Cohort Enrolments"" enrolment method is enabled in a course.



Implementing the functionality that is presented to the user from /enrol/manual/classes/enrol_users_form.php:105 into /admin/tool/policy/classes/form/policydoc.php:73 seems like the starting requirement for such functionality.



This would allow site administrators to create/manage cohorts and apply policies to subsets of users, such as cohorts like ""All Staff"" or ""All Students"", or to meet requirements mentioned on the Policy plugin page [https://moodle.org/plugins/tool_policy] in a comment by [Derek Chaplin|https://moodle.org/user/view.php?id=1854722&course=1] on June 6, 2018: 



{quote} 

Great plugin! It has worked very well for our website but it would be nice if you could apply it to a specific group of users by cohort or country or language as different policies can apply for different regions. For instance, our Asian group has a different set of usage policies than our North American users. 



For simplicity, it would probably be easier to add the capability to choose it by cohort or group. 



Thanks again for this plugin! 

{quote} 



Alternatively (or additionally) similar functionality might be obtained by applying policies according to user role, but this would introduce significant complexity.



For example, by applying roles defined at the site context, or category context, etc. or perhaps even a role independent of context level - such as all users with a ""Teacher"" role, regardless of whether that be defined at a site context, category context level or a course context level.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63448,Random unit test failures with core_message privacy provider (take #2),"This is a followup of MDL-62393, where some random failures were already fixed but, still, [see last comments|https://tracker.moodle.org/browse/MDL-62393?focusedCommentId=628661&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-628661], there is some randomness happening.



{code}

core_message_privacy_provider_testcase::test_export_for_context_with_messages

Failed asserting that two strings are equal.

--- Expected

+++ Actual

@@ @@

-'Yes'

+'No'



/var/www/html/message/tests/privacy_provider_test.php:270

/var/www/html/lib/phpunit/classes/advanced_testcase.php:80

{code}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63495,Extend privacy API to support multi-user operations,"As part of MDL-62560 we need to support the following operations:

# determining the list of users in a context

# deleting multiple users within a single context",0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63496,Support for per-role deletion in the dataprivacy tool,Add support for graduated deletion of user data depending upon user role.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63497,Add support for removal of context users - multiple components,"Add support to identify and remove users in a context for the following components:

* block_html

* tool_dataprivacy

* mod_chat

* mod_data

* mod_glossary

* mod_feedback

* mod_lesson",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63500,Add support for removal of context users - core_group and friends,"Add support to identify and remove users in a context for core_group, enrol_meta and enrol_cohort.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63526,Improve the user data retention summary to show individual modules as belonging to activities.,The individual mod defaults are show after blocks and seem a bit disconnected. The display could be improved to show that these modules belong to activities.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63530,Add support for removal of context users - core_notes,Add support to identify and remove users in a context for core_notes.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63554,Add support for removal of context users - cachestores,Add support to identify and remove users in a context for cachestore_*.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63558,Add support for removal of context users - portfolios,Add support to identify and remove users in a context for portfolio_*.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63564,Add support for removal of context users - core_question + mod_quiz,Add support to identify and remove users in a context for core_question and mod_quiz.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63566,Display core_userlist validation in data registry,"Display whether a component implements the core_userlist provider when it should.



I think this needs to be defined for any component implementing the {{core_user_data_provider}} but we need to confirm that is correct.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63572,Add support for removal of context users - profilefield_checkbox,Add support to identify and remove users in a context for profilefield_checkbox.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63575,Add support for removal of context users - profilefield_datetime,"Add support to identify and remove users in a context for

profilefield_datetime.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63579,Comment does not provide a way for other components to fetch a user's data,"Instead of directly joining the comments table, there should be a comment provider method equivalent to \core_rating\privacy\provider::get_sql_join, which allows this to be fetched.



Examples of affected methods are provider::get_contexts_for_userid methods for mod_data and mod_glossary.



Once created, affected provider::get_contexts_for_userid methods will need to be found and corrected.



There are also some provider::get_contexts_for_userid methods that join the rating table directly, instead of using the rating provider's get_sql_join method, which should be fixed at the same time (for example, mod_data).",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63586,Add support for removal of context users - profilefield_menu,Add support to identify and remove users in a context for profilefield_menu.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63587,Add support for removal of context users - profilefield_text,Add support to identify and remove users in a context for profilefield_text.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63588,Add support for removal of context users - profilefield_textarea,Add support to identify and remove users in a context for profilefield_textarea.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63595,Add support for removal of context users - mod_quiz,Add support to identify and remove users in a context for mod_quiz.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63619,Inheritance does not work as it should,"Whilst writing testing instructions for MDL-63496 I have discovered that purpose and category inheritance do not work in the intended way.



Where the purpose, or the category, are set to 'Inherit', this should inherit from the parent context.

What is happening is that it is inheriting from the parent context _type_.

Consider the following scenario:



h2. Purposes

# Example - retention period 5 years

# Some other - retention period 3 years

# Education - retention period 1 year



h3. Activity explicitly set to ""Inherit""

A site has a purpose set to ""{{Example}}""

A course category has a purpose set to ""{{Some other}}"" 

A course within it has a purpose set of ""{{Education}}""

A forum within that course is configured to ""{{Inherit}}""



h4. Expected

The forum is actively set to Inherit

The forum will inherit from the course, and have an effective value of ""{{Education}}"" (1 year)



h4. Actual

(/) The forum inherits from the course, and has an effective value of ""{{Education}}"" (1 year)





h3. Activity instance not explicitly set

A site has a purpose set to ""{{Example}}""

A course category has a purpose set to ""{{Some other}}"" 

A course within it has a purpose set of ""{{Education}}""

A forum within it has no purpose set

The default for activity modules is set to ""Inherit"" (the default).



h4. Expected

The forum will default receive the ""Inherit"" value from the activity module default.

The forum will then inherit from the course, and have an effective value of ""{{Education}}"" (1 year)



h4. Actual

(/) The forum gains the ""{{Inherit}}"" value from the default for activity modules.

(x) The forum inherits from the the default for courses (Not set to ""{{Inherit}}"")

(x) The forum inherits from the the default for course categories (Not set to ""{{Inherit}}"")

(x) The forum inherits from the the default for the Site (Set to {{Example}} (5 years))



h3. Explanation

When calculating the inheritance via the defaults system, we are looking up the context level tree rather than inheriting from the parent. i.e. we first check the forum itself, then fall back on the default for the {{context_module}}, then the default for {{context_course}}, then {{context_coursecat}}, and finally {{context_system}}.



The ""Inherit"" option should behave identically in both scenarios.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63624,Add support for removal of context users - tool_cohortroles,Add support to identify and remove users in a context for tool_cohortroles.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63626,mod_quiz\privacy\provider::get_contexts_for_userid error when no quiz attempt,mod_quiz\privacy\provider::get_contexts_for_userid does not work well when there is no attempt in the quiz at all.,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63632,Forum provider not deleting data for users who did not create the discussion,"I've discovered that we do not correctly delete some data if a user did not post the discussion.



Although we have copious unit tests, we don't test this particular case yet (grr).",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63634,Add support for removal of context users - enrol_paypal,Add support to identify and remove users in a context for enrol_paypal.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63639,Add support for removal of context users - core_fileconverter,Add support to identify and remove users in a context for core_fileconverter.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63640,Add support for removal of context users - core_files,Add support to identify and remove users in a context for core_files.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63644,Erroneous query in enrol_paypal\privacy\provider::get_contexts_for_userid,"The sql query in enrol_paypal\privacy\provider::get_contexts_for_userid is not correct.



The LEFT JOIN in the query should change to INNER JOIN and the AND in the join condition should change to OR.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63647,Add support for removal of context users - enrol_flatfile,Add support to identify and remove users in a context for enrol_fatfile.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63649,Add support for removal of context users - enrol_lti,Add support to identify and remove users in a context for enrol_lti.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63656,Add support for removal of context users - tool_messageinbound,Add support to identify and remove users in a context for tool_messageinbound.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63657,Add support for removal of context users - tool_mobile,Add support to identify and remove users in a context for tool_mobile.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63659,Add support for removal of context users - tool_monitor,Add support to identify and remove users in a context for tool_monitor.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63660,"Unit test failure - moodle_content_writer_test::test_export_user_preference_unescaped_unicode with data set ""Unicode"" ('__?_Aa__ _!')","The test was introduced in MDL-62491.



Copying message from Renaat Debleu in https://tracker.moodle.org/browse/MDL-62491?focusedCommentId=637688&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-637688: ""phpunit tests now have SSL Handshake timeouts. Perhaps the link to ""https://www.moodle.org"" in privacy/templates/htmlpage.mustache file should be modified to ""https://moodle.org""""



{code}

1) moodle_content_writer_test::test_export_user_preference_unescaped_unicode with data set ""Unicode"" ('__?_Aa__ _!')

file_put_contents(): SSL: Connection reset by peer

/home/travis/build/kabalin/moodle/privacy/classes/local/request/moodle_content_writer.php:734

/home/travis/build/kabalin/moodle/privacy/classes/local/request/moodle_content_writer.php:643

/home/travis/build/kabalin/moodle/privacy/classes/local/request/moodle_content_writer.php:680

/home/travis/build/kabalin/moodle/privacy/tests/moodle_content_writer_test.php:1136

/home/travis/build/kabalin/moodle/privacy/tests/moodle_content_writer_test.php:948

/home/travis/build/kabalin/moodle/lib/phpunit/classes/advanced_testcase.php:80

{code}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63664,Add support for removal of context users - tool_policy,Add support to identify and remove users in a context for tool_policy.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63665,Add support for removal of context users - mod_choice,Add support to identify and remove users in a context for mod_choice.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63671,Methods in tool_cohortroles provider should limit data to the cohort context.,"Currently the methods in the tool_cohortroles provider are limiting data to the user context . Cohort roles are really a system feature and not as the existing provider currently labels them, a user feature. Therefore, we need to modify the methods and limit the data to the system context.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63673,Add support for removal of context users - fileconverter_googledrive,Add support to identify and remove users in a context for fileconverter_googledrive.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63677,Random redirection during policy agreement and signup,"We were finding that when multiple users were attempting to create an account with the new tool_policy plugin enabled, they would be bounced, seemingly at random, back to the front page or initial policy page and often unable to create a new account.



You can test this by having two users try to create accounts via email authentication with policies enabled. User 1 goes through the policy agreement process, consents, and waits on the signup page. User 2 then goes through to the consent page (the page with the checkboxes to consent to all the policies). User 1 then submits their signup page. When User 2 clicks next, they will be taken back to the front page instead of the signup page.



It looks like the presignup cache is being being cleared on the 'createduser' event - any user. This removes the policy viewed/accepted states for EVERY session, causing the redirection.



I have a PR at [https://github.com/saylordotorg/moodle/pull/1] that appears to fix the issue - multiple users are able to sign up and the full policy flow is restored if a user creates an account (ignores the confirmation email and doesn't log in) and tries to create a new account again during the same session.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63678,Add support for removal of context users - ltiservice_gradebookservices,"Add support to identify and remove users in a context for ltiservice_gradebookservices.

",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63679,Add support for removal of context users - ltiservice_memberships,"Add support to identify and remove users in a context for ltiservice_memberships.

",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63682,Add support for removal of context users - mnetservice_enrol,Add support to identify and remove users in a context for mnetservice_enrol.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63685,Repeated elements do not work in AJAX forms,"MDL-63496 sees an example of this.



Repeated elements are added via a page reload which is incompatible with forms shown in a modal.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63689,Add support for removal of context users - mod_workshop,Add support to identify and remove users in a context for mod_workshop.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63700,Add support for removal of context users - core_analytics,Add support to identify and remove users in a context for core_analytics.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63703,Add support for removal of context users - core_role,Add support to identify and remove users in a context for core_role.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63712,Add support for removal of context users - core_message,Add support to identify and remove users in a context for core_message.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63713,Add support for removal of context users - core,Add support to identify and remove users in a context for core.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63726,"Make ""Data retention summary"" link in the footer removable","Dear all,



MDL-62558 has introduced a link which is called ""Data retention summary"" (id=""dataretentionsummary"", pointing to /admin/tool/dataprivacy/summary.php) in the users profile (/user/profile.php) and in the footer section of our whole Moodle site.



It would be a great improvement to MDL-62558 , if the administrator could choose, if this link is shown or hidden in any place.



We currently do not plan to use this feature, as we do not have any plans to define our periods within Moodle. As this link currently can not be hidden in any good way, our users are confronted with lacking information in popular places. This creates a confusing experience for them.



A simple checkbox, to show or hide these links in the users profile and the footer would solve our problem. Thanks in advance for considering it.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63764,Add support for removal of context users - core_competency,Add support to identify and remove users in a context for core_competency.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63779,Contact DPO link in user profile not aligned,The 'Contact the privacy officer' link in the user profile 'Privacy and policies' section should be aligned with the other text and links.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63782,When attempting to sign up for an account you are returned to the age and location verification page,"As found on moodle.org,

# Click the create new account button

# Complete the age and location verification

# Agree to all policies

# Complete the new account form and click the 'Create my new account' button



Expected result: A message is displayed saying that you have been sent an account confirmation email.



Actual result: You are returned to the age and location verification page.



Note: Although I have been returned to the age and location verification page lots of times, I have sometimes got through to the page saying that you have been sent an account confirmation email. Thus, it is not possible to reliably reproduce the issue.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63785,performance improvement for get_users_in_context,"Reduce the number of joins in get_users_in_context where possible.



there is no need to join on the context table when the context is either context_block, context_user or context_course because in those cases we already know that $context->instanceid is equal to $blockinstanceid, $userid or $courseid respectively.",1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63816,Some get_users_in_context docblocks are incorrect,"The /privacy/classes/local/request/core_userlist_provider.php interface method, as well as some providers say:

""Get the list of contexts that contain user information for the specified user.""



They need to be corrected to:



""Get the list of users who have data within a context.""



*Note:* Some affected providers include core_group and mod_assignment, but this should be checked once all of the current providers have landed, in case any others have been missed that haven't landed at the time this issue was created.



",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63826,Oracle unit test failures @ assignsubmission_comments_privacy_testcase,"This is a followup of MDL-63531 that, apparently introduced a problem within Oracle (34, 35 & master).



Link: https://ci.moodle.org/job/W.01.05%20-%20PHPUnit%20-%20Oracle/118/



And a bisect session has pointed to that issue as responsible of the failures:



{code}

$ git bisect bad

b96e7fa6b23e888e03fb2ef665706f8468676061 is the first bad commit

commit b96e7fa6b23e888e03fb2ef665706f8468676061

Author: Adrian Greeve <abgreeve@gmail.com>

Date: Wed Oct 10 13:27:23 2018 +0800



MDL-63531 mod_assign: Update mod assign to use new interface.



This introduces a new interface for assign sub-plugins and

updates the mod_assign provider to implement the new general

interface for deleting data for users in a context.



:040000 040000 354589206727f401e4540c7a1fd7a3d5f252e887 a055133905c42d79153cca5fffe45b5121f4f828 M mod

{code}



To reproduce, just run:



{{vendor/bin/phpunit ""assignsubmission_comments_privacy_testcase"" mod/assign/submission/comments/tests/privacy_test.php}}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63865,Add missing unit tests for tool_dataprivacy provider,The tool_dataprivacy provider is not unit tested. Relevant unit tests for all provider methods need to be written.,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63867,initiate_data_request_task fails if tool unconfigured,"This is a must fix for minor releases.

{code}

Adhoc task failed: tool_dataprivacy\task\initiate_data_request_task,Coding error detected, it must be fixed by a programmer: Something went wrong, system defaults should be set and we should already have a value.

Backtrace:

* line 273 of /admin/tool/dataprivacy/classes/expired_contexts_manager.php: call to tool_dataprivacy\data_registry::get_effective_contextlevel_value()

* line 211 of /admin/tool/dataprivacy/classes/expired_contexts_manager.php: call to tool_dataprivacy\expired_contexts_manager::get_nested_expiry_info_from_sql()

* line 819 of /admin/tool/dataprivacy/classes/expired_contexts_manager.php: call to tool_dataprivacy\expired_contexts_manager::get_nested_expiry_info_for_courses()

* line 809 of /admin/tool/dataprivacy/classes/expired_contexts_manager.php: call to tool_dataprivacy\expired_contexts_manager::is_course_context_expired()

* line 872 of /admin/tool/dataprivacy/classes/expired_contexts_manager.php: call to tool_dataprivacy\expired_contexts_manager::is_course_expired()

* line 897 of /admin/tool/dataprivacy/classes/expired_contexts_manager.php: call to tool_dataprivacy\expired_contexts_manager::are_user_context_dependencies_expired()

* line 1004 of /admin/tool/dataprivacy/classes/api.php: call to tool_dataprivacy\expired_contexts_manager::is_context_expired_or_unprotected_for_user()

* line 103 of /admin/tool/dataprivacy/classes/task/initiate_data_request_task.php: call to tool_dataprivacy\api::add_request_contexts_with_status()

* line 185 of /lib/cronlib.php: call to tool_dataprivacy\task\initiate_data_request_task->execute()

* line 113 of /admin/tool/task/cli/adhoc_task.php: call to cron_run_inner_adhoc_task()

{code}



The easiest solution is to add a new ""{{is_system_purpose_defined}}"" function. Essentially, the inverse of:

{code}

$classname = \context_helper::get_class_for_level($record->contextlevel);

list($purposevar, $categoryvar) = data_registry::var_names_from_context($classname);

set_config($purposevar, $record->purposeid, 'tool_dataprivacy');

set_config($categoryvar, $record->categoryid, 'tool_dataprivacy');

{code}



Following that we call the function in {{expired_contexts_manager::is_context_expired_or_unprotected_for_user()}} and have the function return true if the site is not configured (equivalent to meaning allow deletion of anything if GDPR is not configured).



We may need to hook into other places too.



To reproduce this issue, setup a new site, request a user deletion, and run the adhoc task.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63885,Structural improvements in tool_dataprivacy,"In a discussion in MDL-62564 some suggestions were made to improve the structure of the tool_dataprivacy plugin.

# Make tool_dataprivacy mandatory (right now it can be uninstalled).

# Consider moving some parts of the tool to the privacy api/subsystem.

# Consider moving some current callbacks/observers to direct calls to core, as far as 3) is done.",0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63886,Improve the flow of the automatic creation of delete data requests when deleting users,"In a discussion in MDL-62564 some suggestions were made to improve the flow of the automatic creation of delete data requests when deleting users in tool_dataprivacy plugin.



We need to check if we can unify the deletion process to ensure that cases like ""delete user happens before request is approved"" have a better flow.



We should consider making changes to delete_user(), if tool_dataprivacy is enabled. Possibly, the initial call to delete_user() should not happen, and just the automatic request should be created. Once it's approved and the purposes and retentions allow it... is when tool_dataprivacy should perform the unique and complete deletion.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63897,Remove preprocessing stage from GDPR operations,"We originally planned to allow for an interface to approve and reject individual contexts. This necessitated splitting the request into a Pre-processing stage, and a processing stage, with the pre-processing stage locating everywhere that the user holds data.





This interface never materialised, and now that we have a combination of per-purpose protection, and per-role deletion, this is arguably no longer required. Any rejection of a context for a specific user should be done via a per-role override to the context purpose instead.



As such, we should remove the preprocessing stage. This becomes especially important given MDL-62563, and MDL-62564, where we will see the creation of automated requests.



This pre-processing stage has a number of existing issues, namely it allows for data to become stale between addition and removal.



Removing this stage and jumping straight to the awaiting approval state, and then fetching the list of contexts immediately before they are handled reduces complexity, and the possibility for this stale state. This also alleviates the need for most (but not all) of MDL-62589.",0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63902,Course context children not properly checked,"There are some bugs in the way that course context children are checked in the privacy API.

Essentially the course is currently checked instead of the child context being checked.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63919,Disable notifications for automated SARs,"As per Chris Clark's comment in MDL-62563, we should try and rate limit these somehow.



I'd recommend we not send any notification for automated SARs, though this will mean that users who are bulk deleted are also not notified about. Still, better than spamming POs/admins.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63921,Add unit test to ensure userlist compliance,We need a unit test to prove that all user data providers implement the userlist.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63922,Rename site admin links,"We currently have:

# Privacy settings

# Policy settings

# Data requests

# Data registry

# Data deletion

# Plugin privacy registry



I'm not sure about other people, but I regularly get these confused - in particular the Data requests and Data deletion; and the Plugin privacy registry and Data registry.

The re-use of the word ""Data"" makes these hard to follow, and the ""Data deletion"" and ""Data requests"" have similar intent but vastly different meaning (one is for managing expiry, the other requests including deletion requests)



I'd like to propose that we consider renaming these for 3.7.



Pinging [~tsala] for her thoughts here too.



Perhaps we can have:

# Data requests => User requests

# Data deletion => Expiry management

# Plugin privacy registry => Plugin report

# Data registry => Data intent registry



These are just off-the-top-of-my-head ideas.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63924,shared_data_provider should have shared_userlist,"I realised today that we are missing this.



It's far too late to add this to stables, and many of the areas have actually been done already (they're just missing the interface to say so).



We have a {{core_user_data_provider}}. Where this is implemented we are requiring that a {{core_userlist_provider}} also be implemented.



Equally we have a {{shared_data_provider}} which is used by subsystems, and subplugins which do not store data but provide data to others. This needs to have a {{shared_userlist_provider}} too.



I'd propose that we just add the empty interfaces now so that they can be used consistently in the future. Later on we can add the tests for them.

This is largely an accounting thing and will only be used in unit tests, and the plugin registry.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63925,Fix URL in Moodle logo of data export HTML file,"The logo links to ""https://www.moodle.org"", when it should link to ""https://moodle.org"". Since the www subdomain is not supposed to be used, its SSL is improperly configured, so anyone clicking the link would receive a security warning page.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-63926,Add support for removal of context users - block_recentlyaccesseditems,Add support to identify and remove users in a context for block_recentlyaccesseditems. Also create unit tests to cover all privacy provider methods.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63942,Disable delete existing users task by default,"I think we're going to have to disable the {{tool_dataprivacy\task\delete_existing_deleted_users}} by default and, instead, document how to use it (either via Run Now, or setup and run).



We're seeing people hitting issues because of the initial pre-processing.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63943,Summarise SARs from deleted users,"We should not send individual notifications for each automated SARs, we should summarise possibly into one notification. 

",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63946,Incorrect filename in plagiarism provider,"{{plagiarism/classes/privacy/plagiarims_user_provider.php}}

Typo in plagiarism",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63949,Improve unit test creation of purpose and category,"Unit tests which need to generate data privacy purposes and/or categories do so using tool_dataprivacy\purpose and tool_dataprivacy\category manually, which requires unnecessary repeating of code and is not best practice.



These should use a format such as:

{code:java}

$generator = $this->getDataGenerator(); 

$dataprivacygenerator = $generator->get_plugin_generator('tool_dataprivacy');

$purpose = $dataprivacygenerator->create_purpose();

$cat = $dataprivacygenerator->create_category();

{code}

",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63950,Add support for archival of old data requests,"To avoid cluttering the UI it would be helpful if we had the ability to hide/archive requests when they are no longer relevant, but be able to still bring them back when required (e.g. auditing).",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63960,Sometimes deletion data requests fail because of invalid simple key in cache,"Testing MDL-62564, I had a problem with one of the testing sites (master). I did not reproduce it in stables (because I had way simpler/minimal configuration there).



The details are, more or less like:



- Had a couple of purposes, one without retention and another with 50y of retention. Both with the ""protect"" bit set.

- Also a some categories.

- Both the purpose with 50y of retention and one of the categories were set @ site level. Think that everybody else was set to inherit everywhere.



Then, when processing the deletion request (aka, approved => deleted), I got:



{code}

Adhoc task failed: tool_dataprivacy\task\process_data_request_task,Coding error detected, it must be fixed by a programmer: Cache definition tool_dataprivacy/purpose requires simple keys. Invalid key provided.

Debug info:

-1

Backtrace:

* line 958 of /cache/classes/loaders.php: call to cache_helper::hash_key()

* line 392 of /cache/classes/loaders.php: call to cache->parse_key()

* line 1546 of /cache/classes/loaders.php: call to cache->get()

* line 62 of /admin/tool/dataprivacy/classes/purpose.php: call to cache_application->get()

* line 353 of /admin/tool/dataprivacy/classes/data_registry.php: call to tool_dataprivacy\purpose->__construct()

* line 254 of /admin/tool/dataprivacy/classes/data_registry.php: call to tool_dataprivacy\data_registry::get_element_instance()

* line 1002 of /admin/tool/dataprivacy/classes/api.php: call to tool_dataprivacy\data_registry::get_effective_context_value()

* line 1093 of /admin/tool/dataprivacy/classes/api.php: call to tool_dataprivacy\api::get_effective_context_purpose()

* line 99 of /admin/tool/dataprivacy/classes/task/process_data_request_task.php: call to tool_dataprivacy\api::get_approved_contextlist_collection_for_collection()

* line 185 of /lib/cronlib.php: call to tool_dataprivacy\task\process_data_request_task->execute()

* line 74 of /lib/cronlib.php: call to cron_run_inner_adhoc_task()

* line 61 of /admin/cli/cron.php: call to cron_run()

{code}



So, somehow, ""-1"" was being passed and breaking the simple keys the cache is expected to have.



After some trials, I ended removing the retention periods in the purpose, cleaning the ""protected"" bit, purging caches and then the deletion was able to finish properly.



This describes de situation under I got the error. Will try to reproduce it again to see if I can give more detailed steps or find the exact point leading to the problem.



Only reproduced with master but, as far as the configuration is potentially the same in stables, I imagine it will be also reproducible there.



Will comment if I find any other detail. That's all for now.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-63969,Add support for removal of context users - core_favourites,"Add support to identify and remove users in a context for core_favourites, as well as export relevant data. Also implement these in any providers that require them.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64007,Export all my personal data privacy request creates files in the webserver document root,"Setup



Select a Category and Purpose in Site administration -> Users -> Privacy and Policies -> Data registry



Create a course with an assignment and an enrolled student ""s1"".



Ensure ""Online text"" is enabled for submissions and ""Annotate PDF"" and ""Feedback text"" is enables for feedback types.



Grade that student in the assignment and include a file (image) in the feedback comments.



As that student, create a privacy request to export all my personal data.



As an admin approve this privacy request.



Run Cron from CLI (php admin/cli/cron.php)



Verify no files were created in the Moodle folder representing the context structure of your Moodle site.



Example of files:

{quote}System _.1/

System _.1/_files

System _.1/_files/intro

System _.1/_files/intro/path with

System _.1/_files/intro/path with/some spaces

System _.1/_files/intro/_

System _.1/_files/attachments

System _.1/_files/attachments/_12

System _.1/_files/attachments/_12/path

System _.1/_files/attachments/_12/path/within

System _.1/_files/attachments/_12/path/within/a

System _.1/_files/attachments/_12/path/within/a/path

System _.1/_files/attachments/_12/path/within/a/path/within

System _.1/_files/attachments/_12/path/within/a/path/within/a

System _.1/_files/attachments/_12/path/within/a/path/within/a/path

System _.1/_files/submission_attachments

System _.1/_files/submission_attachments/_1

System _.1/_files/submission_attachments/_1/path with

System _.1/_files/submission_attachments/_1/path with/some spaces

System _.1/_files/tests

System _.1/_files/tests/sub

System _.1/_files/submission_content

System _.1/_files/submission_content/_2

System _.1/_files/submission_content/_2/_luou?k_

{quote}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64013,Bootstrap loaded from CDN for privacy exports is fragile,"As of MDL-62491, moodle_content_writer.php loads bootstrap's CSS file from a CDN.



This is fragile for several reasons:

* It requests the URL with a plain fopen(), without using the HTTP proxy if one is configured.

* Failure of the request is not handled, so the process fails with an error if the CDN cannot be contacted.

* The code is called from within unit tests, so the tests will fail if the CDN cannot be contacted. I think its better to avoid connecting to external services in a unit test.



I propose that we have a local copy of the CSS files in the codebase, and copy the appropriate one into the export rather than downloading it from the CDN.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64027,Data request grade provider creates long running query,"When a student makes a data request, the grade privacy provider creates a long running query when adding the grades and modified grades, along with history. The query uses left joins on both the grade and grade history table, however, it also excludes records records that are not in those tables in the final query. Changing these left joins to inner joins makes the query run quickly, even on tables with 2+ million records. The code can be found in <MOODLE>/grade/classes/privacy/provider.php lines 207-224. The proposed fix changes this code to 



$sql = ""

SELECT DISTINCT ctx.id

FROM \{grade_items} gi

JOIN \{context} ctx

ON ctx.instanceid = gi.courseid

AND ctx.contextlevel = :courselevel

JOIN (

SELECT a.id, a.itemid FROM \{grade_grades} a WHERE a.userid = :userid1 OR a.usermodified = :userid2

UNION

SELECT b.id, b.itemid FROM \{grade_grades_history} b WHERE b.userid = :userid3 OR b.loggeduser = :userid4 OR b.usermodified = :userid5

) gg ON gi.id = gg.itemid"";",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64030,User delete request status switches from confirmed to rejected,"[Moodle|http://moodle.org/]{color:#333366} {color}[3.5.3 (Build: 20181112)|http://docs.moodle.org/dev/Releases]



A user send message that the account should be deleted. 

The DPO confirmes. 

In overview the status switches to confirmed

After next cron the status switches to rejected.



Its not possible to delete the account finally through privacy API.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64062,Move favourite conversations from the system context,We should move the favourite conversations from the system context to the user or the conversation context (I can see some benefits for each case).,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-64156,GDPR Data Request immediately to Rejected status upon Approval,"In Moodle 3.5.3. I created the situation for a user to submit a Data Request.



The Data Request was to Export the user's data.



The request was *Approved* by the SysAdmin or DPO and got the correct status.



Immediately after the next cron run the status went from Approved to *Rejected*.



The same process was validated on school.demo.moodle.net which I presume is Moodle 3.5.3? Also on this site the request goes from Approved to Rejected.



Same proces works fine on Moodle 3.5.2 where user is able to download after Approval.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64185,Data_privacy export low on several processes,"# Create a data export demand.

# Run the cron manually through navigator to see all the processes that bring back datas.



When the cron attacks these 3 processes, the server work is very long and I must re-run the cron several times before the processes complete :

* mod_quiz treatment

* tool_log treatment (I've unchecked tool_log | exportlog)

* core_grades treatment



Our logstore-standard-log weights 28 Go ; databases dealing with grades and question attempts must be aroung 1 Go each. Our Moodle count around 50 000 accounts. We use an Apache server, with 4-vCPU 2.4Ghz Xeon E5-2650 processors and 20 Go RAM.



The problem is that I have no idea if my server is the problem, if its performances are too weak or else. Is there any recommended configuration to run properly the data_privacy export ?



(sorry for my english...)",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64205,Invalid user error shows on Data requests page,"This has been originally reported by [~marycooch] at her own site and I was able to reproduce it.



Say a user self-registers but does not confirm the account. Eventually the task {{delete_unconfirmed_users_task}} gets executed and an automatic request to delete the user's data is created (via the observer introduced in MDL-62564), but the user's account is immediately deleted. So we end up with a record in the {{tool_dataprivacy_request}} table pointing to a non-existing userid.



I believe we should not delete the actual user record - even for unconfirmed users - same as we do not deleted them in the {{delete_incomplete_users_task}}",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64216,Very inefficient query in grade provider (MySQL),"The privacy provider for core_grade calls the following SQL in \core_grades\privacy\provider::get_contexts_for_userid(). On MySQL at least, this is incredibly inefficient as it causes full table scans on grade_grades and grade_grades_history. (We have seen it take over 24 hours to run, with 800,000+ and 15.5 million records in those tables respectively.)

{code:sql}SELECT DISTINCT ctx.id

FROM {grade_items} gi

JOIN {context} ctx

ON ctx.instanceid = gi.courseid

AND ctx.contextlevel = :courselevel

LEFT JOIN {grade_grades} gg

ON gg.itemid = gi.id

AND (gg.userid = :userid1 OR gg.usermodified = :userid2)

LEFT JOIN {grade_grades_history} ggh

ON ggh.itemid = gi.id

AND (

ggh.userid = :userid3

OR ggh.loggeduser = :userid4

OR ggh.usermodified = :userid5

)

WHERE gg.id IS NOT NULL

OR ggh.id IS NOT NULL



{code}

This seems to be down to MySQL being unable to optimise the query to use indexes for all the joins and the filters.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64221,Check and update Privacy Provider queries to improve performance,We need to check all of our privacy providers calls to add_from_sql to reduce their complexity. Many of these have a large number of LEFT JOINs when we should (in hindsight) have created them with a large number of queries with INNER JOINs.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64235,Problem with long file names and zip archives under Windows,"This was reported @ MDL-64220, but left out from the solution there because it requires serious analysis and can be, simply, an OS limit. Better handle it separately. Environment: Windows 10 x64 and git bash:



A) 1 error, maybe related to MDL-62617



{code}

There was 1 error:



1) moodle_content_writer_test::test_export_user_preference_long_filename with data set ""More than 100 characters"" ('Etiam sit amet dui vel leo bl...scipit', 'Etiam sit amet dui vel leo bl...a5030d', 'value')

ZipArchive::close(): Read error: Bad file descriptor



C:\Users\stronk7\git_moodle\integration\lib\filestorage\zip_archive.php:224

C:\Users\stronk7\git_moodle\integration\lib\filestorage\zip_packer.php:154

C:\Users\stronk7\git_moodle\integration\privacy\classes\local\request\moodle_content_writer.php:679

C:\Users\stronk7\git_moodle\integration\privacy\tests\moodle_content_writer_test.php:1136

C:\Users\stronk7\git_moodle\integration\privacy\tests\moodle_content_writer_test.php:1088

C:\Users\stronk7\git_moodle\integration\lib\phpunit\classes\advanced_testcase.php:80



To re-run:

vendor/bin/phpunit -v ""moodle_content_writer_test"" privacy/tests/moodle_content_writer_test.php

{code}



This is about to investigate the issue and see it there is any solution that can be implemented our side.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64291,"GDPR export: Context paths can be very long, not unique","When writing GDPR extracts, the path names used to represent contexts within the system can be very long. This contributes to problems for users on Windows (see MDL-62617).



In addition, the paths can be strange - where a context id would normally appear, if it is very long, the context id is not included and instead there is a hash at the end of the string. This seems to me like a bug.



Here is an example context path (this is a real example from our system so please forgive the weird bits): 



System 1/Category Recycle bin_.2629538/Website D849-12E Introduction to quantitative and qualitative research methods_.602872/Wiki Activity 2.72.8 wiki advantages and disadvantages of self-completion questionnaire - d52285d245/



This path is 226 characters long and we haven't even had any files or data yet. In addition, look at the last element of the path:



Wiki Activity 2.72.8 wiki advantages and disadvantages of self-completion questionnaire - d52285d245



The logic used to construct each element, in the function get_context_path in privacy/classes/local/request/moodle_context_writer.php, is:



1. Get the context name

2. Add on a space and the context id

3. Trim to max 100 characters, adding weird hash if it's longer.



In this case, the frankly weird name of the wiki is already longer than 100 characters, which means that the context id gets trimmed off. 



I propose this solution to both improve the chance of it working in Windows, and also consistently include the context id:



1. Get the context name and trim this to a more reasonable length, say 32 characters.

2. Then add on the _. and context id.



The context path will always be unique (because of having the id in) and will not be too long. The example given would turn into



System 1/Category Recycle bin_.2629538/Website D849-12E Introduction t..._.602872/Wiki Activity 2.72.8 wiki advan..._.943106/



Which is a much more reasonable 120-ish characters long, and now if there are two wikis with a similar name, they can be distinguished by context ids, instead of by arbitrary hashes.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-64295,Cron not running; Missing checkboxes on Data Requests page,"On the SiteAdministrations->Notifications page cron says it hasn't run within 24 hours.

On the DataRequests page all data request records are in the Pre-processing state.



Strange I say, and I'm trying to run the cron. No chance to run completely...

What I noticed: when I run the cron from CLI and there is a request to delete personal data, the *is_course_context_expired_or_unprotected_for_user (\context $context, \stdClass $user)* function raise an exception right after the call *is_fully_expired ()* function:



*Call to a member function is_fully_expired() on null*



That's what I did: I inserted immediately after line 925 in the file ""moodle/admin/tools/dataprivacy/classes/expired_contexts_manager.php"":

{quote}*if (is_null($info)) return false;*

{quote}

and I run the cron. It worked correctly.

Is really a bug or my database is corrupted?",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64322,GDPR: Mechanism for restricting delete requests,"In our institution we do not want our 'DPO' staff to be able to make delete requests. 



Delete requests are dangerous as obviously they delete the user's data meaning that our system stops working for the user. Although there are plenty of steps in the process, we and they are still worried that it might happen by accident, so we have been requested to remove the option. 



(Some background: our process is that we will never apply student deletion requests on our main system - we can use various other aspects of GDPR law to justify keeping the data for all students for the retention period.)



Currently if you give somebody the tool/dataprivacy:managedatarequests capability, they by default become a DPO, or you can configure the role list in admin settings... this capability is weird... Anyway my point is there is an existing tool/dataprivacy:managedatarequests capability, it is complicated and I don't want to change it.



h2. Proposal



Add a new capability



*tool/dataprivacy:requestdeleteforotheruser*



1. When visiting the form for making a new request for another user, admin/tool/dataprivacy/createdatarequest.php?manage=1, if you do *not* have this new capability then the 'Type' dropdown would be fixed to the single value 'Export all of my personal data'. (The form field will be frozen so it doesn't appear as a dropdown any more.) You will not be able to select the other option 'Delete all of my personal data'.



2. If making a request for yourself (the same form but without the manage=1) then there is no change and both options will be available regardless of capabilities. (Note: We could consider also adding a second new capability tool/dataprivacy:requestdelete, that works a similar way but for individuals - we haven't got that requirement here but I'm happy to get it implemented as part of this if people think it would be beneficial/more consistent.)



3. The new capability would initially be made to default to the value of tool/dataprivacy:managedatarequests (so maintaining existing behaviour).



4. The development should include a simple Behat scenario to check the new feature (i.e. set up a role that does/doesn't have this capability, go to the form and confirm the option is/isn't there).",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64323,GDPR: New request form user search - not using configured fields,"When creating a GDPR request on behalf of a user, you need to search for them in the user field.



The AJAX selector that searches for a user does not use the appropriate logic. It always searches the names (first/last), email, and username. 



It never searches the extra fields that are specified in admin settings (showuseridentity).



This code is in admin/tool/dataprivacy/classes/external.php, function get_users.



Currently it uses the datalib get_users function, which behaves incorrectly (as above) - it should probably be deprecated really. For example, in sites that don't support email address or username for searching, it probably shouldn't be searched.



I searched the code for examples of how to do this correctly, I believe it is roughly:



$extrafields = get_extra_user_fields($context);

list($sql, $params) = users_search_sql($query, 'u', false, $extrafields, $excludedusers);



(And then do the SQL query.)



In addition to this, the display of the user name popup (after you search and it finds somebody) which can be found in templates/form-user-selector-suggestion.mustache is not really appropriate either - this should:



(a) display the user's name 

and

(b) also show - probably as a comma separated list - any fields that are returned by the get_extra_user_fields($context) function.



Currently it shows like 'Full Name (email)'. So it should show:



- If there's nothing from get_extra_user_fields, just 'Full name'

- If there is a response, then those fields, in that order, comma-separated, e.g. 'Full Name (email, idnumber, department)'



A particular use case for this is to search for somebody by their student number (idnumber). This is not possible in the current system. Not very helpful for our admin staff. :) But anyway, it ought to support the standard admin settings in this area.



So to summarise all this into what needs doing (my opinion):



1. The search should use all the fields selected in the showuseridentify admin setting, in addition to names, if the current user has moodle/site:viewuseridentity permission. If they do not have that permission then it should only search names.



2. When displaying the popup of the selected user, this should also show all the fields selected in showuseridentity, in addition to names, if the current user has moodle/site:viewuseridentity permission. If they do not have that permission then it should only show names.



3. There should be a PHPunit test of the web service to test the search behaviour. This should cover (may be one or several tests): 

* searching by name, as present (finds the user)

* searching by a field configured in admin settings when user has viewuseridentity permission (finds the user)

* searching by a field when user doesn't have viewuseridentity permission (doesn't find the user)

* searching for a different field that is not configured in admin settings, when user does have permission (doesn't find the user)



4. There should be a Behat test of the overall interface to test the popup appearance. This should cover:

* display when user does not have the viewuseridentity, name only

* display when they do have it, include all fields selected in admin settings (and not other fields)",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64335,Privacy add_to_sql() fails with DISTINCT query with brackets,"If a plugin uses the (slightly dodgy) ""SELECT DISTINCT(contextid)"" construct in its privacy provider's add_to_sql() calls, the id field is guessed as ""DISTINCT"" and the query fails.



I would expect this to be either ""not guessed"" or contextid.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64379,GDPR Data Deletion Deletes Guest Account,"the last access time of guest account is not updeted for performance when visiters are using guest account to access Moodle, so the last access of guest is 'Never', and the GDPR Data Deletion does not exclule the guest account, and, so the guest account is deleted by GDPR Data deletion after the Retention period. it results in the Moodle site can not be accessed by Guest.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64424,Data request processing dies with exception: Call to a member function is_fully_expired() on null,"We have experienced this on one of our Moodle community sites running version 3.5.3. Processing the personal data requests died with thrown exception ""Call to a member function is_fully_expired() on null""



{code}

PHP Notice: Undefined index: /50/5310 in /var/www/html/admin/tool/dataprivacy/classes/expired_contexts_manager.php on line 925

PHP Notice: Trying to get property of non-object in /var/www/html/admin/tool/dataprivacy/classes/expired_contexts_manager.php on line 925

Default exception handler: Exception - Call to a member function is_fully_expired() on null Debug: 

Error code: generalexceptionmessage

* line 926 of /admin/tool/dataprivacy/classes/expired_contexts_manager.php: Error thrown

* line 902 of /admin/tool/dataprivacy/classes/expired_contexts_manager.php: call to tool_dataprivacy\expired_contexts_manager::is_course_context_expired_or_unprotected_for_user()

* line 1091 of /admin/tool/dataprivacy/classes/api.php: call to tool_dataprivacy\expired_contexts_manager::is_context_expired_or_unprotected_for_user()

* line 82 of /admin/tool/dataprivacy/classes/task/initiate_data_request_task.php: call to tool_dataprivacy\api::add_request_contexts_with_status()

* line 185 of /lib/cronlib.php: call to tool_dataprivacy\task\initiate_data_request_task->execute()

* line 74 of /lib/cronlib.php: call to cron_run_inner_adhoc_task()

* line 61 of /admin/cli/cron.php: call to cron_run()



!!! Exception - Call to a member function is_fully_expired() on null !!!

{code}



The reported context path {{/50/5310}} is the context of the site's front page.



This was consulted with [~dobedobedoh] who concluded:



bq. We possibly have missed a case where there's activities on the course frontpage in our testing.



and suggested a way to fix this.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64446,GDPR Data deletion - Course deletion,"When I select a course in ""Data deletion"" and I delete it the course remain available also after the scheduled tasks were executed.

If the course have the self enrollment active, users can enroll to the course and do activities also if all the contexts of the course results as deleted on DB (status 2 in mdl_tool_dataprivacy_ctxexpired).



STEP TO REPRODUCE

# Create a new course

# Set auto enrollment active

# Set start and end date (you can set also date in the past so you do not wait days)

# If not created in data registry, create a purpose for the course (I created a purpose with 1 day retention for the site so the course inherit it)

# Create some activities on the course

# Do some activities as student on the course

# Use ""Data deletion"" for delete the course

# Run the privacy scheduled tasks



At this point I expect that the course is not available any more but the course is still visile (without participants and with empty activities) and students can enroll and do activities on the course.



Sorry for my bad English! :-)",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64497,GDPR: moodle_content_writer can cause endless loop,"Here is some code from moodle_content_writer::get_file_content:



{code}

$filepointer = fopen($filepath, 'r');

while (!feof($filepointer)) {

// ...

}

{code}



The 'fopen' returns FALSE on error. Meanwhile, feof returns FALSE if its file pointer is not valid, such as when you pass in FALSE. (See second big red 'WARNING' box on the PHP manual page.)



This error condition could occur for a variety of reasons (e.g. temporary file system failure) or possibly if there is a bug in a plugin's provider implementation. If it does occur, the consequences are likely to be terminal for the server unless an operator takes prompt action. In our case on a test server this endless loop, with PHP warnings occuring each time, caused the PHP error log to reach 56 GB and run out of space in the partition within an hour or so, so that the test server was not able to respond to requests. 



We would rather this doesn't happen on the production server. :)



In addition I noticed another error, which is that this function never calls fclose($filepointer). It's possible that this may have been what caused it to fail in the first place (if it opened many thousands of files using this function in the same request).



Finally, er, I can't see any reason this function is different from file_get_contents, other than having two critical bugs in it. :)



I am submitting a fix as follows:



1. Replace the entire contents of the buggy function with a call to file_get_contents.

2. Check the return value and throw an exception if it failed.

3. Also throw an exception if it fails writing the file, so that we detect the error closer to the point it occurs.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64541,Data Export download Zip can't be opened by Windows,"A user downloads their data as part of the ""Export all of my data"" request.



The Zip file downloads. They double click to open it. 



They get an error message:



*{{Windows cannot open the folder.}}{{The Compressed (zipped) Folder 'location....zip' is invalid}}*



{{So far I have tested this on Windows 7 and Windows 10 and got the same error message.}}



{{The file does open in dedicated Zip software like 7-Zip.}}",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64601,Privacy accessibility review,Review of accessibility for privacy user interfaces,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64627,Action-menu doesn't work on data request page. Solved.,"Hello,



there is a problem on Data request page on Moodle 3.5.4. Actions-menu items do not display correctly at all, you cannot see them all. Tested with Clean and Boost themes.



Tested with: 

* Moodle 3.5.4

* theme_boost 2016102100

* theme_clean ????







!gdpr_boost.png|thumbnail!!gdpr_clean.png|thumbnail!



",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64644,Data Request processing throws error,"We recently got the first request for personal data according to to the GDPR. After one issue was solved by the update to 3.4.7 (missing categories prevented processing of the request), we encountered another problem. Every time such a request was processed the admin user got an error message:



{{Ausnahme beim Aufruf von CORE_COURSE\PRIVACY\PROVIDER::EXPORT_USER_DATA.}}

{{Das Plugin CORE_COURSE konnte die Verarbeitung der Daten nicht beenden.}}

{{Unten finden Sie Informationen f_r den Pluginentwickler}}{{Return value of core_completion\privacy\provider::get_course_completion_info() must be of the type array, none returned}}{{#0 /srv/moodle/course/classes/privacy/provider.php(115): core_completion\privacy\provider::get_course_completion_info(Object(stdClass), Object(stdClass))}}

{{#1 /srv/moodle/lib/moodlelib.php(7781): core_course\privacy\provider::export_user_data(Object(core_privacy\local\request\approved_contextlist))}}

{{#2 /srv/moodle/privacy/classes/manager.php(578): component_class_callback('core_course\\pri...', 'export_user_dat...', Array)}}

{{#3 /srv/moodle/privacy/classes/manager.php(611): core_privacy\manager::component_class_callback('core_course', 'core_privacy\\lo...', 'export_user_dat...', Array)}}

{{#4 /srv/moodle/privacy/classes/manager.php(339): core_privacy\manager->handled_component_class_callback('core_course', 'core_privacy\\lo...', 'export_user_dat...', Array)}}

{{#5 /srv/moodle/admin/tool/dataprivacy/classes/task/process_data_request_task.php(107): core_privacy\manager->export_user_data(Object(core_privacy\local\request\contextlist_collection))}}

{{#6 /srv/moodle/lib/cronlib.php(185): tool_dataprivacy\task\process_data_request_task->execute()}}

{{#7 /srv/moodle/lib/cronlib.php(74): cron_run_inner_adhoc_task(Object(tool_dataprivacy\task\process_data_request_task))}}

{{#8 /srv/moodle/admin/cli/cron.php(61): cron_run()}}

{{#9 \{main}}}



The data request itself seems to be completed anyway. Probably missing the course completion status. 



",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64645,"Deleting unconfirmed users in cleanup task creates invalid data requests when ""Create automatic data deletion requests"" setting is enabled","When ""Create automatic data deletion requests (tool_dataprivacy | automaticdeletionrequests)"" setting is enabled, a new data request for the deleted user will be created from an observer listening for ""user_deleted"" event. This assumes the deleted user's record in mdl_user table presents, which is true in most cases.



However if the deleted user is an unconfirmed user (clean up task using ""Delete not fully setup users after"" setting), the logic in ""delete_unconfirmed_users_task"" is:



- call delete_user() function, which triggers the ""user_deleted"" event, thus create a data request.



- then delete user's record from mdl_user table.



This will end up with a data request on a record in mdl_user table that doesn't exist. When site administrators try to access the data request page, they will see a ""Invalid user"" error.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64652,Personal data export dies after exhausting all the available memory,"We are experiencing this on moodle.org running on latest 3.6.2 version. I've requested my personal data to be exported. Once the request is approved, the adhoc task is created and executed as expected. The output of that processing looks like this

{code}

[PID 5857] Execute adhoc task: tool_dataprivacy\task\process_data_request_task

[PID 5857] ... started 04:21:05. Current memory use 5.7MB.

[PID 5857] Pre-processing request...

[PID 5857] Fetching data from 486 components (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing antivirus_clamav (1/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing availability_completion (2/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing availability_date (3/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing availability_grade (4/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing availability_group (5/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing availability_grouping (6/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing availability_profile (7/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_calculated (8/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_calculatedmulti (9/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_calculatedsimple (10/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_ddimageortext (11/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_ddmarker (12/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_ddwtos (13/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_description (14/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_essay (15/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_gapselect (16/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_match (17/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_missingtype (18/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_multianswer (19/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_multichoice (20/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_numerical (21/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_random (22/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_randomsamatch (23/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_shortanswer (24/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing qtype_truefalse (25/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing mod_assign (26/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing mod_assignment (27/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing mod_book (28/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing mod_chat (29/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing mod_choice (30/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing mod_data (31/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing mod_feedback (32/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing mod_folder (33/486) (Monday, 21 January 2019, 9:21 PM)

[PID 5857] Processing mod_forum (34/486) (Monday, 21 January 2019, 9:21 PM)

{code}



where is gets stuck for a while (seems like 3 hours), and then eventually the process dies with



{code}

PHP Fatal error: Allowed memory size of 8589934592 bytes exhausted (tried to allocate 4096 bytes) in .../lib/dml/mysqli_native_moodle_recordset.php on line 55

{code}



There are 4309 records in the forum_posts with userid = 1601 (my user id), to give an estimation about the amount of exported data.



Those 8GB are roughly a half of the whole RAM available on that machine.



We will appreciate an advise from HQ experts in the area, pinging [~dobedobedoh] and [~stronk7]. Also letting know [~carlopolizzi] as this has impact on our legal obligations, and [~prg3], the site's sysadmin.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64695,tool_dataprivacy doesn't filter multilang tags within $SITE->fullname,"In our Moodle installation, $SITE->fullname contains multilang tags (for the german and english site name). 



We have noticed that tool_dataprivacy doesn't filter these multilang tags. As a result, the multilang tags are still there in the mail notifications which are sent for data requests (e.g. https://github.com/moodle/moodle/blob/master/admin/tool/dataprivacy/classes/task/process_data_request_task.php#L179) as well as in the data export's index.html



My proposal is to replace all occurences of $SITE->fullname with filter_string($SITE->fullname)",0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64702,Badges does not include related data in a privacy export,"The following additional pieces of data were added to badges in 3.6, but the privacy API does not include any of them.



Related badges, alignments, endorsements.







",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64714,Privacy API delete_data_for user function in oauth2 and mnet exit early,"In the core auth plugins, ""oauth2"" and ""mnet"", the privacy provider function ""delete_data_for_user"" may exit the function without actually doing what they need to do.



The code loops through the provided contextlist and exits the function if it encounters a context that is not CONTEXT_USER:

{code:java}

foreach ($contextlist->get_contexts() as $context) {

if ($context->contextlevel != CONTEXT_USER) {

return;

}



// Because we only use user contexts the instance ID is the user ID.

$DB->delete_records('mnet_log', ['userid' => $context->instanceid]);

}{code}

If the contextlist has multiple contexts that include a CONTEXT_USER, but encounters a non CONTEXT_USER before them, it will exit without processing the CONTEXT_USER. Shouldn't it be written as:

{code:java}

foreach ($contextlist->get_contexts() as $context) {

if ($context->contextlevel != CONTEXT_USER) {

continue;

}



// Because we only use user contexts the instance ID is the user ID.

$DB->delete_records('mnet_log', ['userid' => $context->instanceid]);

}{code}

I have replaced ""return"" with ""continue"".",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64718,Admin user can GDPR delete themselves even when they are the only site admin,"On a fresh site, as the admin:



# Navigate to ""Site administration"" > ""Users"" > ""Privacy and policies"" > ""Privacy settings"" and enable the setting ""tool_dataprivacy | contactdataprotectionofficer""

# As the site admin go to your profile and under the ""Privacy and policies"" section click ""Delete my account"" and go through the form to create the deletion request

# Run cron and do all that jazz so that you can approve the request

# After approving the request, run cron again and behold, no more site admin



We would have expected something to stop the request being made or at the very least something to stop it being processed.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64737,Exception occurred while calling editor_atto\privacy\provider::export_user_data,"This has been reported by [~marycooch] and [~tsala] as affecting the personal data requests on moodle community sites. We are receiving the following exception.



{code}

Exception occurred while calling editor_atto\privacy\provider::export_user_data.

This means that plugin editor_atto did not complete the processing of data. The following exception information may be passed on to the plugin developer:



ERROR: missing param ""param60"" in query



#0 /var/www/html/lib/dml/mysqli_native_moodle_database.php(1178): moodle_database->fix_sql_params('SELECT *\n ...', Array)

#1 /var/www/html/lib/editor/atto/classes/privacy/provider.php(138): mysqli_native_moodle_database->get_recordset_sql('SELECT *\n ...', Array)

#2 /var/www/html/lib/moodlelib.php(7858): editor_atto\privacy\provider::export_user_data(Object(core_privacy\local\request\approved_contextlist))

#3 /var/www/html/privacy/classes/manager.php(578): component_class_callback('editor_atto

pri...', 'export_user_dat...', Array)

#4 /var/www/html/privacy/classes/manager.php(611): core_privacy\manager::component_class_callback('editor_atto', 'core_privacy

lo...', 'export_user_dat...', Array)

#5 /var/www/html/privacy/classes/manager.php(339): core_privacy\manager->handled_component_class_callback('editor_atto', 'core_privacy

lo...', 'export_user_dat...', Array)

#6 /var/www/html/admin/tool/dataprivacy/classes/task/process_data_request_task.php(113): core_privacy\manager->export_user_data(Object(core_privacy\local\request\contextlist_collection))

#7 /var/www/html/lib/cronlib.php(259): tool_dataprivacy\task\process_data_request_task->execute()

#8 /var/www/html/lib/cronlib.php(147): cron_run_inner_adhoc_task(Object(tool_dataprivacy\task\process_data_request_task))

#9 /var/www/html/lib/cronlib.php(68): cron_run_adhoc_tasks(1548845762)

#10 /var/www/html/admin/cli/cron.php(61): cron_run()

{code}



This seems to be a regression of MDL-62601 as currently, the method {{\editor_atto\privacy\provider::export_user_data()}} in the lib/editor/atto/classes/privacy/provider.php is apparently wrong as it works with an undefined variable contextsql in the first query there.



Easily to reproduce:

{code}

$ vendor/bin/phpunit lib/editor/atto/tests/privacy_provider.php

{code}



I was wondering why this has not been caught by our automatic unit test runs as it clearly fails. I realized the problem is with incorrectly named testsuite file. Only files ending with ""_test.php"" suffix are implicit part of a testsuite. So our PHPUnit infrastructure has always skipped this file (and one other I found) and it was never detected.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64748,Removing the option for Notes at Site Context,"If Notes are enabled any user with a Teacher role in any course can make a note against a participant in their course but save it at site level. This will then be visible to any other teacher in any other course within the site.



We would like to remove the option to create site wide notes as we have concerns about privacy/GDPR. We also have concerns that some teachers do not understand the implications of creating such notes (some of them may think of their course as a 'site'). 



Looking at the settings and permissions it does not seem that Notes has any granularity as to how it is deployed within the personal/course/site contexts. Currently it is a simple on/off switch. We would like to see Admin settings changed to allow specific contexts to be enabled/disabled.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-64782,performance improvement for get_users_in_context (take #2),"This is a followup of MDL-63785 where a good number of privacy queries were simplified to avoid joining with the contexts table when the contexts being searched are block, course or user. Simply because the instanceid of those contexts that we are fetching now is, already, the block, course or user id that we have in the different tables.



This issue is about to look for remaining cases ([some were detected|https://tracker.moodle.org/browse/MDL-63785?focusedCommentId=656628&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-656628] in the original issue, there may be more) to follow the same simplification approach if the original one is accepted.



Ciao :-)",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-65006,Inactivating a (tool_policy) policy puts users into infinite loop upon following login,"Inactivating a policy that has been created with an initial ""Active"" status results in users being stuck in an infinite redirect loop upon login.



This does not affect users created after the policy was made inactive.



Steps to reproduce:

# Login as a non-admin user in one browser

# Login as admin in another browser

# As admin, create new policy, set it as initially active, save it

# As non-admin user, refresh page, see policy request screen, do not accept policy, logout

# As admin, make policy inactive

# As non-admin, try login in, get stuck in infinite redirection loop



Expected result: login without having to accept the policy.



Workaround: if the admin manually accepts the (inactive) policy for the user, that user can now login as expected.



Tested on 3.6.2 and on master (3.7dev / March 7th 2018).",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-65197,Empty 'htmleditor' user preference causes debug warning in Privacy export,"Somehow we have user preference values containing an empty string for 'htmleditor':



{code:sql}

SELECT * FROM `mdl_user_preferences` WHERE name = 'htmleditor' AND value = '' 

{code}



||id||userid||name||value||

|150|2|htmleditor| |

|162|4|htmleditor| |

|166|409|htmleditor| |

|219|2486|htmleditor| |



Running a privacy export produces the following debugging:



{code}

Processing core_editor (457/501) (Wednesday, 27 March 2019, 11:37 AM)

++ Invalid get_string() identifier: 'pluginname' or component 'editor_'. Perhaps you are missing $string['pluginname'] = ''; in /lang/en/editor_.php? ++

* line 349 of /lib/classes/string_manager_standard.php: call to debugging()

* line 7153 of /lib/moodlelib.php: call to core_string_manager_standard->get_string()

* line 68 of /lib/editor/classes/privacy/provider.php: call to get_string()

* line 7828 of /lib/moodlelib.php: call to core_editor\privacy\provider::export_user_preferences()

* line 578 of /privacy/classes/manager.php: call to component_class_callback()

* line 611 of /privacy/classes/manager.php: call to core_privacy\manager::component_class_callback()

* line 361 of /privacy/classes/manager.php: call to core_privacy\manager->handled_component_class_callback()

* line 79 of /privacy_test_export.php: call to core_privacy\manager->export_user_data()

{code}



Inspecting the exported data:



{code}

var data_file_1104 = {

""htmleditor"": {

""value"": """",

""description"": ""Your preferred editor to use for writing HTML text is [[pluginname]]""

}

}

{code}



Affects all versions from 3.5 onwards



Discovered when using the [Test of exporting user data|https://docs.moodle.org/dev/Privacy_API/Utilities#Test_of_exporting_user_data] utility",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDL-65584,Error while calling core_blog\privacy\provider::delete_data_for_user.,"As noticed on the Learn Moodle site when some accounts were deleted by the privacy office - the following error message appeared:

***********

Exception occurred while calling core_blog\privacy\provider::delete_data_for_user.

This means that plugin core_blog did not complete the processing of data. The following exception information may be passed on to the plugin developer:



Coding error detected, it must be fixed by a programmer: moodle_database::get_in_or_equal() does not accept empty arrays





#0 /opt/app/blog/classes/privacy/provider.php(463): moodle_database->get_in_or_equal(Array, 1, 'param', true)

#1 /opt/app/lib/moodlelib.php(7880): core_blog\privacy\provider::delete_data_for_user(Object(core_privacy\local\request\approved_contextlist))

#2 /opt/app/privacy/classes/manager.php(578): component_class_callback('core_blog\\priva...', 'delete_data_for...', Array)

#3 /opt/app/privacy/classes/manager.php(611): core_privacy\manager::component_class_callback('core_blog', 'core_privacy\\lo...', 'delete_data_for...', Array)

#4 /opt/app/privacy/classes/manager.php(415): core_privacy\manager->handled_component_class_callback('core_blog', 'core_privacy\\lo...', 'delete_data_for...', Array)

#5 /opt/app/admin/tool/dataprivacy/classes/task/process_data_request_task.php(134): core_privacy\manager->delete_data_for_user(Object(core_privacy\local\request\contextlist_collection))

#6 /opt/app/lib/cronlib.php(185): tool_dataprivacy\task\process_data_request_task->execute()

#7 /opt/app/lib/cronlib.php(74): cron_run_inner_adhoc_task(Object(tool_dataprivacy\task\process_data_request_task))

#8 /opt/app/admin/cli/cron.php(61): cron_run()

#9 {main}

*****",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
MDL-65615,Digital age of consent country-age map (agedigitalconsentmap) update,Some European countries now have their local law that specify the digital age of consent. We should update the {{$CFG->agedigitalconsentmap}} default accordingly.,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12263,A user can send a message to the Data Protection Officer,"Test requirements:

* A site with a Data Protection Officer (DPO) role set up as described in the documentation [Data Protection Officer role|https://docs.moodle.org/en/Data_Protection_Officer_role]. A user should be assigned the role of DPO in the system context.

* The 'Contact Data Protection Office' checkbox to be ticked in 'Privacy settings' in the Site administration. 



You may use the [QA testing site|https://qa.moodle.net/] for this test, which has a DPO role already set up and a user assigned the role. The site also has the 'Contact Data Protection Office' checkbox ticked.



# Log in as an ordinary user and go to your profile page.

# Verify that it contains a Privacy section.

# Click the 'Contact Data Protection Officer' link.

# Click the Send button without entering a message and verify that the message is a required field.

# Enter a message then click Send.

# Log in as the DPO and verify that you have a data request general inquiry notification.

# Click the link to view the full notification and verify that the message is correct.

# Click the 'Data requests' link and verify that the message is listed.

# In the Actions menu, click to view the request.

# Verify that message is displayed in a modal window together with the user's name, email address, message date and status.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12264,A user can request a copy of their data,"Test requirements:

* A site with a Data Protection Officer (DPO) role set up as described in the documentation [Data Protection Officer role|https://docs.moodle.org/en/Data_Protection_Officer_role]. A user should be assigned the role of DPO in the system context.

* The 'Contact Data Protection Office' checkbox to be ticked in 'Privacy settings' in the Site administration.



You may use the [QA testing site|https://qa.moodle.net/] for this test, which has a DPO role already set up and a user assigned the role. The site also has the 'Contact Data Protection Office' checkbox ticked.

# Log in as an ordinary user and go to your profile page.

# Click the 'Data requests' link.

# Click the 'New request' button then in the form ensure 'Export all of my personal data' is selected as type, enter a comment, then save changes.

# Verify that on the Data requests page, the message 'Your request has been submitted to the site's Data Protection Officer' is displayed and your data request is listed with status 'Pending'.

# Click the 'New request' button again, click 'Save changes' and verify that the message 'You already have an ongoing request.' is displayed.

# Click the Cancel button then on the Data requests page cancel your data request via the Actions menu.

# Verify that your data request is listed with status 'Cancelled'.

# Click the 'New request' button again, enter a comment and save changes.

# Log out then log in as the DPO.

# Verify that you have an export personal data request notification.

# Click the link to view the full notification and verify that the comment is correct.

# Click the 'Data requests' link and verify that the request is listed with status 'Awaiting approval'.

# Verify that there is another request listed with status Cancelled.

# For the request awaiting approval, in the actions dropdown try viewing the request then approving it.

# Verify that the request is now listed with status Approved.

# Log out then log in as the user.

# Verify that you have an export personal data request notification saying that your personal data is available for download.

# Go to your Data requests page again and verify that your data request is listed with status 'Complete'.

# In the Actions dropdown menu select Download.

# Verify that a zip file is downloaded.

# Repeat steps 8 - 14 but this time as the DPO reject the request.

# Log in as the user and go to your Data requests page.

# Verify that your data request is listed with status 'Rejected'.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12265,CLONE - A user can send a message to the Data Protection Officer,"Test requirements:

* A site with a Data Protection Officer (DPO) role set up as described in the documentation [Data Protection Officer role|https://docs.moodle.org/en/Data_Protection_Officer_role]. A user should be assigned the role of DPO in the system context.

* The 'Contact Data Protection Office' checkbox to be ticked in 'Privacy settings' in the Site administration.



You may use the [QA testing site|https://qa.moodle.net/] for this test, which has a DPO role already set up and a user assigned the role. The site also has the 'Contact Data Protection Office' checkbox ticked.

# Log in as an ordinary user and go to your profile page.

# Verify that it contains a Privacy section.

# Click the 'Contact Data Protection Officer' link.

# Click the Send button without entering a message and verify that the message is a required field.

# Enter a message then click Send.

# Log in as the DPO and verify that you have a data request general inquiry notification.

# Click the link to view the full notification and verify that the message is correct.

# Click the 'Data requests' link and verify that the message is listed.

# In the Actions menu, click to view the request.

# Verify that message is displayed in a modal window together with the user's name, email address, message date and status.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12266,CLONE - A user can request a copy of their data,"Test requirements:

* A site with a Data Protection Officer (DPO) role set up as described in the documentation [Data Protection Officer role|https://docs.moodle.org/en/Data_Protection_Officer_role]. A user should be assigned the role of DPO in the system context.

* The 'Contact Data Protection Office' checkbox to be ticked in 'Privacy settings' in the Site administration.



You may use the [QA testing site|https://qa.moodle.net/] for this test, which has a DPO role already set up and a user assigned the role. The site also has the 'Contact Data Protection Office' checkbox ticked.

# Log in as an ordinary user and go to your profile page.

# Click the 'Data requests' link.

# Click the 'New request' button then in the form ensure 'Export all of my personal data' is selected as type, enter a comment, then save changes.

# Verify that on the Data requests page, the message 'Your request has been submitted to the site's Data Protection Officer' is displayed and your data request is listed with status 'Pending'.

# Click the 'New request' button again, click 'Save changes' and verify that the message 'You already have an ongoing request.' is displayed.

# Click the Cancel button then on the Data requests page cancel your data request via the Actions menu.

# Verify that your data request is listed with status 'Cancelled'.

# Click the 'New request' button again, enter a comment and save changes.

# Log out then log in as the DPO.

# Verify that you have an export personal data request notification.

# Click the link to view the full notification and verify that the comment is correct.

# Click the 'Data requests' link and verify that the request is listed with status 'Awaiting approval'.

# Verify that there is another request listed with status Cancelled.

# For the request awaiting approval, in the actions dropdown try viewing the request then approving it.

# Verify that the request is now listed with status Approved.

# Log out then log in as the user.

# Verify that you have an export personal data request notification saying that your personal data is available for download.

# Go to your Data requests page again and verify that your data request is listed with status 'Complete'.

# In the Actions dropdown menu select Download.

# Verify that a zip file is downloaded.

# Repeat steps 8 - 14 but this time as the DPO reject the request.

# Log in as the user and go to your Data requests page.

# Verify that your data request is listed with status 'Rejected'.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12271,A user can request for their personal data to be deleted,"Test requirements:

* A site with a Data Protection Officer (DPO) role set up as described in the documentation [Data Protection Officer role|https://docs.moodle.org/en/Data_Protection_Officer_role]. A user should be assigned the role of DPO in the system context.

* The 'Contact Data Protection Office' checkbox to be ticked in 'Privacy settings' in the Site administration.



You may use the [QA testing site|https://qa.moodle.net/] for this test, which has a DPO role already set up and a user assigned the role. The site also has the 'Contact Data Protection Office' checkbox ticked.

# Log in as an ordinary user and go to your profile page.

# Click the 'Data requests' link.

# Click the 'New request' button then in the form select 'Delete all of my personal data' and enter a comment, then save changes.

# Verify that on the Data requests page, the message 'Your request has been submitted to the site's Data Protection Officer' is displayed and your data request is listed with status 'Pending'.

# Click the 'New request' button again, and try making another request to delete all of your personal data.

# Verify that the message 'You already have an ongoing request.' is displayed.

# Log out then log in as the DPO.

# Verify that you have a delete personal data request notification.

# Click the link to view the full notification and verify that the comment is correct.

# Click the 'Data requests' link and verify that the request is listed with status 'Awaiting approval'.

# In the actions dropdown try viewing the request then approving it.

# Verify that the request is now listed with status Approved.

# Log out then try logging in again the user.

# Verify that the message 'Invalid login, please try again' is displayed, and that you are unable to log in (as the account has been deleted).",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12272,CLONE - A user can request for their personal data to be deleted,"Test requirements:

* A site with a Data Protection Officer (DPO) role set up as described in the documentation [Data Protection Officer role|https://docs.moodle.org/en/Data_Protection_Officer_role]. A user should be assigned the role of DPO in the system context.

* The 'Contact Data Protection Office' checkbox to be ticked in 'Privacy settings' in the Site administration.



You may use the [QA testing site|https://qa.moodle.net/] for this test, which has a DPO role already set up and a user assigned the role. The site also has the 'Contact Data Protection Office' checkbox ticked.



# Log in as an ordinary user and go to your profile page.

# Click the 'Data requests' link.

# Click the 'New request' button then in the form select 'Delete all of my personal data' and enter a comment, then save changes.

# Verify that on the Data requests page, the message 'Your request has been submitted to the site's Data Protection Officer' is displayed and your data request is listed with status 'Pending'.

# Click the 'New request' button again, and try making another request to delete all of your personal data.

# Verify that the message 'You already have an ongoing request.' is displayed.

# Log out then log in as the DPO.

# Verify that you have an delete personal data request notification.

# Click the link to view the full notification and verify that the comment is correct.

# Click the 'Data requests' link and verify that the request is listed with status 'Awaiting approval'.

# In the actions dropdown try viewing the request then approving it.

# Verify that the request is now listed with status Approved.

# Log out then try logging in again the user.

# Verify that the message 'Invalid login, please try again' is displayed, and that you are unable to log in (as the account has been deleted).",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12275,A user can request personal data on behalf of another user,"Test requirements:

* A site with a privacy officer role set up as described in the documentation [Privacy officer role|https://docs.moodle.org/35/en/Privacy_officer_role]. A user should be assigned the role of privacy officer in the system context.

* The 'Contact privacy officer' checkbox to be ticked in 'Privacy settings' in the Site administration.

* A site with a parent role set up as described in the documentation [Parent role|https://docs.moodle.org/en/Parent_role] which also has the capability tool/dataprivacy:makedatarequestsforchildren allowed. A user should be assigned the role of parent to another user in the user context.



You may use the [QA testing site|https://qa.moodle.net/] for this test, which has privacy officer and parent roles already set up with users assigned. The site also has the 'Contact privacy officer' checkbox ticked. The user with the parent role is parent to user Sam Student.

# Log in as the privacy officer and go to Data requests in the Site administration.

# Click the 'New request' button then in the form select a user to request data for, enter a comment and save changes.

# Verify that on the Data requests page the data request is listed with status 'Pending'.

# Log out then log in as a user with the role of parent for another user (their child).

# Go to your profile page and click the 'Data requests' link.

# Click the 'New request' button then in the form, search for your child to request data for.

# Verify that only your child is listed.

# Enter a comment and save changes.

# Verify that on the Data requests page, the message 'Your request has been submitted to the site's privacy officer' is displayed and your data request is listed with status 'Pending'.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12276,CLONE - A user can request personal data on behalf of another user,"Test requirements:

* A site with a Data Protection Officer (DPO) role set up as described in the documentation [Data Protection Officer role|https://docs.moodle.org/en/Data_Protection_Officer_role]. A user should be assigned the role of DPO in the system context.

* The 'Contact Data Protection Office' checkbox to be ticked in 'Privacy settings' in the Site administration.

* A site with a Parent role set up as described in the documentation [Parent role|https://docs.moodle.org/en/Parent_role] which also has the capability tool/dataprivacy:makedatarequestsforchildren allowed. A user should be assigned the role of parent to another user in the user context.



You may use the [QA testing site|https://qa.moodle.net/] for this test, which has DPO and Parent roles already set up with users assigned. The site also has the 'Contact Data Protection Office' checkbox ticked. The user with the Parent role is parent to user Sam Student.

# Log in as the DPO and go to Data requests in the Site administration.

# Click the 'New request' button then in the form select a user to request data for, enter a comment and save changes.

# Verify that on the Data requests page the data request is listed with status 'Pending'.

# Log out then log in as a user with the role of parent for another user (their child).

# Go to your profile page and click the 'Data requests' link.

# Click the 'New request' button then in the form, search for your child to request data for.

# Verify that only your child is listed.

# Enter a comment and save changes.

# Verify that on the Data requests page, the message 'Your request has been submitted to the site's Data Protection Officer' is displayed and your data request is listed with status 'Pending'.",1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12844,CLONE - A user can request personal data on behalf of another user,"Test requirements:

* A site with a privacy officer role set up as described in the documentation [Privacy officer role|https://docs.moodle.org/35/en/Privacy_officer_role]. A user should be assigned the role of privacy officer in the system context.

* The 'Contact privacy officer' checkbox to be ticked in 'Privacy settings' in the Site administration.

* A site with a parent role set up as described in the documentation [Parent role|https://docs.moodle.org/en/Parent_role] which also has the capability tool/dataprivacy:makedatarequestsforchildren allowed. A user should be assigned the role of parent to another user in the user context.



You may use the [QA testing site|https://qa.moodle.net/] for this test, which has privacy officer and parent roles already set up with users assigned. The site also has the 'Contact privacy officer' checkbox ticked. The user with the parent role is parent to user Sam Student.

# Log in as the privacy officer and go to Data requests in the Site administration.

# Click the 'New request' button then in the form select a user to request data for, enter a comment and save changes.

# Verify that on the Data requests page the data request is listed with status 'Pending'.

# Log out then log in as a user with the role of parent for another user (their child).

# Go to your profile page and click the 'Data requests' link.

# Click the 'New request' button then in the form, search for your child to request data for.

# Verify that only your child is listed.

# Enter a comment and save changes.

# Verify that on the Data requests page, the message 'Your request has been submitted to the site's privacy officer' is displayed and your data request is listed with status 'Pending'.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12866,An admin can delete a user and all their data,"This test requires a course containing activities, including a forum, and a student who is enrolled in the course.



The test also requires admin access. If you would like to use the [QA testing site|https://qa.moodle.net/] for running this test, please see the [QA testing guide|https://docs.moodle.org/dev/QA_testing] for details of how to request admin access. Begin just after the hourly reset to give yourself plenty of time to complete the test!

# Log in as a student in the course and participate in a few activities, including adding a new discussion topic in the forum and replying to a forum post.

# Log out then log in as an administrator and go to Site administration / Users / Accounts / Browse list of users.

# If necessary, use the filter to find the student and then delete their account.

# Go to the course and verify that the student is no longer listed as a participant.

# Verify that the student's data in various activities has been deleted, with the exception of their forum posts.

# Go to Site administration / Users / Privacy and policies / Data requests and verify that the student is listed as type: Delete, status 'Awaiting approval' and message 'Automatically created upon user deletion.'

# Run the cron.

# Approve the request and verify that the status has changed to 'Approved'.

# Run the cron again.

# Go to the forum and verify that the text in the student's forum posts has been replaced by the text 'This forum post has been removed' in the subject and 'The content of this forum post has been removed' in the message.

# Go to Site administration / Users / Privacy and policies / Privacy settings and disable (untick) 'Create automatic data deletion requests' then save changes.

# Go to Site administration / Users / Accounts / Browse list of users and delete another account.

# Go to Site administration / Users / Privacy and policies / Data requests and verify that the account you just deleted is NOT listed.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-12867,CLONE - An admin can delete a user and all their data,"This test requires a course containing activities, including a forum, and a student who is enrolled in the course.



The test also requires admin access. If you would like to use the [QA testing site|https://qa.moodle.net/] for running this test, please see the [QA testing guide|https://docs.moodle.org/dev/QA_testing] for details of how to request admin access. Begin just after the hourly reset to give yourself plenty of time to complete the test!

# Log in as a student in the course and participate in a few activities, including adding a new discussion topic in the forum and replying to a forum post.

# Log out then log in as an administrator and go to Site administration / Users / Accounts / Browse list of users.

# If necessary, use the filter to find the student and then delete their account.

# Go to the course and verify that the student is no longer listed as a participant.

# Verify that the student's data in various activities has been deleted, with the exception of their forum posts.

# Go to Site administration / Users / Privacy and policies / Data requests and verify that the student is listed as type: Delete, status 'Awaiting approval' and message 'Automatically created upon user deletion.'

# Run the cron.

# Approve the request and verify that the status has changed to 'Approved'.

# Run the cron again.

# Go to the forum and verify that the text in the student's forum posts has been replaced by the text 'This forum post has been removed' in the subject and 'The content of this forum post has been removed' in the message.

# Go to Site administration / Users / Privacy and policies / Privacy settings and disable (untick) 'Create automatic data deletion requests' then save changes.

# Go to Site administration / Users / Accounts / Browse list of users and delete another account.

# Go to Site administration / Users / Privacy and policies / Data requests and verify that the account you just deleted is NOT listed.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-13471,CLONE - A user can request personal data on behalf of another user,"Test requirements:

* A site with a privacy officer role set up as described in the documentation [Privacy officer role|https://docs.moodle.org/35/en/Privacy_officer_role]. A user should be assigned the role of privacy officer in the system context.

* The 'Contact privacy officer' checkbox to be ticked in 'Privacy settings' in the Site administration.

* A site with a parent role set up as described in the documentation [Parent role|https://docs.moodle.org/en/Parent_role] which also has the capability tool/dataprivacy:makedatarequestsforchildren allowed. A user should be assigned the role of parent to another user in the user context.



You may use the [QA testing site|https://qa.moodle.net/] for this test, which has privacy officer and parent roles already set up with users assigned. The site also has the 'Contact privacy officer' checkbox ticked. The user with the parent role is parent to user Sam Student.

# Log in as the privacy officer and go to Data requests in the Site administration.

# Click the 'New request' button then in the form select a user to request data for, enter a comment and save changes.

# Verify that on the Data requests page the data request is listed with status 'Pending'.

# Log out then log in as a user with the role of parent for another user (their child).

# Go to your profile page and click the 'Data requests' link.

# Click the 'New request' button then in the form, search for your child to request data for.

# Verify that only your child is listed.

# Enter a comment and save changes.

# Verify that on the Data requests page, the message 'Your request has been submitted to the site's privacy officer' is displayed and your data request is listed with status 'Pending'.",1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
MDLQA-13486,CLONE - An admin can delete a user and all their data,"This test requires a course containing activities, including a forum, and a student who is enrolled in the course.



The test also requires admin access. If you would like to use the [QA testing site|https://qa.moodle.net/] for running this test, please see the [QA testing guide|https://docs.moodle.org/dev/QA_testing] for details of how to request admin access. Begin just after the hourly reset to give yourself plenty of time to complete the test!

# Log in as a student in the course and participate in a few activities, including adding a new discussion topic in the forum and replying to a forum post.

# Log out then log in as an administrator and go to Site administration / Users / Accounts / Browse list of users.

# If necessary, use the filter to find the student and then delete their account.

# Go to the course and verify that the student is no longer listed as a participant.

# Verify that the student's data in various activities has been deleted, with the exception of their forum posts.

# Go to Site administration / Users / Privacy and policies / Data requests and verify that the student is listed as type: Delete, status 'Awaiting approval' and message 'Automatically created upon user deletion.'

# Run the cron.

# Approve the request and verify that the status has changed to 'Approved'.

# Run the cron again.

# Go to the forum and verify that the text in the student's forum posts has been replaced by the text 'This forum post has been removed' in the subject and 'The content of this forum post has been removed' in the message.

# Go to Site administration / Users / Privacy and policies / Privacy settings and disable (untick) 'Create automatic data deletion requests' then save changes.

# Go to Site administration / Users / Accounts / Browse list of users and delete another account.

# Go to Site administration / Users / Privacy and policies / Data requests and verify that the account you just deleted is NOT listed.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0